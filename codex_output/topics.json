{
  "features": [
    {
      "featureId": "F01",
      "featureTitle": "Admin Purchase Price Handling",
      "description": "Keep purchase price capture, edits, and visibility scoped to admin workflows while protecting public views.",
      "topics": [
        {
          "id": "TP1",
          "title": "Capture Purchase Price on Add",
          "area": "Admin / Inventory Form",
          "goal": "Allow admins to enter and persist a purchase price when creating a book record.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [],
          "given": "An authenticated admin opens the Add Book form.",
          "when": "They enter a numeric purchase price and submit the form.",
          "then": "The value is validated (required, non-negative) and written to Firestore with the new book.",
          "notes": "Includes schema update, client-side validation messaging, and serverTimestamp-safe writes."
        },
        {
          "id": "TP2",
          "title": "Edit Stored Purchase Price",
          "area": "Admin / Inventory Management",
          "goal": "Enable admins to adjust the saved purchase price on existing books without recreating them.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "TP1"
          ],
          "given": "A book exists in inventory with or without a purchase price set.",
          "when": "An admin invokes the edit action and updates the purchase price field.",
          "then": "The new value passes validation and updates the Firestore document, reflecting immediately in the UI.",
          "notes": "Guard against empty submissions; reuse validation logic from TP1; keep optimistic UI updates consistent."
        },
        {
          "id": "TP3",
          "title": "Admin Visibility of Purchase Price",
          "area": "Admin / Inventory List",
          "goal": "Surface each book's purchase price to admins within list/detail panels for quick reference.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "TP1"
          ],
          "given": "An admin loads the inventory dashboard or detail drawer.",
          "when": "Books are rendered in the admin UI.",
          "then": "Each entry shows the stored purchase price (formatted currency or placeholder when missing) without affecting actions.",
          "notes": "Ensure formatting is locale-aware and accessible; no exposure in public components."
        },
        {
          "id": "TP4",
          "title": "Hide Purchase Price from Public Catalog",
          "area": "Public Catalog / Data Privacy",
          "goal": "Guarantee purchase price data never appears in the public catalog payloads or UI.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "TP1"
          ],
          "given": "A visitor browses the public catalog.",
          "when": "Client-side code queries Firestore and renders cards.",
          "then": "Purchase price fields are omitted or stripped before rendering so no cost data leaks publicly.",
          "notes": "Double-check Firestore queries/selects and DOM templates; consider security rules to block reads from non-admin contexts."
        }
      ]
    },
    {
      "featureId": "F05",
      "featureTitle": "Supplier Master Management",
      "description": "Introduce a supplier master so admins can CRUD suppliers (Name, Location) and keep every book attached to a supplier.",
      "topics": [
        {
          "id": "F05-TP1",
          "title": "Create Supplier Records",
          "area": "Admin / Supplier Master",
          "goal": "Allow admins to add supplier entries with required name and location data.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [],
          "given": "An admin opens the Supplier Master view.",
          "when": "They submit the form with a supplier name and location.",
          "then": "A new supplier document is persisted and listed without duplicates.",
          "notes": "Surface inline validation for required fields and prevent duplicate supplier names."
        },
        {
          "id": "F05-TP2",
          "title": "Edit or Remove Supplier Records",
          "area": "Admin / Supplier Master",
          "goal": "Let admins update supplier details or remove suppliers that are no longer in use.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F05-TP1"
          ],
          "given": "A supplier exists in the master list.",
          "when": "An admin edits the name/location or requests deletion.",
          "then": "Changes persist with audit safety, and deletions are blocked if books still reference the supplier.",
          "notes": "Show dependency warnings for in-use suppliers and ensure local lists stay in sync after edits."
        },
        {
          "id": "F05-TP3",
          "title": "Attach Supplier on Book Creation",
          "area": "Admin / Catalog",
          "goal": "Require selecting an existing supplier whenever a new book is created.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F05-TP1"
          ],
          "given": "An admin is creating a book and the supplier master already contains at least one active supplier.",
          "when": "They select a supplier from the dropdown (or attempt to submit without a selection) and submit the book form.",
          "then": "Valid submissions persist the supplier reference with the book, while missing/invalid selections block the save with clear feedback.",
          "notes": "Sync the supplier list in real time, prevent stale selections when a supplier is deleted mid-session, and support keyboard navigation for the control."
        },
        {
          "id": "F05-TP4",
          "title": "Edit Book-Supplier Mapping",
          "area": "Admin / Catalog",
          "goal": "Enable admins to change the supplier linked to an existing book.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F05-TP3"
          ],
          "given": "A book already has a supplier association.",
          "when": "An admin selects a different supplier and confirms the edit.",
          "then": "The book document updates with the new supplier, and all admin views refresh to reflect the change.",
          "notes": "Prevent orphan mappings by validating the new supplier still exists; broadcast updates to caching layers if any."
        }
      ]
    },
    {
      "featureId": "F06",
      "featureTitle": "Book Sale Settlement",
      "description": "Capture the complete sale outcome for each book, including sale price, inventory status, partner payout shares, and buyer attribution.",
      "topics": [
        {
          "id": "F06-TP1",
          "title": "Record Sale Status and Price",
          "area": "Admin / Sales Workflow",
          "goal": "Let admins toggle in-stock vs sold-out and capture the final sale price in a single action.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [],
          "given": "A book exists in the catalog and is ready to be marked as sold.",
          "when": "The admin switches the sale status and enters a sale price before saving.",
          "then": "The book document stores the status flag plus a validated sale price (required when sold, optional when still in stock).",
          "notes": "Enforce positive currency values, prevent marking as sold without a price, and update stock counters in the UI after persistence."
        },
        {
          "id": "F06-TP2",
          "title": "Compute Revenue Shares",
          "area": "Admin / Settlement",
          "goal": "Automatically calculate Srikar's share and the supplier share using sale and cost prices.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "TP1",
            "F06-TP1"
          ],
          "given": "The book already stores a cost price and the sale workflow captured a sale price.",
          "when": "The admin confirms the sale.",
          "then": "Srikar's share is recorded as (sale price - cost price)/2 and supplier share as cost price + (sale price - cost price)/2 with consistent rounding rules.",
          "notes": "Guard against sale prices lower than cost, surface computed amounts before commit, and reuse currency-format helpers to keep reports consistent."
        },
        {
          "id": "F06-TP3",
          "title": "Associate Buyer With Sale",
          "area": "Admin / Sales Workflow",
          "goal": "Link each sold book to a buyer drawn from the customer master so downstream reports know who purchased it.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F06-TP1",
            "F07-TP1"
          ],
          "given": "Customer records exist and a book is being marked as sold.",
          "when": "The admin searches for and selects a buyer (or adds one on the fly) within the sale confirmation flow.",
          "then": "The sale record stores the buyer reference and displays it anywhere the sale appears (history, settlements, receipts).",
          "notes": "Selection should be mandatory for sold books, support search by name/WhatsApp, and prevent orphaned references if the customer later changes."
        }
      ]
    },
    {
      "featureId": "F07",
      "featureTitle": "Customer Master Management",
      "description": "Introduce a lightweight customer directory with add/edit flows that capture name, address, location, and WhatsApp number for reuse in sales.",
      "topics": [
        {
          "id": "F07-TP1",
          "title": "Add Customer Records",
          "area": "Admin / Customer Master",
          "goal": "Allow admins to create customers with the required contact fields so that buyers can be tracked.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [],
          "given": "An admin opens the Customer Master module.",
          "when": "They submit the add form with name, address, location, and WhatsApp number.",
          "then": "A validated customer document is stored with normalized phone data and timestamps.",
          "notes": "Deduplicate by name + WhatsApp, enforce number formatting, and show inline errors for missing required fields."
        },
        {
          "id": "F07-TP2",
          "title": "Edit Customer Records",
          "area": "Admin / Customer Master",
          "goal": "Let admins update customer details without breaking links to past sales.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F07-TP1"
          ],
          "given": "A customer already exists in the directory.",
          "when": "An admin opens the record and amends the address, location, or WhatsApp info.",
          "then": "Changes persist, update the modified timestamp, and propagate to any sale views that reference the customer.",
          "notes": "Prevent edits that clear required fields, highlight unsaved changes, and keep references stable via immutable IDs."
        },
        {
          "id": "F07-TP3",
          "title": "Customer Lookup for Sales",
          "area": "Admin / Customer Master",
          "goal": "Expose a searchable customer list so other workflows (like sales settlement) can pick buyers quickly.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F07-TP1"
          ],
          "given": "An admin opens the customer lookup without any filter applied.",
          "when": "They enter a search term (e.g., name or WhatsApp) and submit/filter.",
          "then": "Until text is entered the list stays empty with guidance; once a query is provided, only matching customer summaries (name, location, WhatsApp) appear and the selected customer ID is emitted back to the calling workflow.",
          "notes": "Keep the pre-search state blank with helper text, require at least a few characters before querying, provide debounced search, highlight exact matches, and coordinate with F06-TP3 so a single selection UI can serve multiple modules."
        }
      ]
    },
    {
      "featureId": "F08",
      "featureTitle": "Sales Entry Management",
      "description": "Enable admins to record multi-item sales with customer attribution, per-book pricing, and consistent inventory status labels.",
      "topics": [
        {
          "id": "F08-TP1",
          "title": "Capture Sale Header",
          "area": "Admin / Sales Entry",
          "goal": "Require selecting a customer and sale date before adding sold books.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F07-TP1"
          ],
          "given": "An admin opens the Add Sale workflow and customer records already exist.",
          "when": "They search for a buyer and choose a sale date prior to saving.",
          "then": "The sale form locks in the selected customer ID and sale date, blocking continuation until both values pass validation.",
          "notes": "Surface inline errors for missing selections, support calendar pickers plus manual entry, and store timestamps in UTC."
        },
        {
          "id": "F08-TP2",
          "title": "Add Sale Line Items",
          "area": "Admin / Sales Entry",
          "goal": "Allow admins to add one line per book sold, capturing title, supplier, and selling price.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "TP1",
            "F05-TP3",
            "F06-TP1"
          ],
          "given": "The sale header is valid and the catalog already tracks purchase prices, suppliers, and stock.",
          "when": "The admin searches for a book, selects it (possibly multiple times for separate quantities), and enters a selling price for each line.",
          "then": "Each line stores the book reference, supplier snapshot, and validated selling price while allowing duplicate book entries to represent multiple quantities.",
          "notes": "Prevent mixing draft lines with missing prices, auto-populate supplier info when a book is chosen, and show running totals."
        },
        {
          "id": "F08-TP3",
          "title": "Persist Sale and Align UI Copy",
          "area": "Admin / Sales Entry",
          "goal": "Save the sale record and ensure the legacy 'Mark as Sold' button now reads 'Out of stock'.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F08-TP1",
            "F08-TP2"
          ],
          "given": "All sale header and line item validations pass.",
          "when": "The admin submits the sale.",
          "then": "A sale document containing the header and all line items is persisted, and every instance of the old 'Mark as Sold' button label is updated to 'Out of stock' without changing inventory automatically.",
          "notes": "Delay automatic stock flips until inventory rules mature; still show per-line persistence status and keep the new label consistent across the admin UI."
        }
      ]
    },
    {
      "featureId": "F09",
      "featureTitle": "Title-Based Sale Line Entry",
      "description": "Streamline sale line creation by letting admins search by book title, auto-fill supplier/price context, and manage the draft row without extra inventory lookups.",
      "topics": [
        {
          "id": "F09-TP1",
          "title": "Title Autocomplete Experience",
          "area": "Admin / Sales Entry",
          "goal": "Make the sale line title picker visually rich with card-style suggestions, keyboard navigation, and clear post-selection feedback.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F08-TP2"
          ],
          "given": "An admin is adding a sale line and catalog titles exist.",
          "when": "They type into the Book title field and move through the suggestion list via mouse or keyboard.",
          "then": "Each suggestion renders as a clickable card showing title, author, supplier badges, and a caret; hover/focus states highlight the option, the active item exposes aria-selected=\"true\", selecting a book shows a confirmation chip under #saleLineBookSummary, clears the list with a \u201cBook selected\u201d toast near #saleLineMsg, moves focus to the selling-price field, and no-match scenarios keep the line disabled with the guidance message.",
          "notes": "Use the title-only search, add solid backgrounds plus outline for the focused item, support ESC to dismiss, and announce the number of matches for assistive tech."
        },
        {
          "id": "F09-TP3",
          "title": "Header CTA and Draft Flow Alignment",
          "area": "Admin / Sales Entry",
          "goal": "Rename the header CTA, gate book entry until customer/date validate, and keep the draft row messaging in sync with the current selection.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F08-TP1",
            "F09-TP1"
          ],
          "given": "The sale header form is visible inside the sale entry experience.",
          "when": "The admin interacts with the header (selecting customer/date, pressing the CTA) or selects a book for the draft line.",
          "then": "The primary CTA reads \u201cAdd books\u201d (beside a disabled Persist sale button) with helper text \u201cCustomer + date unlocks book entry,\u201d stays disabled until both fields validate, and on success silently resets the form without extra banners; the draft label stays \u201cAdd another book,\u201d while focus hops to the price field after a selection and returns to the book input once the line saves.",
          "notes": "Keep helper copy inline beneath the CTA, briefly show a success state on the CTA before re-enabling, and ensure keyboard users perceive the label changes."
        },
        {
          "id": "F09-TP4",
          "title": "Customer Selection Feedback",
          "area": "Admin / Sales Entry",
          "goal": "Provide visible confirmation when a buyer is selected from the lookup list and mirror the state in the summary pill.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F07-TP3",
            "F08-TP1"
          ],
          "given": "An admin is choosing a customer via the lookup list inside the sale header.",
          "when": "They click Select on a customer and the hidden ID updates successfully.",
          "then": "The chosen row highlights with a filled background and the Select button becomes a checkmark chip labeled \u201cSelected,\u201d while #saleHeaderCustomerSummary swaps in the customer name, WhatsApp, city, and a \u201cChange customer\u201d text button that animates into view.",
          "notes": "Keep the state persistent after closing the lookup, announce the selection change for assistive tech, and allow re-selecting another customer which clears the prior highlight."
        },
        {
          "id": "F09-TP5",
          "title": "Persistent Customer Selection",
          "area": "Admin / Sales Entry",
          "goal": "Ensure a chosen customer remains selected even if the lookup input is cleared, only changing when a new customer is picked.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F09-TP4"
          ],
          "given": "An admin has successfully selected a customer and sees the summary pill populated.",
          "when": "They clear the lookup search field or type a new string without confirming another customer.",
          "then": "The previously selected customer stays locked in (highlight + summary pill intact) until another customer is explicitly selected, with an optional clear-selection control to reset the state.",
          "notes": "Debounce search input reset so it never wipes the stored selection, show a subtle notice that a customer is already selected, and require an explicit 'Change customer' action before replacing the selection."
        },
        {
          "id": "F09-TP6",
          "title": "Sale Panel Access and Visual Hierarchy",
          "area": "Admin / Inventory Header",
          "goal": "Add a primary Record sale entry point and restyle the sale panel with elevated inputs, sticky sections, and informative empty states.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F08-TP1",
            "F09-TP1"
          ],
          "given": "An authenticated admin is on admin.html with the inventory header (search + actions) visible.",
          "when": "They click the Record sale button beside the search box.",
          "then": "The button (matching other primary actions) scroll-focuses or opens the sale panel/modal, #saleEntryPanel inputs use a raised token with lighter background plus outline/glow focus states, sticky section headers keep the sale header and line form separated, and concise empty-state hints clarify what totals or metadata will appear after books are added.",
          "notes": "Ensure the Record sale action is one tap away on desktop/mobile, trap focus inside the modal when open, keep the panel visible by default for keyboard access, and provide the \u201cCustomer + date unlocks book entry\u201d reminder near the CTA."
        },
        {
          "id": "F09-TP7",
          "title": "Clear Lookup After Selection",
          "area": "Admin / Sales Entry",
          "goal": "Automatically reset the customer search field and collapse results after a customer is selected.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F09-TP4",
            "F09-TP5"
          ],
          "given": "A customer selection succeeds and the summary pill shows the chosen buyer.",
          "when": "The selection confirmation event fires (button press or keyboard action).",
          "then": "The lookup input clears its text, the autocomplete results list disappears, focus shifts to the next logical control (e.g., sale date), and the previously selected customer remains locked in until Change customer is invoked.",
          "notes": "Announce the reset for assistive tech, prevent accidental clearing if selection fails, and re-open the search automatically when Change customer is pressed."
        },
        {
          "id": "F09-TP8",
          "title": "Selling Price Input Guardrails",
          "area": "Admin / Sales Entry",
          "goal": "Restrict the selling price field to numeric entry with immediate validation feedback.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F08-TP2"
          ],
          "given": "An admin is entering a selling price for a sale line.",
          "when": "They type characters into the selling price input or attempt to submit a non-numeric/negative value.",
          "then": "Only digits (and a single optional decimal separator) are accepted, invalid keystrokes are ignored, and inline validation explains that the selling price must be a positive number before the line can be saved.",
          "notes": "Reuse existing currency-validation helpers, keep keyboard navigation (Tab, Backspace) functional, and announce validation errors to assistive tech users."
        }
      ]
    },
    {
      "featureId": "F10",
      "featureTitle": "Inventory Search Experience",
      "description": "Keep the admin inventory search responsive by surfacing the Available panel results whenever a query is entered.",
      "topics": [
        {
          "id": "F10-TP1",
          "title": "Header Search Filters Available Panel",
          "area": "Admin / Inventory",
          "goal": "Embed the title/author search inside the Available accordion header so admins filter Available results in place with accessible feedback.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [],
          "given": "An authenticated admin is on admin.html and sees the Available accordion summary row containing the Search by title or author field.",
          "when": "They enter at least two characters into the header search (or edit the query) while the Available list is on the page.",
          "then": "The Available accordion keeps its current open/closed state, filters the list in place, and announces the filtered results via aria-live messaging scoped to the panel without forcing focus or scrolling.",
          "notes": "The search input, label, and aria-live node move inside the Available summary/header (e.g., `#availableSearchInput`, `#availableSearchLabel`, `#availableSearchStatus`). Keep the <2 character guard scoped to this header search, tie the label/aria-controls to the Available panel, ensure the field is keyboard accessible, and drop the prior debounce, auto-scroll, and reduced-motion behaviors."
        }
      ]
    },
    {
      "featureId": "F11",
      "featureTitle": "Sale Line Item Removal",
      "description": "Let admins remove mistakenly added books from the Record sale accordion before persisting an order, mirroring common cart/order editing patterns.",
      "topics": [
        {
          "id": "F11-TP1",
          "title": "Expose Remove Controls Per Line",
          "area": "Admin / Sales Entry",
          "goal": "Surface an accessible remove affordance on every sale line row so admins can initiate deletion like they would in commerce order tables.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F09-TP3"
          ],
          "given": "The Record sale table already lists at least one book line and the sale header is marked ready.",
          "when": "An admin focuses, hovers, or activates the delete control for a specific line (mouse, keyboard, or touch).",
          "then": "Each row reveals a trash icon + text button with an aria-label naming the book, uses the same hit target width across desktop/mobile, and triggers a confirmation pattern (inline dialog or two-step button) before removal proceeds.",
          "notes": "Keep controls visible on focus (not hover-only), announce pending removal via aria-live, and prevent the delete control while the header is locked."
        },
        {
          "id": "F11-TP2",
          "title": "Remove Line and Recalculate Draft State",
          "area": "Admin / Sales Entry",
          "goal": "When removal is confirmed, delete the line from local state, update totals, and reset the draft inputs so another book can be added immediately.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F11-TP1"
          ],
          "given": "A sale draft contains one or more line items and the admin confirms a removal event for a particular line.",
          "when": "The removal confirmation completes.",
          "then": "The line disappears from the table, totals and amount chips recompute, the supplier snapshot/book summary clear if that book was active, focus returns to the book input, and removing the final line resets the draft label plus disables Persist sale until a new line is added.",
          "notes": "Log the change in the inline status list, reuse the existing draft reset helper, and ensure undo/redo shortcuts do not re-add the line accidentally."
        },
        {
          "id": "F11-TP3",
          "title": "Persist Clean Payload After Removals",
          "area": "Admin / Sales Entry",
          "goal": "Guarantee that Persist sale only sends the currently visible lines and blocks submission if all lines were deleted.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F11-TP2",
            "F08-TP3"
          ],
          "given": "One or more lines have been removed (possibly leaving zero lines) and the admin proceeds to Persist sale.",
          "when": "The Persist sale action runs validation and prepares the Firestore payload.",
          "then": "Only remaining lines are serialized, removed entries never reach Firestore, Persist sale is disabled with guidance when no lines remain, and the success toast/status list mentions how many line items were ultimately saved.",
          "notes": "Audit logs should note removed line IDs when available, and integration tests should assert the payload omits deleted lines even if their book IDs still exist in autocomplete history."
        }
      ]
    },
    {
      "featureId": "F12",
      "featureTitle": "Book Bundle Management",
      "description": "Enable admins to create supplier-scoped bundles, control publish status, and search bundles by included book titles.",
      "topics": [
        {
          "id": "F12-TP1",
          "title": "Create Supplier-Scoped Bundles",
          "area": "Admin / Bundles",
          "goal": "Allow admins to create Draft bundles by locking a supplier, selecting two or more of that supplier's books, and capturing a rupee price with a default 25% discount.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F05-TP3",
            "F13-TP1"
          ],
          "given": "The admin opens the Create Bundle panel and the supplier master already contains valid entries.",
          "when": "They choose a supplier (which locks until Reset), use the sale-style autocomplete to add two unique books from that supplier, and accept or override the recommended price within the allowed 1..total range.",
          "then": "Submit persists a Draft bundle document containing supplier metadata, ordered bookIds/books, totalListPriceRupees, recommendedPriceRupees, bundlePriceRupees, and createdBy timestamps; validation blocks duplicate books or out-of-range pricing.",
          "notes": "Bundle content stays immutable post-save; price defaults to 25% off combined book price (whole rupees)."
        },
        {
          "id": "F12-TP2",
          "title": "Publish or Unpublish Bundles",
          "area": "Admin / Bundles",
          "goal": "Give admins controls to publish/unpublish a bundle while preventing edits to title, books, or price after creation.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F12-TP1"
          ],
          "given": "A Draft or Published bundle is loaded into the status panel.",
          "when": "The admin clicks Publish or Unpublish and (optionally) attempts to edit immutable fields.",
          "then": "Only the status field transitions between Draft and Published, immutable fields snap back with explanatory messaging, and Firestore receives the status update without mutating title/books/price.",
          "notes": "Expose clear status chips + disabled inputs and reuse centralized status helper for consistency."
        },
        {
          "id": "F12-TP3",
          "title": "List Bundles + Search by Book",
          "area": "Admin / Bundles",
          "goal": "Provide a bundles list that can be filtered via book autocomplete selection plus supplier/status dropdowns, while surfacing publish controls per row.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F12-TP1",
            "F12-TP2"
          ],
          "given": "Bundles exist in Firestore and the admin opens the Existing Bundles panel.",
          "when": "They type at least two characters into the bundle search autocomplete, select a book suggestion (optionally narrow by supplier or status), or reset the selection.",
          "then": "The list immediately shows only bundles whose stored books include the selected book ID, combines any supplier/status filters, displays title/supplier/price/book-count/status plus publish/unpublish buttons, and shows an empty-state message when no bundles match; clearing the selection returns to an unfiltered view.",
          "notes": "Must reuse the stable book search helper, require explicit selection (not free-text), and ensure legacy bundles missing embedded book objects are hydrated before filtering."
        }
      ]
    },
    {
      "featureId": "F13",
      "featureTitle": "Pricing Integrity",
      "description": "Enforce mandatory price fields for books and bundles so catalog data stays trustworthy and downstream calculations have complete inputs.",
      "topics": [
        {
          "id": "F13-TP1",
          "title": "Require Book Price, MRP, and Purchase Price",
          "area": "Admin / Inventory",
          "goal": "Ensure the Add Book workflow treats selling price, MRP, and purchase price as required numeric fields before a book can be saved.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "TP1",
            "F05-TP3"
          ],
          "given": "An admin opens the Add Book form and fills out book metadata.",
          "when": "They attempt to save without entering valid values for price, MRP, or purchase price.",
          "then": "Inline validation blocks submission, highlights each missing or invalid field, and only proceeds once all three price fields contain non-negative integers; successful submissions persist the trio alongside the book.",
          "notes": "Update client validation, Firestore writes, and admin UI so price, MRP, and purchase price are mandatory and surfaced wherever books appear."
        },
        {
          "id": "F13-TP2",
          "title": "Bundle Price Must Be Entered",
          "area": "Admin / Bundles",
          "goal": "Prevent bundle creation unless the bundle price input contains a valid rupee value within the 1..sum range.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F12-TP1"
          ],
          "given": "An admin locks a supplier, selects qualifying books, and reaches the bundle price step.",
          "when": "They leave the bundle price empty or clear it after the recommended value appears.",
          "then": "Submit stays disabled, inline messaging explains that bundle price is mandatory, and the persisted document always includes bundlePriceRupees.",
          "notes": "Covers UI messaging, validation, and payload enforcement so bundle price cannot be omitted even if a recommendation is shown."
        }
      ]
    },
    {
      "featureId": "F14",
      "featureTitle": "Task-Focused Admin Workspace",
      "description": "Split the oversized admin accordion into smaller task pages with icon-driven navigation and keep Add Book as the default landing view.",
      "topics": [
        {
          "id": "F14-TP1",
          "title": "Add Book Default Landing",
          "area": "Admin / Navigation",
          "goal": "Ensure the Add Book workflow loads first (and via direct link) so the highest-frequency task is instantly available after sign-in.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [],
          "given": "An authenticated admin completes the sign-in flow or opens the /admin route without a section specified.",
          "when": "The workspace initializes or the admin refreshes the page.",
          "then": "The Add Book page renders as the default view with its icon tile marked active, collapsible sections hidden elsewhere, and deep links (hash/URL param) that always land on Add Book.",
          "notes": "Keep form autofill helpers intact, surface a clear heading for screen readers, and make the nav state reflect that Add Book is the default selection."
        },
        {
          "id": "F14-TP2",
          "title": "Expandable Icon Menu Navigation",
          "area": "Admin / Navigation",
          "goal": "Convert the existing icon grid into an accessible navigation hub where each tile expands to reveal description and sub-actions before routing to its page.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [],
          "given": "An admin is in the signed-in workspace and sees the icon-style menu bar.",
          "when": "They focus or click a tile (Manage books, Bundles, Suppliers, etc.).",
          "then": "The tile expands to show its summary and CTA links, other tiles collapse, ARIA attributes update (role=tab/accordion) for screen readers, and selecting a CTA routes to the corresponding page.",
          "notes": "Tiles must be reachable via keyboard, remember expanded/collapsed state, and expose data-nav hooks codex-dev can bind to new pages."
        },
        {
          "id": "F14-TP3",
          "title": "Dedicated Admin Task Pages",
          "area": "Admin / Multi-page Layout",
          "goal": "Move each major accordion panel (bundles, sale recording, requests, suppliers) into its own lightweight page/screen loaded via the icon menu.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F14-TP2"
          ],
          "given": "An admin activates a nav tile other than Add Book (e.g., Bundles).",
          "when": "Navigation loads the selected task page via routing or dynamic content swap.",
          "then": "Only that task's content is rendered (with its own hero/actions), the menu highlights the active tile, and back/overview links allow returning to the menu without scrolling a mega-accordion.",
          "notes": "Each page should lazy-load only the scripts/data needed for that task and preserve existing forms/validation while removing redundant accordion chrome."
        }
      ]
    },
    {
      "featureId": "F15",
      "featureTitle": "Admin Entry Points Coverage",
      "description": "Ensure every major admin accordion/panel (including Customer Master) and its key workflows have a clear navigation or deep-link entry from admin.html.",
      "topics": [
        {
          "id": "F15-TP1",
          "title": "Unified Admin Nav Map",
          "area": "Admin / Navigation",
          "goal": "Render the admin navigation from a single config so every major panel (Manage books, Bundles, Record sale, Book requests, Suppliers, Customer master) has a visible entry point tied to its DOM id.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [],
          "given": "An authenticated admin visits /admin and the workspace markup loads.",
          "when": "The navigation bar initializes.",
          "then": "Buttons for each major panel are generated with consistent data-nav ids, aria-controls pointing at the correct accordion/panel element, and keyboard focus order that lets users jump to any workflow without scrolling.",
          "notes": "Expose the nav map for reuse by deep-link helpers and tests so coverage stays in sync when panels are added or renamed."
        },
        {
          "id": "F15-TP2",
          "title": "Customer Master Entry (Mouse-First)",
          "area": "Admin / Customer Master",
          "goal": "Add a Customers nav control so mouse users can open the Customer Master accordion from the menu without scrolling.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F15-TP1"
          ],
          "given": "The Customers nav button is visible in the admin menu.",
          "when": "An admin clicks the Customers entry from the icon menu.",
          "then": "The customerPanel accordion expands, the Customers nav tile shows aria-current=\"page\", and Manage Books is deactivated while existing form state stays intact.",
          "notes": "Focus/keyboard semantics remain a backlog item; this topic is scoped to mouse/visual parity and basic nav affordances."
        },
        {
          "id": "F15-TP3",
          "title": "Hash & Section Deep Links",
          "area": "Admin / Navigation",
          "goal": "Guarantee every nav target (manageBooks, bundles, recordSale, bookRequests, suppliers, customers) has canonical hash and ?section alias support so admins can bookmark or share direct links.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F15-TP1"
          ],
          "given": "An admin opens /admin with a fragment or section query referencing one of the supported panels.",
          "when": "The workspace completes initialization and resolves the landing destination.",
          "then": "The requested panel opens (accordion expanded or section unhidden), the nav button is marked active, non-target panels stay untouched unless the design requires hiding them, and window.location.hash reflects the canonical alias for that panel.",
          "notes": "Document the supported aliases (e.g., #customers, #customer-master) and add tests to prevent regressions when new panels are added."
        },
        {
          "id": "F15-TP4",
          "title": "Remove Nav Detail Summaries",
          "area": "Admin / Navigation",
          "goal": "Simplify the icon menu by removing the detail summary/CTA sections so each tile just routes directly to its panel.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F15-TP1"
          ],
          "given": "The admin nav currently renders a detail section (`#navDetail-*`) for each tile.",
          "when": "The nav initializes.",
          "then": "Those detail sections no longer render (or are hidden), leaving only the primary nav buttons that route on click; no redundant summary text or CTAs are shown for any panel.",
          "notes": "Update specs/tests that referenced the detail summaries/CTA buttons to reflect the leaner menu."
        }
      ]
    },
    {
      "featureId": "F16",
      "featureTitle": "Manage Books Sub Navigation",
      "description": "Introduce a dropdown sub menu under Manage Books so Add/Available/Sold act like independent pages with hash-aware routing and a consistent default state.",
      "topics": [
        {
          "id": "F16-TP1",
          "title": "Manage Sub Nav Shell",
          "area": "Admin / Navigation",
          "goal": "Render the Manage Books sub nav with Add, Available, and Sold buttons plus ARIA/hash wiring so each panel can be addressed independently.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F14-TP2",
            "F15-TP1"
          ],
          "given": "An admin signs in and the Manage Books tile is the landing state (#add-book).",
          "when": "The Manage Books view renders.",
          "then": "A sub navigation (`#manageSubNav`) appears with Add/Available/Sold buttons, Add owns aria-current/aria-controls, and the framework exposes data-manage-tab hooks reused by later topics.",
          "notes": "Establishes markup, styles, and helper wiring for sub-nav dropdowns so additional Manage tabs can plug in without duplicating logic."
        },
        {
          "id": "F16-TP2",
          "title": "Add Tab Default State",
          "area": "Admin / Manage Books",
          "goal": "Keep the Add Book workflow as the default Manage view and ensure returning to Manage resets hashes/visibility to Add.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F16-TP1"
          ],
          "given": "The admin either lands on /admin or returns to Manage Books after visiting another nav tile.",
          "when": "The Manage tile activates or the Add tab is clicked.",
          "then": "Only the Add Book panel remains visible, Available/Sold stay hidden, the Add sub tab owns aria-current, and window.location.hash normalizes to #add-book.",
          "notes": "Resets any pending Manage sub-tab state whenever the user exits/enters Manage so Add is predictably first."
        },
        {
          "id": "F16-TP3",
          "title": "Available Tab Behavior",
          "area": "Admin / Manage Books",
          "goal": "Show the Available inventory list as its own Manage sub page while keeping filters and hashes consistent across tab switches.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F16-TP1"
          ],
          "given": "The Manage sub nav is visible and the Available view already has search/filter state.",
          "when": "The admin selects the Available sub tab or loads /admin with #manage-books/available.",
          "then": "Add/Sold panels hide, the Available panel is visible/focused, window.location.hash stays #manage-books/available, and its search/filter inputs retain their last values when leaving and returning.",
          "notes": "Covers aria-current swaps, hash rewrites, and state preservation for search inputs and results."
        },
        {
          "id": "F16-TP4",
          "title": "Sold Tab Behavior",
          "area": "Admin / Manage Books",
          "goal": "Expose the Sold/out-of-stock list as a dedicated Manage sub page with deep-link support and default-reset rules.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F16-TP1"
          ],
          "given": "The Manage sub nav is available.",
          "when": "The admin selects the Sold tab or lands on /admin#manage-books/sold and later navigates away/back to Manage.",
          "then": "Only the Sold panel displays while selected, window.location.hash remains #manage-books/sold, and re-entering Manage Books restores the Add tab with hash #add-book.",
          "notes": "Ensures Sold toggles open its <details>, hides Add/Available, and participates in the same routing helpers as other tabs."
        }
      ]
    },
    {
      "featureId": "F17",
      "featureTitle": "Nav Sub Menu Parity",
      "description": "Apply the existing Manage Books dropdown framework to the Bundles and Sale tiles so they share the same helper-driven UX without duplicating markup or logic.",
      "topics": [
        {
          "id": "F17-TP1",
          "title": "Bundles Sub Nav Parity",
          "area": "Admin / Navigation",
          "goal": "Rename \"Create bundles\" to \"Bundles\" and attach a two-button sub nav (Create/Manage) that reuses the Manage Books dropdown helpers, hashes, and aria wiring.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F16-TP1",
            "F15-TP1"
          ],
          "given": "The admin nav config loads (with Manage sub nav helpers already available).",
          "when": "The Bundles tile becomes active via landing state or user click.",
          "then": "The tile label reads Bundles, the shared dropdown renders Create and Manage options, Create owns aria-current by default, window.location.hash reflects #bundles/create or #bundles/manage, and both buttons point to the existing panels without forking markup or JS.",
          "notes": "Explicitly reuse the Manage sub nav helper/config; do not duplicate DOM fragments or routing logic when wiring Bundles."
        },
        {
          "id": "F17-TP2",
          "title": "Sale Sub Nav Shell",
          "area": "Admin / Sales",
          "goal": "Rename \"Record sale\" to \"Sale\" and reuse the dropdown helper to add a sub nav container (Record option for now) so future sale workflows can plug in without new plumbing.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F16-TP1",
            "F15-TP1"
          ],
          "given": "The nav renders after sign-in and the Manage sub nav helper is registered.",
          "when": "The Sale tile activates directly or via #sale/record.",
          "then": "A Sale dropdown appears (styled identically to Manage/Bundles), Record is selected by default with aria-current, the Record sale panel is the only visible section, hashes normalize to #sale/record, and no duplicate event handlers/styles are introduced.",
          "notes": "Keep the helper config-driven so adding future Sale sub options (History, Returns) is purely data changes; reuse the Manage Books dropdown CSS/JS."
        }
      ]
    },
    {
      "featureId": "F18",
      "featureTitle": "Unified Pagination Framework",
      "description": "Introduce a shared pagination contract and UI controls that can be plugged into admin and public list views without duplicating Firestore/query logic.",
      "topics": [
        {
          "id": "F18-TP1",
          "title": "Pagination Contract and Data Model",
          "area": "Cross-Cutting / Pagination",
          "goal": "Define a reusable pagination contract (inputs, outputs, and metadata) that all list views can adopt, independent of specific modules.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [],
          "given": "A view needs to load Firestore-backed records in pages rather than all at once.",
          "when": "The view requests a page of results using the shared pagination helper or contract.",
          "then": "The helper accepts a consistent set of parameters (page size, direction, cursor) and returns a normalized payload containing records plus paging metadata (hasNext, hasPrev, cursors) that callers can render without knowing Firestore details.",
          "notes": "Covers the core interface for offset/cursor-based paging, default page sizes, and how views should represent paging state without leaking backend-specific concepts."
        },
        {
          "id": "F18-TP2",
          "title": "Admin List Pagination Shell",
          "area": "Admin / Lists",
          "goal": "Provide a standard pagination control strip (Previous/Next, item range, and disabled states) that admin list views can drop in with minimal wiring.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F18-TP1"
          ],
          "given": "An admin list view (e.g., Manage Books, Suppliers, Customers) has more items than the default page size.",
          "when": "The admin interacts with the pagination controls (clicking Next/Previous or changing page size where supported).",
          "then": "The control strip updates the underlying pagination request via the shared contract, reflects loading/disabled states correctly, and renders a consistent summary like \u201cItems 21\u201340 of 132\u201d without each screen reinventing buttons or copy.",
          "notes": "Establishes shared CSS/markup patterns for pagination controls, including focus/ARIA attributes and a place to plug in future page-size or jump-to-page affordances."
        },
        {
          "id": "F18-TP3",
          "title": "Public Catalog Pagination Application",
          "area": "Public Catalog / Listing",
          "goal": "Apply the unified pagination framework to the public catalog so visitors see a predictable, performant paging pattern across categories.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F18-TP1"
          ],
          "given": "A visitor browses the public catalog and at least one category has more items than fit on a single page.",
          "when": "They scroll to the end of the current list and use the pagination affordance (e.g., Next/Previous buttons or a Load more control).",
          "then": "Additional books load using the shared pagination contract, the UI makes it clear which slice of results is visible, and the pattern stays consistent across all catalog tabs without duplicating Firestore query logic.",
          "notes": "Clarifies when to use explicit page controls vs. a Load more button, and how to preserve scroll position and basic accessibility expectations while still going through the shared helper."
        },
        {
          "id": "F18-TP4",
          "title": "Pagination State and Deep Linking",
          "area": "Routing / State Management",
          "goal": "Keep pagination state (page, cursors, and filters) restorable via URL/hash so refreshes and back/forward navigation land on the same slice of data.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F18-TP1",
            "F15-TP3"
          ],
          "given": "A list view uses the shared pagination contract and the admin or visitor navigates between pages and filters.",
          "when": "They refresh the page, share a link, or use browser back/forward to return to a previously viewed list.",
          "then": "The view restores the same pagination slice (or a safe nearest equivalent) based on URL/hash state, keeps pagination controls in sync, and never shows a different page than the one implied by the URL.",
          "notes": "Defines how page and filter parameters are encoded into the URL/hash and how the pagination helper should reconcile stale or invalid cursor state."
        },
        {
          "id": "F18-TP5",
          "title": "Pagination Controller Abstraction",
          "area": "Cross-Cutting / Pagination",
          "goal": "Introduce a reusable pagination controller that wraps the shared helpers and exposes a tiny, screen-agnostic API for any list view.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F18-TP1",
            "F18-TP2",
            "F18-TP3",
            "F18-TP4"
          ],
          "given": "An admin or public list view wants to adopt the shared pagination framework without reimplementing request, UI, and URL wiring on its own.",
          "when": "The view instantiates the pagination controller with a dataSource callback, default page size, initial filters, and location sync settings.",
          "then": "The controller manages internal pagination state (items, pageMeta, totalItems, offset, filters), exposes simple methods like goNext/goPrev/loadMore/setFilters, reuses the shared helpers to compute UI state and deep-link params, and keeps the view aligned with URL/back/forward semantics via a consistent callback surface.",
          "notes": "Defines the shape of the controller config and public API so later topics can plug specific screens into it with minimal glue code."
        }
      ]
    },
    {
      "featureId": "F19",
      "featureTitle": "Available Books Pagination Integration",
      "description": "Apply the unified pagination controller and shell to the Manage Books > Available view so admins can page through inventory without custom wiring.",
      "topics": [
        {
          "id": "F19-TP1",
          "title": "Available Books Data Source",
          "area": "Admin / Manage Books",
          "goal": "Create a pagination-aware dataSource for the Available list that queries Firestore with the current filters and page cursor.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F16-TP3",
            "F18-TP1",
            "F18-TP5"
          ],
          "given": "The Manage Books > Available tab is active and the pagination controller initializes.",
          "when": "The controller requests a page with a specified size, direction, or cursor plus the current filter/search state.",
          "then": "The dataSource composes the Firestore query, enforces ordering, returns normalized results with paging metadata, and gracefully handles empty or short final pages without duplicating pagination logic.",
          "notes": "Ensure deduped supplier/search filters feed into the query inputs and that the controller can refetch page 1 whenever filters change."
        },
        {
          "id": "F19-TP2",
          "title": "Available Books Pagination Shell",
          "area": "Admin / Manage Books",
          "goal": "Mount the shared pagination shell within the Available list panel and wire it to the controller methods.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F19-TP1",
            "F18-TP2"
          ],
          "given": "An admin views the Available list that displays more items than the configured page size.",
          "when": "The controller emits UI state changes or the admin activates Previous/Next controls.",
          "then": "The shell renders consistent summary text, disables/enables controls per state, triggers goPrev/goNext without double submissions, and keeps focus/ARIA patterns aligned with other paginated lists.",
          "notes": "Layout should match existing Manage sub panels; ensure the pagination controls remain sticky near list footer and support keyboard activation."
        },
        {
          "id": "F19-TP3",
          "title": "Available Books Pagination State Sync",
          "area": "Admin / Manage Books",
          "goal": "Persist pagination + filter state for the Available list across reloads and navigation.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F19-TP2",
            "F18-TP4"
          ],
          "given": "The admin has navigated across pages or adjusted filters/search within the Available view.",
          "when": "They refresh, deep-link to Manage Books, or use browser back/forward to return.",
          "then": "The controller restores the same filter/page combination (or nearest safe slice), updates the hash/location parameters, resets to page 1 when filters change, and prevents stale cursors from causing blank lists.",
          "notes": "Coordinate with Manage sub nav hash patterns (#manage-books/available) so pagination params append cleanly (e.g., ?page=3) without breaking other panels."
        },
        {
          "id": "F19-TP4",
          "title": "Available Page Size Selector",
          "area": "Admin / Manage Books",
          "goal": "Expose a per-page selector (10/20/50) so admins can adjust how many available books load per slice without reloading.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F19-TP2",
            "F19-TP3"
          ],
          "given": "The Available list shows more results than a single page and the pagination shell is visible.",
          "when": "The admin changes the page-size control to 10, 20, or 50 items per page.",
          "then": "The controller updates its request pageSize, refetches the first slice for the new size, persists the selection in state sync (hash/query or local storage), and keeps the summary text/Prev-Next state accurate for the chosen size.",
          "notes": "Default remains 20 until the admin selects a different size. Size options should be keyboard accessible and announced when changed."
        },
        {
          "id": "F19-TP5",
          "title": "Available Numeric Pager",
          "area": "Admin / Manage Books",
          "goal": "Add an Amazon-style numeric pager (Prev, page numbers, Next, per-page dropdown) presented in a single right-aligned row.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F19-TP2",
            "F19-TP3",
            "F19-TP4"
          ],
          "given": "The Available list spans multiple pages (based on total items \u00f7 page size) and the pagination bar is visible.",
          "when": "The admin clicks Prev, Next, or a specific page number within the numeric pager.",
          "then": "The numeric chips highlight the current page, only render up to the total page count, Prev/Next stay aligned on the right, the per-page dropdown remains alongside them, and the hash/summary update so deep links restore the chosen page.",
          "notes": "Layout should mirror Amazon\u2019s one-row pagination: Prev button, page numbers, Next button, and the per-page dropdown, all sharing consistent Material styling."
        }
      ]
    },
    {
      "featureId": "F20",
      "featureTitle": "Sold Books Pagination Integration",
      "description": "Adopt the shared pagination contract and shell for Manage Books > Sold so historical sales stay fast, filterable, and consistent with Available.",
      "topics": [
        {
          "id": "SBD-F20-TP1",
          "title": "Sold Books Data Source & Cursor Wiring",
          "area": "Admin / Sold Books",
          "goal": "Expose the sold-book history through the shared pagination controller using sale-date ordering and sale-specific fields.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F16-TP4",
            "F18-TP1",
            "F18-TP5"
          ],
          "given": "An admin opens Manage Books > Sold and there are more sold records than a single page can show.",
          "when": "The pagination controller requests the first or a subsequent page using the shared contract.",
          "then": "The sold books query executes via the contract, sorted by sale timestamp, and returns normalized records (book title, sale price, customer, soldOn) plus hasNext/hasPrev/cursor metadata ready for the UI.",
          "notes": "Reuse the F19 data-source pattern, include sale totals per row so the summary text has counts, and ensure the controller handles empty or short final pages gracefully."
        },
        {
          "id": "SBD-F20-TP2",
          "title": "Sold Books Pagination Shell & Summary",
          "area": "Admin / Sold Books",
          "goal": "Mount the shared pagination shell inside the Sold panel and keep controls/summary text aligned with controller state.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "SBD-F20-TP1",
            "F18-TP2",
            "F18-TP4"
          ],
          "given": "The Sold Books panel is visible and more rows exist than the selected page size.",
          "when": "The admin clicks Previous/Next, uses keyboard navigation, or changes the page size.",
          "then": "The shell disables controls while loading, calls goPrev/goNext/setPageSize on the controller, re-renders the Sold list and summary (e.g., \"Items 21-40 of 180 - Sold\"), and keeps hash/back-button state aligned via the shared helpers.",
          "notes": "Use the same markup/CSS tokens as the Available view, keep Prev/Next order and aria-labels per Material guidance, and expose the summary as aria-live=polite text."
        },
        {
          "id": "SBD-F20-TP3",
          "title": "Sold Books Filter Reset & Cursor Safety",
          "area": "Admin / Sold Books",
          "goal": "Reset pagination cursors whenever Sold filters (date range, supplier/customer chips, search) change so results stay accurate.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "SBD-F20-TP1",
            "F18-TP4"
          ],
          "given": "Filters exist on the Sold view (date range, supplier/customer, search text) and at least one is active.",
          "when": "The admin modifies or clears any filter or search term.",
          "then": "The controller drops stored cursors, reloads page 1 with the new filters, recomputes the total-count summary, and updates URL/hash state so reloading or sharing the link restores the filtered page.",
          "notes": "Guard against stale cursors returning empty pages and ensure clearing all filters switches back to the default sort plus first page without manual refreshes."
        }
      ]
    },
    {
      "featureId": "F21",
      "featureTitle": "Manage Bundles Pagination Integration",
      "description": "Wire the Manage Bundles grid into the shared pagination controller so bundle operations stay responsive even with hundreds of bundles.",
      "topics": [
        {
          "id": "SBD-F21-TP1",
          "title": "Manage Bundles Pagination Suite Adoption",
          "area": "Admin / Bundles",
          "goal": "Mount the pagination suite in Manage Bundles so the shared data source and controls power the grid with zero duplicated logic.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F12-TP3",
            "F17-TP1",
            "F18-TP1",
            "F18-TP2",
            "F18-TP5"
          ],
          "given": "The Bundles -> Manage panel lists dozens of bundles and supplier/status filters are available.",
          "when": "The pagination suite mounts with the Manage Bundles selectors and requests the first or subsequent page with active filters.",
          "then": "The shared data source returns normalized rows plus paging metadata, the shell renders summary/Prev/Next/page-size controls, and URL/hash state reflects the current filters and page without ad-hoc wiring.",
          "notes": "Reuses the pagination suite end-to-end; do not fork markup or controller helpers for Manage Bundles.",
          "reuse": {
            "patternId": "PAGINATION_SUITE",
            "params": {
              "container": "#bundlePagination",
              "summaryEl": "#bundlePaginationSummary",
              "prevButton": "#bundlePaginationPrev",
              "nextButton": "#bundlePaginationNext",
              "pagesContainer": "#bundlePaginationPages",
              "pageSizeSelect": "#bundlePaginationSize",
              "defaultPageSize": 20,
              "pageSizeOptions": [
                10,
                20,
                50
              ],
              "mode": "pager",
              "locationKey": "manageBundles",
              "sticky": true
            },
            "adapters": {
              "dataSource": "fetchManageBundlesPage",
              "parseLocation": "readManageBundlesPagingFromLocation",
              "syncLocation": "writeManageBundlesPagingToLocation",
              "onStateChange": "renderManageBundlesRows",
              "formatSummary": "formatBundlePaginationSummary",
              "announce": "announceBundlePaginationRange"
            },
            "uiTexts": {
              "summaryTemplate": "Bundles {first}-{last} of {total}",
              "prevLabel": "Previous bundles",
              "nextLabel": "Next bundles"
            }
          }
        },
        {
          "id": "SBD-F21-TP2",
          "title": "Bundle Actions Preserve Pagination Context",
          "area": "Admin / Bundles",
          "goal": "Keep pagination state stable while publishing/unpublishing or editing bundles from the Manage view.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "SBD-F21-TP1",
            "F12-TP2",
            "F18-TP5"
          ],
          "given": "An admin is on a later page of Manage Bundles with filters applied.",
          "when": "They publish/unpublish a bundle or trigger inline edit actions that update Firestore.",
          "then": "The controller refreshes the affected row or current page without jumping back to page 1, updates totals if the row now hides (for example, filter mismatch), and keeps the same filters and cursors active.",
          "notes": "Use optimistic UI plus targeted refetch so row order stays stable while ensuring paging metadata stays accurate when bundles move in or out of the current filter.",
          "reuse": {
            "patternId": "PAGINATION_SUITE",
            "params": {
              "container": "#bundlePagination",
              "summaryEl": "#bundlePaginationSummary",
              "prevButton": "#bundlePaginationPrev",
              "nextButton": "#bundlePaginationNext",
              "pagesContainer": "#bundlePaginationPages",
              "pageSizeSelect": "#bundlePaginationSize",
              "defaultPageSize": 20,
              "pageSizeOptions": [
                10,
                20,
                50
              ],
              "mode": "pager",
              "locationKey": "manageBundles",
              "sticky": true
            },
            "adapters": {
              "dataSource": "fetchManageBundlesPage",
              "parseLocation": "readManageBundlesPagingFromLocation",
              "syncLocation": "writeManageBundlesPagingToLocation",
              "onStateChange": "renderManageBundlesRows",
              "formatSummary": "formatBundlePaginationSummary",
              "announce": "announceBundlePaginationRange"
            },
            "uiTexts": {
              "summaryTemplate": "Bundles {first}-{last} of {total}",
              "prevLabel": "Previous bundles",
              "nextLabel": "Next bundles"
            }
          }
        }
      ]
    },
    {
      "featureId": "F22",
      "featureTitle": "Open Book Requests Pagination Integration",
      "description": "Adopt the shared pagination helpers for the Book Requests queue so admins can triage large backlogs with predictable controls.",
      "topics": [
        {
          "id": "SBD-F22-TP1",
          "title": "Book Requests Pagination Suite Adoption",
          "area": "Admin / Book Requests",
          "goal": "Adopt the pagination suite for the open requests queue so data fetches, filters, and controls share one config.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F18-TP1",
            "F18-TP2",
            "F18-TP4",
            "F18-TP5"
          ],
          "given": "The Book Requests panel contains more open requests than the default page size and exposes status/priority filters.",
          "when": "The pagination suite mounts and the controller asks for the first or subsequent page with the active filters.",
          "then": "Only open or pending requests are fetched in createdAt desc order, the shell renders requests-specific summary copy plus Prev/Next/per-page controls, and URL/hash state captures filter + page params for reload safety.",
          "notes": "Copy and aria-labels must mention request context (e.g., \"Requests 61-70 of 322 open\").",
          "reuse": {
            "patternId": "PAGINATION_SUITE",
            "params": {
              "container": "#requestPagination",
              "summaryEl": "#requestPaginationSummary",
              "prevButton": "#requestPaginationPrev",
              "nextButton": "#requestPaginationNext",
              "pagesContainer": "#requestPaginationPages",
              "pageSizeSelect": "#requestPaginationSize",
              "defaultPageSize": 25,
              "pageSizeOptions": [
                10,
                25,
                50
              ],
              "mode": "pager",
              "locationKey": "openBookRequests",
              "sticky": true
            },
            "adapters": {
              "dataSource": "fetchOpenBookRequestsPage",
              "parseLocation": "readRequestPagingFromLocation",
              "syncLocation": "writeRequestPagingToLocation",
              "onStateChange": "renderOpenRequestRows",
              "formatSummary": "formatRequestPaginationSummary",
              "announce": "announceRequestPaginationRange"
            },
            "uiTexts": {
              "summaryTemplate": "Requests {first}-{last} of {total} open",
              "prevLabel": "Previous requests",
              "nextLabel": "Next requests"
            }
          }
        },
        {
          "id": "SBD-F22-TP2",
          "title": "Book Request Actions Maintain Paging",
          "area": "Admin / Book Requests",
          "goal": "Ensure fulfilling, snoozing, or assigning requests updates the paged list without duplicates or jumps.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "SBD-F22-TP1"
          ],
          "given": "An admin triages open requests while viewing a paginated slice.",
          "when": "They mark a request as fulfilled, snoozed, or reassigned (removing it from the open queue).",
          "then": "The row disappears or updates in place, the controller pulls the next item from the following page to keep the list filled when available, totals refresh, and the view never jumps back to page 1 unless the queue empties.",
          "notes": "Handle race conditions where multiple admins close requests simultaneously by reconciling server responses before adjusting cursors.",
          "reuse": {
            "patternId": "PAGINATION_SUITE",
            "params": {
              "container": "#requestPagination",
              "summaryEl": "#requestPaginationSummary",
              "prevButton": "#requestPaginationPrev",
              "nextButton": "#requestPaginationNext",
              "pagesContainer": "#requestPaginationPages",
              "pageSizeSelect": "#requestPaginationSize",
              "defaultPageSize": 25,
              "pageSizeOptions": [
                10,
                25,
                50
              ],
              "mode": "pager",
              "locationKey": "openBookRequests",
              "sticky": true
            },
            "adapters": {
              "dataSource": "fetchOpenBookRequestsPage",
              "parseLocation": "readRequestPagingFromLocation",
              "syncLocation": "writeRequestPagingToLocation",
              "onStateChange": "renderOpenRequestRows",
              "formatSummary": "formatRequestPaginationSummary",
              "announce": "announceRequestPaginationRange"
            },
            "uiTexts": {
              "summaryTemplate": "Requests {first}-{last} of {total} open",
              "prevLabel": "Previous requests",
              "nextLabel": "Next requests"
            }
          }
        }
      ]
    },
    {
      "featureId": "F23",
      "featureTitle": "Inline Bundle Composer Shell",
      "description": "Render the inline bundle composer UI and entry points in Available Books so admins can start building bundles without leaving the grid.",
      "topics": [
        {
          "id": "SBD-F23-TP1",
          "title": "Available Books Bundle Entry",
          "area": "Admin / Available Books",
          "goal": "Surface an Add to bundle control on every book card that opens the inline composer panel and seeds it with the selected book.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [],
          "given": "An admin browses Available Books and no inline bundle composer is active.",
          "when": "They press the Add to bundle action on any book card via mouse or keyboard.",
          "then": "A slide-in composer panel opens beside the list, focus moves to the panel heading, and the selected book appears in the panel with the originating control marked active.",
          "notes": "The panel may not cover existing filters/search and must be reachable/closable entirely via keyboard.",
          "reuse": {
            "patternId": "INLINE_BUNDLE_PANEL_SHELL",
            "params": {
              "container": "#inlineBundleComposer",
              "panelHeading": "#inlineBundleHeading",
              "triggerSelector": "[data-test='bookAddToBundle']",
              "bookList": "#inlineBundleSelectedBooks",
              "bundleNameInput": "#inlineBundleName",
              "bundlePriceInput": "#inlineBundlePrice",
              "recommendedPrice": "#inlineBundleRecommended",
              "totalPrice": "#inlineBundleTotal",
              "saveButton": "#inlineBundleSave",
              "resetButton": "#inlineBundleReset",
              "emptyState": "#inlineBundleEmptyState"
            },
            "adapters": {
              "controller": "createInlineBundleComposerController",
              "formatPrice": "formatCurrency",
              "announce": "announceInlineBundleChange"
            },
            "uiTexts": {
              "panelTitle": "Bundle in progress",
              "emptyState": "Add a book to start a bundle",
              "nameLabel": "Bundle name",
              "priceLabel": "Bundle price",
              "recommendedLabel": "Recommended price",
              "totalLabel": "Total sale price"
            }
          }
        },
        {
          "id": "SBD-F23-TP2",
          "title": "Inline Composer Fields and Copy",
          "area": "Admin / Available Books",
          "goal": "Render bundle name and price inputs, recommended-price placeholder, and helper copy inside the inline composer shell.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "SBD-F23-TP1"
          ],
          "given": "The inline composer panel is open.",
          "when": "It renders its heading and form region.",
          "then": "Bundle name and price inputs display required markers, helper text clarifies the mandatory bundle price, and the recommended price block shows placeholder copy until pricing adapters fill it.",
          "notes": "Copy and aria-describedby text must match the existing Bundle->Add form so validation language stays predictable.",
          "reuse": {
            "patternId": "INLINE_BUNDLE_PANEL_SHELL",
            "params": {
              "container": "#inlineBundleComposer",
              "panelHeading": "#inlineBundleHeading",
              "triggerSelector": "[data-test='bookAddToBundle']",
              "bookList": "#inlineBundleSelectedBooks",
              "bundleNameInput": "#inlineBundleName",
              "bundlePriceInput": "#inlineBundlePrice",
              "recommendedPrice": "#inlineBundleRecommended",
              "totalPrice": "#inlineBundleTotal",
              "saveButton": "#inlineBundleSave",
              "resetButton": "#inlineBundleReset",
              "emptyState": "#inlineBundleEmptyState"
            },
            "adapters": {
              "controller": "createInlineBundleComposerController",
              "formatPrice": "formatCurrency",
              "announce": "announceInlineBundleChange"
            },
            "uiTexts": {
              "panelTitle": "Bundle in progress",
              "emptyState": "Add a book to start a bundle",
              "nameLabel": "Bundle name",
              "priceLabel": "Bundle price",
              "recommendedLabel": "Recommended price",
              "totalLabel": "Total sale price"
            }
          }
        },
        {
          "id": "SBD-F23-TP3",
          "title": "Selected Books List and Reset",
          "area": "Admin / Available Books",
          "goal": "List selected books inside the composer with remove chips and a clear-all control that collapses the panel when empty.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "SBD-F23-TP1"
          ],
          "given": "At least one book has been added to the inline composer.",
          "when": "The admin removes individual books or activates Clear bundle.",
          "then": "The corresponding chip disappears with focus returning to a predictable target, the empty state copy returns when zero books remain, and the panel closes unless the user has pinned it open.",
          "notes": "Remove buttons must include the book title in their accessible name, and Clear bundle needs a confirmation when multiple items are present.",
          "reuse": {
            "patternId": "INLINE_BUNDLE_PANEL_SHELL",
            "params": {
              "container": "#inlineBundleComposer",
              "panelHeading": "#inlineBundleHeading",
              "triggerSelector": "[data-test='bookAddToBundle']",
              "bookList": "#inlineBundleSelectedBooks",
              "bundleNameInput": "#inlineBundleName",
              "bundlePriceInput": "#inlineBundlePrice",
              "recommendedPrice": "#inlineBundleRecommended",
              "totalPrice": "#inlineBundleTotal",
              "saveButton": "#inlineBundleSave",
              "resetButton": "#inlineBundleReset",
              "emptyState": "#inlineBundleEmptyState"
            },
            "adapters": {
              "controller": "createInlineBundleComposerController",
              "formatPrice": "formatCurrency",
              "announce": "announceInlineBundleChange"
            },
            "uiTexts": {
              "panelTitle": "Bundle in progress",
              "emptyState": "Add a book to start a bundle",
              "nameLabel": "Bundle name",
              "priceLabel": "Bundle price",
              "recommendedLabel": "Recommended price",
              "totalLabel": "Total sale price"
            }
          }
        }
      ]
    },
    {
      "featureId": "F24",
      "featureTitle": "Inline Bundle Composer Intelligence",
      "description": "Wire controller logic into the inline composer so bundle context, pricing signals, and validation behave like the standalone Bundle->Add flow without navigation.",
      "topics": [
        {
          "id": "SBD-F24-TP1",
          "title": "Inline Bundle Context Lifecycle",
          "area": "Admin / Available Books",
          "goal": "Spin up, restore, and tear down bundle context in memory as admins add or remove books from the inline composer.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "SBD-F23-TP1",
            "SBD-F23-TP3"
          ],
          "given": "An admin opens Available Books with the inline composer shell available.",
          "when": "They add, remove, or reopen the composer via its toggles.",
          "then": "The controller creates a new bundle context when none exists, tracks selected book IDs plus bundle meta, and restores the same context if the panel is reopened within the session.",
          "notes": "Expose derived state (count, subtotal, lastInteraction) via controller.getState() so the shell can stay declarative and tests can observe the same data.",
          "reuse": {
            "patternId": "INLINE_BUNDLE_COMPOSER_CONTROLLER",
            "params": {
              "currency": "INR",
              "pricePrecision": 2,
              "recommendationThreshold": 2,
              "maxBooks": 10,
              "persistSessionKey": "availableBooksInlineBundle"
            },
            "adapters": {
              "fetchPriceRecommendation": "fetchBundlePriceRecommendation",
              "loadBundle": "loadBundleDraftFromSession",
              "saveBundle": "persistNewBundle",
              "onStateChange": "syncInlineBundlePanelState"
            },
            "uiTexts": {
              "defaultBundleNamePrefix": "Bundle from Available Books",
              "pricePlaceholder": "Enter bundle price",
              "recommendedPendingCopy": "Add one more book to see a recommended price"
            }
          }
        },
        {
          "id": "SBD-F24-TP2",
          "title": "Inline Bundle Pricing Signals",
          "area": "Admin / Available Books",
          "goal": "Compute and stream recommended bundle price plus total sale price once qualifying books are selected.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "SBD-F24-TP1"
          ],
          "given": "The inline composer holds at least one selected book.",
          "when": "A second (or more) book is added or existing selections change.",
          "then": "The controller calls the recommendation adapter, emits recommendedPrice and totalSalePrice in state, applies fallback copy when the adapter rejects, and updates timestamps for downstream analytics.",
          "notes": "Ensure pending states debounced so adapters are not spammed while admins toggle selections rapidly.",
          "reuse": {
            "patternId": "INLINE_BUNDLE_COMPOSER_CONTROLLER",
            "params": {
              "currency": "INR",
              "pricePrecision": 2,
              "recommendationThreshold": 2,
              "maxBooks": 10,
              "persistSessionKey": "availableBooksInlineBundle"
            },
            "adapters": {
              "fetchPriceRecommendation": "fetchBundlePriceRecommendation",
              "loadBundle": "loadBundleDraftFromSession",
              "saveBundle": "persistNewBundle",
              "onStateChange": "syncInlineBundlePanelState"
            },
            "uiTexts": {
              "defaultBundleNamePrefix": "Bundle from Available Books",
              "pricePlaceholder": "Enter bundle price",
              "recommendedPendingCopy": "Add one more book to see a recommended price"
            }
          }
        },
        {
          "id": "SBD-F24-TP3",
          "title": "Inline Bundle Validation Gate",
          "area": "Admin / Available Books",
          "goal": "Keep the Save button disabled until bundle name and price validate, mirroring the Bundle->Add rules.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "SBD-F24-TP1"
          ],
          "given": "The inline composer contains a bundle context with one or more books.",
          "when": "The admin edits bundle name or bundle price fields.",
          "then": "Controller validation trims input, enforces non-empty bundle names plus positive currency values, feeds error messages back to the shell, and only marks the Save affordance enabled when both pass.",
          "notes": "Expose validationErrors per field so shells can hook aria-invalid and describe attributes without duplicating logic.",
          "reuse": {
            "patternId": "INLINE_BUNDLE_COMPOSER_CONTROLLER",
            "params": {
              "currency": "INR",
              "pricePrecision": 2,
              "recommendationThreshold": 2,
              "maxBooks": 10,
              "persistSessionKey": "availableBooksInlineBundle"
            },
            "adapters": {
              "fetchPriceRecommendation": "fetchBundlePriceRecommendation",
              "loadBundle": "loadBundleDraftFromSession",
              "saveBundle": "persistNewBundle",
              "onStateChange": "syncInlineBundlePanelState"
            },
            "uiTexts": {
              "defaultBundleNamePrefix": "Bundle from Available Books",
              "pricePlaceholder": "Enter bundle price",
              "recommendedPendingCopy": "Add one more book to see a recommended price"
            }
          }
        },
        {
          "id": "SBD-F24-TP4",
          "title": "Inline Bundle Pricing and MRP Summary",
          "area": "Admin / Available Books",
          "goal": "Auto-update recommended bundle price after two selections and surface total MRP inside the inline drawer.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "SBD-F24-TP2",
            "SBD-F23-TP3"
          ],
          "given": "The inline composer drawer is open with pricing summary fields visible.",
          "when": "A second book is added or selections change and the price recommendation adapter resolves.",
          "then": "The aggregate triggers the recommendation call without extra clicks, refreshes recommended and total sale price text via the formatter, and displays a total MRP sum for the selected books with aria-live feedback and fallback copy when data is missing.",
          "notes": "Recommendation threshold defaults to 2; debounce requests while books are added/removed rapidly. Total MRP should derive from book metadata (MRP/list price) when present and render a placeholder when not.",
          "reuse": {
            "patternId": "INLINE_BUNDLE_COMPOSER",
            "params": {
              "container": "#inlineBundleComposer",
              "panelHeading": "#inlineBundleHeading",
              "triggerSelector": "[data-test='bookAddToBundle']",
              "bookList": "#inlineBundleSelectedBooks",
              "bundleNameInput": "#inlineBundleName",
              "bundlePriceInput": "#inlineBundlePrice",
              "recommendedPrice": "#inlineBundleRecommended",
              "totalPrice": "#inlineBundleTotal",
              "totalMrp": "#inlineBundleMrp",
              "saveButton": "#inlineBundleSave",
              "resetButton": "#inlineBundleReset",
              "existingBundleSelect": "#inlineBundleExistingSelect",
              "currency": "INR"
            },
            "adapters": {
              "fetchPriceRecommendation": "fetchBundlePriceRecommendation",
              "formatPrice": "formatCurrency",
              "announce": "announceInlineBundleChange"
            },
            "uiTexts": {
              "panelTitle": "Bundle in progress",
              "recommendedPriceLabel": "Recommended price",
              "totalPriceLabel": "Total sale price",
              "totalMrpLabel": "Total MRP"
            }
          }
        }
      ]
    },
    {
      "featureId": "F25",
      "featureTitle": "Inline Bundle Composer Save & Lifecycle",
      "description": "Persist inline-built bundles, let admins continue an existing bundle context, and surface success/error feedback without leaving Available Books.",
      "topics": [
        {
          "id": "SBD-F25-TP1",
          "title": "Save Inline Bundle From Available Books",
          "area": "Admin / Available Books",
          "goal": "Persist a newly created inline bundle with its selected books and metadata using the existing bundle APIs.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "SBD-F24-TP2",
            "SBD-F24-TP3"
          ],
          "given": "A bundle context inside the inline composer contains valid name, price, and at least one book.",
          "when": "The admin presses Save bundle.",
          "then": "The aggregate calls saveBundle/linkBooks adapters once, shows a success toast with the bundle name, and exposes the new bundle ID for navigation without dropping the context until the call resolves.",
          "notes": "Saving must be idempotent; repeat taps while pending should be ignored and aria-busy applied to the panel.",
          "reuse": {
            "patternId": "INLINE_BUNDLE_COMPOSER",
            "params": {
              "container": "#inlineBundleComposer",
              "triggerSelector": "[data-test='bookAddToBundle']",
              "bookList": "#inlineBundleSelectedBooks",
              "bundleNameInput": "#inlineBundleName",
              "bundlePriceInput": "#inlineBundlePrice",
              "recommendedPrice": "#inlineBundleRecommended",
              "totalPrice": "#inlineBundleTotal",
              "saveButton": "#inlineBundleSave",
              "resetButton": "#inlineBundleReset",
              "existingBundleSelect": "#inlineBundleExistingSelect",
              "panelHeading": "#inlineBundleHeading",
              "currency": "INR"
            },
            "adapters": {
              "fetchPriceRecommendation": "fetchBundlePriceRecommendation",
              "loadBundle": "loadBundleDraftFromSession",
              "listExistingBundles": "listActiveBundles",
              "saveBundle": "persistInlineBundle",
              "linkBooks": "linkBooksToBundle",
              "toastSuccess": "toastInlineBundleSuccess",
              "toastError": "toastInlineBundleError",
              "announce": "announceInlineBundleChange",
              "formatPrice": "formatCurrency"
            },
            "uiTexts": {
              "panelTitle": "Bundle in progress",
              "emptyState": "Add a book to start a bundle",
              "existingBundleLabel": "Continue existing bundle",
              "saveLabel": "Save bundle",
              "resetLabel": "Clear bundle"
            }
          }
        },
        {
          "id": "SBD-F25-TP2",
          "title": "Continue Existing Bundle Inline",
          "area": "Admin / Available Books",
          "goal": "Allow admins to continue adding books to an existing bundle selected from the composer dropdown.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "SBD-F24-TP1"
          ],
          "given": "There is at least one existing bundle eligible for more books.",
          "when": "The admin chooses an existing bundle from the composer and adds a book.",
          "then": "The aggregate loads that bundle's metadata, merges it into the inline context, prevents duplicate book IDs, and keeps the Save affordance labeled as Update bundle with contextual helper copy.",
          "notes": "Ensure switching bundles warns about unsaved progress and resets recommendation totals to match the target bundle.",
          "reuse": {
            "patternId": "INLINE_BUNDLE_COMPOSER",
            "params": {
              "container": "#inlineBundleComposer",
              "triggerSelector": "[data-test='bookAddToBundle']",
              "bookList": "#inlineBundleSelectedBooks",
              "bundleNameInput": "#inlineBundleName",
              "bundlePriceInput": "#inlineBundlePrice",
              "recommendedPrice": "#inlineBundleRecommended",
              "totalPrice": "#inlineBundleTotal",
              "saveButton": "#inlineBundleSave",
              "resetButton": "#inlineBundleReset",
              "existingBundleSelect": "#inlineBundleExistingSelect",
              "panelHeading": "#inlineBundleHeading",
              "currency": "INR"
            },
            "adapters": {
              "fetchPriceRecommendation": "fetchBundlePriceRecommendation",
              "loadBundle": "loadBundleDraftFromSession",
              "listExistingBundles": "listActiveBundles",
              "saveBundle": "persistInlineBundle",
              "linkBooks": "linkBooksToBundle",
              "toastSuccess": "toastInlineBundleSuccess",
              "toastError": "toastInlineBundleError",
              "announce": "announceInlineBundleChange",
              "formatPrice": "formatCurrency"
            },
            "uiTexts": {
              "panelTitle": "Bundle in progress",
              "emptyState": "Add a book to start a bundle",
              "existingBundleLabel": "Continue existing bundle",
              "saveLabel": "Save bundle",
              "resetLabel": "Clear bundle"
            }
          }
        },
        {
          "id": "SBD-F25-TP3",
          "title": "Inline Bundle Feedback and Recovery",
          "area": "Admin / Available Books",
          "goal": "Provide inline success/failure feedback, clear or resume the composer, and keep the Available Books grid in sync after saves.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "SBD-F25-TP1"
          ],
          "given": "A save attempt is initiated from the inline composer.",
          "when": "The save resolves successfully or fails.",
          "then": "On success the composer shows a toast, optionally offers a View bundle link, and resets only when the admin confirms; on failure it surfaces inline errors, re-enables controls, and leaves the existing context intact for retry.",
          "notes": "Emit analytics hooks (bundleCreatedInline, bundleCreateFailedInline) with bundleId/error codes and keep focus trapped inside error summary for screen readers.",
          "reuse": {
            "patternId": "INLINE_BUNDLE_COMPOSER",
            "params": {
              "container": "#inlineBundleComposer",
              "triggerSelector": "[data-test='bookAddToBundle']",
              "bookList": "#inlineBundleSelectedBooks",
              "bundleNameInput": "#inlineBundleName",
              "bundlePriceInput": "#inlineBundlePrice",
              "recommendedPrice": "#inlineBundleRecommended",
              "totalPrice": "#inlineBundleTotal",
              "saveButton": "#inlineBundleSave",
              "resetButton": "#inlineBundleReset",
              "existingBundleSelect": "#inlineBundleExistingSelect",
              "panelHeading": "#inlineBundleHeading",
              "currency": "INR"
            },
            "adapters": {
              "fetchPriceRecommendation": "fetchBundlePriceRecommendation",
              "loadBundle": "loadBundleDraftFromSession",
              "listExistingBundles": "listActiveBundles",
              "saveBundle": "persistInlineBundle",
              "linkBooks": "linkBooksToBundle",
              "toastSuccess": "toastInlineBundleSuccess",
              "toastError": "toastInlineBundleError",
              "announce": "announceInlineBundleChange",
              "formatPrice": "formatCurrency"
            },
            "uiTexts": {
              "panelTitle": "Bundle in progress",
              "emptyState": "Add a book to start a bundle",
              "existingBundleLabel": "Continue existing bundle",
              "saveLabel": "Save bundle",
              "resetLabel": "Clear bundle"
            }
          }
        }
      ]
    },
    {
      "featureId": "F29",
      "featureTitle": "Floating Bundle Drawer Trigger",
      "description": "Replace bundle/cart drawer triggers with a reusable floating icon + badge that opens drawers with animation and stays visible without scrolling.",
      "topics": [
        {
          "id": "SBD-F29-TP1",
          "title": "Floating Drawer Trigger Pattern",
          "area": "Pattern Library / UI Shell",
          "goal": "Define a reusable floating trigger with badge and animation hook for bundle/cart drawers.",
          "environment": "HTML + Vanilla JavaScript + Jest + jsdom",
          "dependencies": [],
          "given": "A view wants a Material-style floating trigger for an in-progress bundle or cart count.",
          "when": "The count rises above zero and the host mounts the trigger pattern.",
          "then": "A fixed bottom-right icon appears with a capped two-digit badge, hides when zero, and clicking it invokes the host drawer open handler with an animation hook available.",
          "notes": "Pattern must expose stable selectors/params for trigger, badge, and open handler; follow Material positioning and keep styling/animation details overridable by codex-ux."
        },
        {
          "id": "SBD-F29-TP2",
          "title": "Books Available Floating Bundle Trigger",
          "area": "Admin / Manage Books - Available",
          "goal": "Apply the floating trigger to Manage Books  Available so the bundle drawer can be opened from anywhere.",
          "environment": "HTML + Vanilla JavaScript + Jest + jsdom",
          "dependencies": [
            "SBD-F23-TP1",
            "SBD-F24-TP1"
          ],
          "given": "An admin is on Manage Books  Available with the inline bundle composer/drawer available.",
          "when": "They add one or more books to a bundle so the bundle count is above zero.",
          "then": "The floating trigger shows the bundle count capped at two digits, stays visible without scrolling, hides when empty, and clicking it opens the existing bundle drawer with the specified animation.",
          "notes": "Reuses the floating trigger pattern; count must mirror inline composer state and not require scrolling or panel toggles to access."
        }
      ]
    },
    {
      "featureId": "BACKLOG",
      "featureTitle": "Backlog",
      "description": "Future accessibility work that remains after the mouse-first Admin entry-point changes.",
      "topics": [
        {
          "id": "BACKLOG-TP1",
          "title": "Accessible Customers Entry",
          "area": "Admin / Customer Master",
          "goal": "Deliver keyboard and screen-reader parity for the Customers nav flow, including focus management and deep-link announcements.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F15-TP2"
          ],
          "given": "A keyboard or assistive-technology user activates the Customers nav button or loads /admin with #customers or ?section=customers.",
          "when": "Navigation switches to the Customers section.",
          "then": "Focus moves to the Customer panel heading/summary, ARIA relationships announce the state change, and deep links normalize to #customers without collapsing other panels.",
          "notes": "Reintroduces the focus/ARIA requirements that were deferred from F15-TP2 once mouse parity shipped."
        }
      ]
    },
    {
      "featureId": "TECHDEBT",
      "featureTitle": "Technical Debt",
      "description": "Known gaps/bugs to be resolved in later iterations.",
      "topics": [
        {
          "id": "TECHDEBT-TP1",
          "title": "Sync Admin Nav With Hash History",
          "area": "Admin / Navigation",
          "goal": "Ensure browser back/forward (hashchange) keeps the nav buttons and panels aligned with window.location.hash.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [
            "F15-TP3"
          ],
          "given": "A user navigates between admin sections, creating history entries (#customers, #bundles, etc.).",
          "when": "They press the browser back/forward buttons and the hash changes.",
          "then": "handleAdminNav (or equivalent) reruns so aria-current/panels match the hash; the UI never shows a different panel than the URL.",
          "notes": "Bug report: P1 Badge Keep admin nav in sync with hash history."
        }
      ]
    }
  ]
}
