{
  "feature": "Admin Purchase Price Handling",
  "topics": [
    {
      "id": "TP1",
      "title": "Capture Purchase Price on Add",
      "area": "Admin / Inventory Form",
      "goal": "Allow admins to enter and persist a purchase price when creating a book record.",
      "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
      "dependencies": [],
      "given": "An authenticated admin opens the Add Book form.",
      "when": "They enter a numeric purchase price and submit the form.",
      "then": "The value is validated (required, non-negative) and written to Firestore with the new book.",
      "notes": "Includes schema update, client-side validation messaging, and serverTimestamp-safe writes."
    },
    {
      "id": "TP2",
      "title": "Edit Stored Purchase Price",
      "area": "Admin / Inventory Management",
      "goal": "Enable admins to adjust the saved purchase price on existing books without recreating them.",
      "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
      "dependencies": ["TP1"],
      "given": "A book exists in inventory with or without a purchase price set.",
      "when": "An admin invokes the edit action and updates the purchase price field.",
      "then": "The new value passes validation and updates the Firestore document, reflecting immediately in the UI.",
      "notes": "Guard against empty submissions; reuse validation logic from TP1; keep optimistic UI updates consistent."
    },
    {
      "id": "TP3",
      "title": "Admin Visibility of Purchase Price",
      "area": "Admin / Inventory List",
      "goal": "Surface each book's purchase price to admins within list/detail panels for quick reference.",
      "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
      "dependencies": ["TP1"],
      "given": "An admin loads the inventory dashboard or detail drawer.",
      "when": "Books are rendered in the admin UI.",
      "then": "Each entry shows the stored purchase price (formatted currency or placeholder when missing) without affecting actions.",
      "notes": "Ensure formatting is locale-aware and accessible; no exposure in public components."
    },
    {
      "id": "TP4",
      "title": "Hide Purchase Price from Public Catalog",
      "area": "Public Catalog / Data Privacy",
      "goal": "Guarantee purchase price data never appears in the public catalog payloads or UI.",
      "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
      "dependencies": ["TP1"],
      "given": "A visitor browses the public catalog.",
      "when": "Client-side code queries Firestore and renders cards.",
      "then": "Purchase price fields are omitted or stripped before rendering so no cost data leaks publicly.",
      "notes": "Double-check Firestore queries/selects and DOM templates; consider security rules to block reads from non-admin contexts."
    }
  ],
  "features": [
    {
      "featureId": "F05",
      "featureTitle": "Supplier Master Management",
      "description": "Introduce a supplier master so admins can CRUD suppliers (Name, Location) and keep every book attached to a supplier.",
      "topics": [
        {
          "id": "F05-TP1",
          "title": "Create Supplier Records",
          "area": "Admin / Supplier Master",
          "goal": "Allow admins to add supplier entries with required name and location data.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [],
          "given": "An admin opens the Supplier Master view.",
          "when": "They submit the form with a supplier name and location.",
          "then": "A new supplier document is persisted and listed without duplicates.",
          "notes": "Surface inline validation for required fields and prevent duplicate supplier names."
        },
        {
          "id": "F05-TP2",
          "title": "Edit or Remove Supplier Records",
          "area": "Admin / Supplier Master",
          "goal": "Let admins update supplier details or remove suppliers that are no longer in use.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": ["F05-TP1"],
          "given": "A supplier exists in the master list.",
          "when": "An admin edits the name/location or requests deletion.",
          "then": "Changes persist with audit safety, and deletions are blocked if books still reference the supplier.",
          "notes": "Show dependency warnings for in-use suppliers and ensure local lists stay in sync after edits."
        },
        {
          "id": "F05-TP3",
          "title": "Attach Supplier on Book Creation",
          "area": "Admin / Catalog",
          "goal": "Require selecting an existing supplier whenever a new book is created.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": ["F05-TP1"],
          "given": "An admin is creating a book and the supplier master already contains at least one active supplier.",
          "when": "They select a supplier from the dropdown (or attempt to submit without a selection) and submit the book form.",
          "then": "Valid submissions persist the supplier reference with the book, while missing/invalid selections block the save with clear feedback.",
          "notes": "Sync the supplier list in real time, prevent stale selections when a supplier is deleted mid-session, and support keyboard navigation for the control."
        },
        {
          "id": "F05-TP4",
          "title": "Edit Book-Supplier Mapping",
          "area": "Admin / Catalog",
          "goal": "Enable admins to change the supplier linked to an existing book.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": ["F05-TP3"],
          "given": "A book already has a supplier association.",
          "when": "An admin selects a different supplier and confirms the edit.",
          "then": "The book document updates with the new supplier, and all admin views refresh to reflect the change.",
          "notes": "Prevent orphan mappings by validating the new supplier still exists; broadcast updates to caching layers if any."
        }
      ]
    },
    {
      "featureId": "F06",
      "featureTitle": "Book Sale Settlement",
      "description": "Capture the complete sale outcome for each book, including sale price, inventory status, partner payout shares, and buyer attribution.",
      "topics": [
        {
          "id": "F06-TP1",
          "title": "Record Sale Status and Price",
          "area": "Admin / Sales Workflow",
          "goal": "Let admins toggle in-stock vs sold-out and capture the final sale price in a single action.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [],
          "given": "A book exists in the catalog and is ready to be marked as sold.",
          "when": "The admin switches the sale status and enters a sale price before saving.",
          "then": "The book document stores the status flag plus a validated sale price (required when sold, optional when still in stock).",
          "notes": "Enforce positive currency values, prevent marking as sold without a price, and update stock counters in the UI after persistence."
        },
        {
          "id": "F06-TP2",
          "title": "Compute Revenue Shares",
          "area": "Admin / Settlement",
          "goal": "Automatically calculate Srikar's share and the supplier share using sale and cost prices.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": ["TP1", "F06-TP1"],
          "given": "The book already stores a cost price and the sale workflow captured a sale price.",
          "when": "The admin confirms the sale.",
          "then": "Srikar's share is recorded as (sale price - cost price)/2 and supplier share as cost price + (sale price - cost price)/2 with consistent rounding rules.",
          "notes": "Guard against sale prices lower than cost, surface computed amounts before commit, and reuse currency-format helpers to keep reports consistent."
        },
        {
          "id": "F06-TP3",
          "title": "Associate Buyer With Sale",
          "area": "Admin / Sales Workflow",
          "goal": "Link each sold book to a buyer drawn from the customer master so downstream reports know who purchased it.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": ["F06-TP1", "F07-TP1"],
          "given": "Customer records exist and a book is being marked as sold.",
          "when": "The admin searches for and selects a buyer (or adds one on the fly) within the sale confirmation flow.",
          "then": "The sale record stores the buyer reference and displays it anywhere the sale appears (history, settlements, receipts).",
          "notes": "Selection should be mandatory for sold books, support search by name/WhatsApp, and prevent orphaned references if the customer later changes."
        }
      ]
    },
    {
      "featureId": "F07",
      "featureTitle": "Customer Master Management",
      "description": "Introduce a lightweight customer directory with add/edit flows that capture name, address, location, and WhatsApp number for reuse in sales.",
      "topics": [
        {
          "id": "F07-TP1",
          "title": "Add Customer Records",
          "area": "Admin / Customer Master",
          "goal": "Allow admins to create customers with the required contact fields so that buyers can be tracked.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": [],
          "given": "An admin opens the Customer Master module.",
          "when": "They submit the add form with name, address, location, and WhatsApp number.",
          "then": "A validated customer document is stored with normalized phone data and timestamps.",
          "notes": "Deduplicate by name + WhatsApp, enforce number formatting, and show inline errors for missing required fields."
        },
        {
          "id": "F07-TP2",
          "title": "Edit Customer Records",
          "area": "Admin / Customer Master",
          "goal": "Let admins update customer details without breaking links to past sales.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": ["F07-TP1"],
          "given": "A customer already exists in the directory.",
          "when": "An admin opens the record and amends the address, location, or WhatsApp info.",
          "then": "Changes persist, update the modified timestamp, and propagate to any sale views that reference the customer.",
          "notes": "Prevent edits that clear required fields, highlight unsaved changes, and keep references stable via immutable IDs."
        },
        {
          "id": "F07-TP3",
          "title": "Customer Lookup for Sales",
          "area": "Admin / Customer Master",
          "goal": "Expose a searchable customer list so other workflows (like sales settlement) can pick buyers quickly.",
          "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
          "dependencies": ["F07-TP1"],
          "given": "An admin is in a workflow that needs to assign a buyer to a sale.",
          "when": "They search, filter, or paginate through the customer list.",
          "then": "Matching customer summaries (name, location, WhatsApp) are returned and the selected customer ID is emitted back to the calling workflow.",
          "notes": "Provide debounced search, highlight exact matches, and coordinate with F06-TP3 so a single selection UI can serve multiple modules."
        }
      ]
    }
  ]
}
