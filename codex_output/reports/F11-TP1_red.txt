
> test
> cross-env NODE_OPTIONS=--experimental-vm-modules jest --watchAll=false

(node:67911) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
(node:67912) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
(node:67914) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
PASS tests/spec/admin/F09-TP6-004_SearchValuePreserved.spec.js
  SPEC F09-TP5-004: Search field retains value and context while launching sale flow
    ‚úì typing in search and launching Record sale keeps the search field untouched and button aria-controls points to the panel (95 ms)

PASS tests/spec/admin/F07-TP2-003_PreventDuplicateCustomerEdits.spec.js
  SPEC F07-TP2-003: Duplicate edits are blocked
    ‚úì editing to a duplicate WhatsApp + country code combination surfaces an error (216 ms)

(node:67913) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
PASS tests/spec/admin/F09-TP3-004_HeaderResetLocksDraft.spec.js
  SPEC F09-TP3-004: Header reset relocks the draft row
    ‚úì toggling header back to invalid state disables controls and surfaces guidance (146 ms)

PASS tests/spec/admin/TP1-003_BlocksNonNumericPurchasePrice.spec.js
  SPEC TP1-003: Validation against non-numeric input
    ‚úì prevents addDoc and surfaces an inline error (296 ms)

(node:67909) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
(node:67908) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
(node:67910) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
PASS tests/spec/admin/F07-TP1-004_PersistsCustomerRecord.spec.js
  SPEC F07-TP1-004: Successful add persists normalized customer payload
    ‚úì payload trims strings, normalizes WhatsApp, stores timestamps, and clears the form (57 ms)

PASS tests/unit/editor/TP2-002_RejectsNonNumericPurchasePrice.test.js
  UNIT TP2-002: Validate numeric purchase price on edit save
    ‚úì non-numeric input keeps dialog open and skips updateDoc (85 ms)

PASS tests/spec/admin/F08-TP2-004_SaleLineTotalsAllowDuplicates.spec.js
  SPEC F08-TP2-004: Sale line totals allow duplicate book entries
    ‚úì adding the same book twice tracks unique lines and updates totals (59 ms)

PASS tests/spec/admin/TP1-004_BlocksNegativePurchasePrice.spec.js
  SPEC TP1-004: Validation against negative purchase price
    ‚úì stops the submission when the value is below zero (57 ms)

PASS tests/unit/inventory/TP3-001_PurchasePriceElement.test.js
  UNIT TP3-001: Purchase price element exists for available rows
    ‚úì available row contains .purchase-price element with rupee value (85 ms)

PASS tests/spec/admin/F09-TP7-001_LookupClearsAfterSelection.spec.js
  SPEC F09-TP7-001: Customer lookup clears search input after selection
    ‚úì selecting a result clears the input, hides the list, and keeps helper copy visible (71 ms)

PASS tests/spec/admin/F09-TP8-001_BlockNonNumericSellingPrice.spec.js
  SPEC F09-TP8-001: Selling price input strips non-numeric characters
    ‚úì typing alpha characters is ignored so the field only keeps digits/decimal separator (98 ms)

FAIL tests/spec/admin/F10-TP1-003_AnnounceFilteredResults.spec.js
  SPEC F10-TP1-003: Announce filtered results from the Available header search
    ‚úï qualifying query announces the filtered count inside the panel (1370 ms)

  ‚óè SPEC F10-TP1-003: Announce filtered results from the Available header search ‚Ä∫ qualifying query announces the filtered count inside the panel

    expect(received).toBe(expected) // Object.is equality

    Expected: "Filtered 1 results for 'astro'"
    Received: ""

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [0m
        [0m
        [36m<details[39m
          [33mid[39m=[32m"availableBooksPanel"[39m
          [33mopen[39m=[32m""[39m
        [36m>[39m
          [0m
          [0m
          [36m<summary>[39m
            [0m
            [0m
            [36m<div[39m
              [33mclass[39m=[32m"available-summary"[39m
            [36m>[39m
              [0m
              [0m
              [36m<strong>[39m
                [0mAvailable[0m
              [36m</strong>[39m
              [0m
              [0m
              [36m<label[39m
                [33mclass[39m=[32m"sr-only"[39m
                [33mfor[39m=[32m"availableSearchInput"[39m
                [33mid[39m=[32m"availableSearchLabel"[39m
              [36m>[39m
                [0m
                Search available books
              [0m
              [36m</label>[39m
              [0m
              [0m
              [36m<input[39m
                [33maria-labelledby[39m=[32m"availableSearchLabel"[39m
                [33mid[39m=[32m"availableSearchInput"[39m
                [33mplaceholder[39m=[32m"Search title or author"[39m
                [33mtype[39m=[32m"search"[39m
              [36m/>[39m
              [0m
            [0m
            [36m</div>[39m
            [0m
          [0m
          [36m</summary>[39m
          [0m
          [0m
          [36m<p[39m
            [33maria-live[39m=[32m"polite"[39m
            [33mclass[39m=[32m"sr-only"[39m
            [33mid[39m=[32m"inventorySearchStatus"[39m
          [36m/>[39m
          [0m
          [0m
          [36m<div[39m
            [33mid[39m=[32m"availList"[39m
          [36m>[39m
            [0m
    [0m
            [36m<article[39m
              [33mclass[39m=[32m"row"[39m
              [33mdata-id[39m=[32m"astro"[39m
            [36m>[39m
              [0m
      [0m
              [36m<img[39m
                [33malt[39m=[32m""[39m
                [33msrc[39m=[32m"./assets/placeholder.webp"[39m
              [36m/>[39m
              [0m
      [0m
              [36m<div[39m
                [33mclass[39m=[32m"row-meta"[39m
              [36m>[39m
                [0m
        [0m
                [36m<strong>[39m
                  [0mAstrophysics 101[0m
                [36m</strong>[39m
                [0m
        [0m
                [36m<div[39m
                  [33mclass[39m=[32m"muted"[39m
                [36m>[39m
                  [0m
          Neil D. ¬∑ Science ¬∑ Paperback
        [0m
                [36m</div>[39m
                [0m
        [0m
                [36m<div[39m
                  [33mclass[39m=[32m"purchase-price muted"[39m
                [36m>[39m
                  [0mPurchase price: Not set[0m
                [36m</div>[39m
                [0m
      [0m
              [36m</div>[39m
              [0m
      [0m
              [36m<div[39m
                [33mclass[39m=[32m"row-actions"[39m
              [36m>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn"[39m
                  [33mdata-action[39m=[32m"feature"[39m
                [36m>[39m
                  [0mFeature[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn btn-secondary"[39m
                  [33mdata-action[39m=[32m"edit"[39m
                [36m>[39m
                  [0mEdit[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn"[39m
                  [33mdata-action[39m=[32m"sold"[39m
                [36m>[39m
                  [0mMark sold[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn btn-danger"[39m
                  [33mdata-action[39m=[32m"delete"[39m
                [36m>[39m
                  [0mDelete[0m
                [36m</button>[39m
                [0m
      [0m
              [36m</div>[39m
              [0m
    [0m
            [36m</article>[39m
            [0m
    [0m
            [36m<article[39m
              [33mclass[39m=[32m"row"[39m
              [33mdata-id[39m=[32m"poetry"[39m
            [36m>[39m
              [0m
      [0m
              [36m<img[39m
                [33malt[39m=[32m""[39m
                [33msrc[39m=[32m"./assets/placeholder.webp"[39m
              [36m/>[39m
              [0m
      [0m
              [36m<div[39m
                [33mclass[39m=[32m"row-meta"[39m
              [36m>[39m
                [0m
        [0m
                [36m<strong>[39m
                  [0mPoems of the Sun[0m
                [36m</strong>[39m
                [0m
        [0m
                [36m<div[39m
                  [33mclass[39m=[32m"muted"[39m
                [36m>[39m
                  [0m
          A. Ray ¬∑ Poetry ¬∑ Hardcover
        [0m
                [36m</div>[39m
                [0m
        [0m
                [36m<div[39m
                  [33mclass[39m=[32m"purchase-price muted"[39m
                [36m>[39m
                  [0mPurchase price: Not set[0m
                [36m</div>[39m
                [0m
      [0m
              [36m</div>[39m
              [0m
      [0m
              [36m<div[39m
                [33mclass[39m=[32m"row-actions"[39m
              [36m>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn"[39m
                  [33mdata-action[39m=[32m"feature"[39m
                [36m>[39m
                  [0mFeature[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn btn-secondary"[39m
                  [33mdata-action[39m=[32m"edit"[39m
                [36m>[39m
                  [0mEdit[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn"[39m
                  [33mdata-action[39m=[32m"sold"[39m
                [36m>[39m
                  [0mMark sold[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn btn-danger"[39m
                  [33mdata-action[39m=[32m"delete"[39m
                [36m>[39m
                  [0mDelete[0m
                [36m</button>[39m
                [0m
      [0m
              [36m</div>[39m
              [0m
    [0m
            [36m</article>[39m
          [36m</div>[39m
          [0m
        [0m
        [36m</details>[39m
        [0m
        [0m
        [36m<details[39m
          [33mid[39m=[32m"soldBooksPanel"[39m
        [36m>[39m
          [0m
          [0m
          [36m<summary>[39m
            [0mSold[0m
          [36m</summary>[39m
          [0m
          [0m
          [36m<div[39m
            [33mid[39m=[32m"soldList"[39m
          [36m>[39m
            [36m<p[39m
              [33mclass[39m=[32m"muted"[39m
            [36m>[39m
              [0mNo sold books.[0m
            [36m</p>[39m
          [36m</div>[39m
          [0m
        [0m
        [36m</details>[39m
        [0m
      [0m
      [36m</body>[39m
    [36m</html>[39m

      28 |
      29 |     await waitFor(() => {
    > 30 |       expect(harness.searchStatus.textContent.trim()).toBe(
         |                                                       ^
      31 |         "Filtered 1 results for 'astro'"
      32 |       );
      33 |     });

      at tests/spec/admin/F10-TP1-003_AnnounceFilteredResults.spec.js:30:55
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:579:19)

FAIL tests/spec/admin/F10-TP1-002_IgnoreShortQueries.spec.js
  SPEC F10-TP1-002: Ignore short header search queries
    ‚úï dropping below two characters restores the full list without announcements (1482 ms)

  ‚óè SPEC F10-TP1-002: Ignore short header search queries ‚Ä∫ dropping below two characters restores the full list without announcements

    expect(received).toHaveLength(expected)

    Expected length: 1
    Received length: 2
    Received object: [<article class="row" data-id="astro">
      <img alt="" src="./assets/placeholder.webp" />
      <div class="row-meta">
        <strong>Astrophysics 101</strong>
        <div class="muted">
          Neil D. ¬∑ Science ¬∑ Paperback
        </div>
        <div class="purchase-price muted">Purchase price: Not set</div>
      </div>
      <div class="row-actions">
        <button class="btn" data-action="feature">Feature</button>
        <button class="btn btn-secondary" data-action="edit">Edit</button>
        <button class="btn" data-action="sold">Mark sold</button>
        <button class="btn btn-danger" data-action="delete">Delete</button>
      </div>
    </article>, <article class="row" data-id="poetry">
      <img alt="" src="./assets/placeholder.webp" />
      <div class="row-meta">
        <strong>Poems of the Sun</strong>
        <div class="muted">
          A. Ray ¬∑ Poetry ¬∑ Hardcover
        </div>
        <div class="purchase-price muted">Purchase price: Not set</div>
      </div>
      <div class="row-actions">
        <button class="btn" data-action="feature">Feature</button>
        <button class="btn btn-secondary" data-action="edit">Edit</button>
        <button class="btn" data-action="sold">Mark sold</button>
        <button class="btn btn-danger" data-action="delete">Delete</button>
      </div>
    </article>]

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [0m
        [0m
        [36m<details[39m
          [33mid[39m=[32m"availableBooksPanel"[39m
          [33mopen[39m=[32m""[39m
        [36m>[39m
          [0m
          [0m
          [36m<summary>[39m
            [0m
            [0m
            [36m<div[39m
              [33mclass[39m=[32m"available-summary"[39m
            [36m>[39m
              [0m
              [0m
              [36m<strong>[39m
                [0mAvailable[0m
              [36m</strong>[39m
              [0m
              [0m
              [36m<label[39m
                [33mclass[39m=[32m"sr-only"[39m
                [33mfor[39m=[32m"availableSearchInput"[39m
                [33mid[39m=[32m"availableSearchLabel"[39m
              [36m>[39m
                [0m
                Search available books
              [0m
              [36m</label>[39m
              [0m
              [0m
              [36m<input[39m
                [33maria-labelledby[39m=[32m"availableSearchLabel"[39m
                [33mid[39m=[32m"availableSearchInput"[39m
                [33mplaceholder[39m=[32m"Search title or author"[39m
                [33mtype[39m=[32m"search"[39m
              [36m/>[39m
              [0m
            [0m
            [36m</div>[39m
            [0m
          [0m
          [36m</summary>[39m
          [0m
          [0m
          [36m<p[39m
            [33maria-live[39m=[32m"polite"[39m
            [33mclass[39m=[32m"sr-only"[39m
            [33mid[39m=[32m"inventorySearchStatus"[39m
          [36m/>[39m
          [0m
          [0m
          [36m<div[39m
            [33mid[39m=[32m"availList"[39m
          [36m>[39m
            [0m
    [0m
            [36m<article[39m
              [33mclass[39m=[32m"row"[39m
              [33mdata-id[39m=[32m"astro"[39m
            [36m>[39m
              [0m
      [0m
              [36m<img[39m
                [33malt[39m=[32m""[39m
                [33msrc[39m=[32m"./assets/placeholder.webp"[39m
              [36m/>[39m
              [0m
      [0m
              [36m<div[39m
                [33mclass[39m=[32m"row-meta"[39m
              [36m>[39m
                [0m
        [0m
                [36m<strong>[39m
                  [0mAstrophysics 101[0m
                [36m</strong>[39m
                [0m
        [0m
                [36m<div[39m
                  [33mclass[39m=[32m"muted"[39m
                [36m>[39m
                  [0m
          Neil D. ¬∑ Science ¬∑ Paperback
        [0m
                [36m</div>[39m
                [0m
        [0m
                [36m<div[39m
                  [33mclass[39m=[32m"purchase-price muted"[39m
                [36m>[39m
                  [0mPurchase price: Not set[0m
                [36m</div>[39m
                [0m
      [0m
              [36m</div>[39m
              [0m
      [0m
              [36m<div[39m
                [33mclass[39m=[32m"row-actions"[39m
              [36m>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn"[39m
                  [33mdata-action[39m=[32m"feature"[39m
                [36m>[39m
                  [0mFeature[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn btn-secondary"[39m
                  [33mdata-action[39m=[32m"edit"[39m
                [36m>[39m
                  [0mEdit[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn"[39m
                  [33mdata-action[39m=[32m"sold"[39m
                [36m>[39m
                  [0mMark sold[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn btn-danger"[39m
                  [33mdata-action[39m=[32m"delete"[39m
                [36m>[39m
                  [0mDelete[0m
                [36m</button>[39m
                [0m
      [0m
              [36m</div>[39m
              [0m
    [0m
            [36m</article>[39m
            [0m
    [0m
            [36m<article[39m
              [33mclass[39m=[32m"row"[39m
              [33mdata-id[39m=[32m"poetry"[39m
            [36m>[39m
              [0m
      [0m
              [36m<img[39m
                [33malt[39m=[32m""[39m
                [33msrc[39m=[32m"./assets/placeholder.webp"[39m
              [36m/>[39m
              [0m
      [0m
              [36m<div[39m
                [33mclass[39m=[32m"row-meta"[39m
              [36m>[39m
                [0m
        [0m
                [36m<strong>[39m
                  [0mPoems of the Sun[0m
                [36m</strong>[39m
                [0m
        [0m
                [36m<div[39m
                  [33mclass[39m=[32m"muted"[39m
                [36m>[39m
                  [0m
          A. Ray ¬∑ Poetry ¬∑ Hardcover
        [0m
                [36m</div>[39m
                [0m
        [0m
                [36m<div[39m
                  [33mclass[39m=[32m"purchase-price muted"[39m
                [36m>[39m
                  [0mPurchase price: Not set[0m
                [36m</div>[39m
                [0m
      [0m
              [36m</div>[39m
              [0m
      [0m
              [36m<div[39m
                [33mclass[39m=[32m"row-actions"[39m
              [36m>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn"[39m
                  [33mdata-action[39m=[32m"feature"[39m
                [36m>[39m
                  [0mFeature[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn btn-secondary"[39m
                  [33mdata-action[39m=[32m"edit"[39m
                [36m>[39m
                  [0mEdit[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn"[39m
                  [33mdata-action[39m=[32m"sold"[39m
                [36m>[39m
                  [0mMark sold[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn btn-danger"[39m
                  [33mdata-action[39m=[32m"delete"[39m
                [36m>[39m
                  [0mDelete[0m
                [36m</button>[39m
                [0m
      [0m
              [36m</div>[39m
              [0m
    [0m
            [36m</article>[39m
          [36m</div>[39m
          [0m
        [0m
        [36m</details>[39m
        [0m
        [0m
        [36m<details[39m
          [33mid[39m=[32m"soldBooksPanel"[39m
        [36m>[39m
          [0m
          [0m
          [36m<summary>[39m
            [0mSold[0m
          [36m</summary>[39m
          [0m
          [0m
          [36m<div[39m
            [33mid[39m=[32m"soldList"[39m
          [36m>[39m
            [36m<p[39m
              [33mclass[39m=[32m"muted"[39m
            [36m>[39m
              [0mNo sold books.[0m
            [36m</p>[39m
          [36m</div>[39m
          [0m
        [0m
        [36m</details>[39m
        [0m
      [0m
      [36m</body>[39m
    [36m</html>[39m

      26 |
      27 |     await waitFor(() => {
    > 28 |       expect(harness.availList.querySelectorAll('.row')).toHaveLength(1);
         |                                                          ^
      29 |     });
      30 |
      31 |     harness.availableSearchInput.value = 's';

      at tests/spec/admin/F10-TP1-002_IgnoreShortQueries.spec.js:28:58
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:579:19)

FAIL tests/spec/admin/F10-TP1-001_HeaderSearchFiltersAvailable.spec.js
  SPEC F10-TP1-001: Header search filters Available list in place
    ‚úï typing a qualifying query in the header re-renders availList with only matches (1416 ms)

  ‚óè SPEC F10-TP1-001: Header search filters Available list in place ‚Ä∫ typing a qualifying query in the header re-renders availList with only matches

    expect(received).toHaveLength(expected)

    Expected length: 1
    Received length: 3
    Received object: [<article class="row" data-id="astro">
      <img alt="" src="./assets/placeholder.webp" />
      <div class="row-meta">
        <strong>Astrophysics 101</strong>
        <div class="muted">
          Neil D. ¬∑ Science ¬∑ Paperback
        </div>
        <div class="purchase-price muted">Purchase price: Not set</div>
      </div>
      <div class="row-actions">
        <button class="btn" data-action="feature">Feature</button>
        <button class="btn btn-secondary" data-action="edit">Edit</button>
        <button class="btn" data-action="sold">Mark sold</button>
        <button class="btn btn-danger" data-action="delete">Delete</button>
      </div>
    </article>, <article class="row" data-id="poetry">
      <img alt="" src="./assets/placeholder.webp" />
      <div class="row-meta">
        <strong>Poems of the Sun</strong>
        <div class="muted">
          A. Ray ¬∑ Poetry ¬∑ Hardcover
        </div>
        <div class="purchase-price muted">Purchase price: Not set</div>
      </div>
      <div class="row-actions">
        <button class="btn" data-action="feature">Feature</button>
        <button class="btn btn-secondary" data-action="edit">Edit</button>
        <button class="btn" data-action="sold">Mark sold</button>
        <button class="btn btn-danger" data-action="delete">Delete</button>
      </div>
    </article>, <article class="row" data-id="history">
      <img alt="" src="./assets/placeholder.webp" />
      <div class="row-meta">
        <strong>World History Digest</strong>
        <div class="muted">
          N. Scholar ¬∑ History ¬∑ Paperback
        </div>
        <div class="purchase-price muted">Purchase price: Not set</div>
      </div>
      <div class="row-actions">
        <button class="btn" data-action="feature">Feature</button>
        <button class="btn btn-secondary" data-action="edit">Edit</button>
        <button class="btn" data-action="sold">Mark sold</button>
        <button class="btn btn-danger" data-action="delete">Delete</button>
      </div>
    </article>]

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [0m
        [0m
        [36m<details[39m
          [33mid[39m=[32m"availableBooksPanel"[39m
          [33mopen[39m=[32m""[39m
        [36m>[39m
          [0m
          [0m
          [36m<summary>[39m
            [0m
            [0m
            [36m<div[39m
              [33mclass[39m=[32m"available-summary"[39m
            [36m>[39m
              [0m
              [0m
              [36m<strong>[39m
                [0mAvailable[0m
              [36m</strong>[39m
              [0m
              [0m
              [36m<label[39m
                [33mclass[39m=[32m"sr-only"[39m
                [33mfor[39m=[32m"availableSearchInput"[39m
                [33mid[39m=[32m"availableSearchLabel"[39m
              [36m>[39m
                [0m
                Search available books
              [0m
              [36m</label>[39m
              [0m
              [0m
              [36m<input[39m
                [33maria-labelledby[39m=[32m"availableSearchLabel"[39m
                [33mid[39m=[32m"availableSearchInput"[39m
                [33mplaceholder[39m=[32m"Search title or author"[39m
                [33mtype[39m=[32m"search"[39m
              [36m/>[39m
              [0m
            [0m
            [36m</div>[39m
            [0m
          [0m
          [36m</summary>[39m
          [0m
          [0m
          [36m<p[39m
            [33maria-live[39m=[32m"polite"[39m
            [33mclass[39m=[32m"sr-only"[39m
            [33mid[39m=[32m"inventorySearchStatus"[39m
          [36m/>[39m
          [0m
          [0m
          [36m<div[39m
            [33mid[39m=[32m"availList"[39m
          [36m>[39m
            [0m
    [0m
            [36m<article[39m
              [33mclass[39m=[32m"row"[39m
              [33mdata-id[39m=[32m"astro"[39m
            [36m>[39m
              [0m
      [0m
              [36m<img[39m
                [33malt[39m=[32m""[39m
                [33msrc[39m=[32m"./assets/placeholder.webp"[39m
              [36m/>[39m
              [0m
      [0m
              [36m<div[39m
                [33mclass[39m=[32m"row-meta"[39m
              [36m>[39m
                [0m
        [0m
                [36m<strong>[39m
                  [0mAstrophysics 101[0m
                [36m</strong>[39m
                [0m
        [0m
                [36m<div[39m
                  [33mclass[39m=[32m"muted"[39m
                [36m>[39m
                  [0m
          Neil D. ¬∑ Science ¬∑ Paperback
        [0m
                [36m</div>[39m
                [0m
        [0m
                [36m<div[39m
                  [33mclass[39m=[32m"purchase-price muted"[39m
                [36m>[39m
                  [0mPurchase price: Not set[0m
                [36m</div>[39m
                [0m
      [0m
              [36m</div>[39m
              [0m
      [0m
              [36m<div[39m
                [33mclass[39m=[32m"row-actions"[39m
              [36m>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn"[39m
                  [33mdata-action[39m=[32m"feature"[39m
                [36m>[39m
                  [0mFeature[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn btn-secondary"[39m
                  [33mdata-action[39m=[32m"edit"[39m
                [36m>[39m
                  [0mEdit[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn"[39m
                  [33mdata-action[39m=[32m"sold"[39m
                [36m>[39m
                  [0mMark sold[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn btn-danger"[39m
                  [33mdata-action[39m=[32m"delete"[39m
                [36m>[39m
                  [0mDelete[0m
                [36m</button>[39m
                [0m
      [0m
              [36m</div>[39m
              [0m
    [0m
            [36m</article>[39m
            [0m
    [0m
            [36m<article[39m
              [33mclass[39m=[32m"row"[39m
              [33mdata-id[39m=[32m"poetry"[39m
            [36m>[39m
              [0m
      [0m
              [36m<img[39m
                [33malt[39m=[32m""[39m
                [33msrc[39m=[32m"./assets/placeholder.webp"[39m
              [36m/>[39m
              [0m
      [0m
              [36m<div[39m
                [33mclass[39m=[32m"row-meta"[39m
              [36m>[39m
                [0m
        [0m
                [36m<strong>[39m
                  [0mPoems of the Sun[0m
                [36m</strong>[39m
                [0m
        [0m
                [36m<div[39m
                  [33mclass[39m=[32m"muted"[39m
                [36m>[39m
                  [0m
          A. Ray ¬∑ Poetry ¬∑ Hardcover
        [0m
                [36m</div>[39m
                [0m
        [0m
                [36m<div[39m
                  [33mclass[39m=[32m"purchase-price muted"[39m
                [36m>[39m
                  [0mPurchase price: Not set[0m
                [36m</div>[39m
                [0m
      [0m
              [36m</div>[39m
              [0m
      [0m
              [36m<div[39m
                [33mclass[39m=[32m"row-actions"[39m
              [36m>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn"[39m
                  [33mdata-action[39m=[32m"feature"[39m
                [36m>[39m
                  [0mFeature[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn btn-secondary"[39m
                  [33mdata-action[39m=[32m"edit"[39m
                [36m>[39m
                  [0mEdit[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn"[39m
                  [33mdata-action[39m=[32m"sold"[39m
                [36m>[39m
                  [0mMark sold[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn btn-danger"[39m
                  [33mdata-action[39m=[32m"delete"[39m
                [36m>[39m
                  [0mDelete[0m
                [36m</button>[39m
                [0m
      [0m
              [36m</div>[39m
              [0m
    [0m
            [36m</article>[39m
            [0m
    [0m
            [36m<article[39m
              [33mclass[39m=[32m"row"[39m
              [33mdata-id[39m=[32m"history"[39m
            [36m>[39m
              [0m
      [0m
              [36m<img[39m
                [33malt[39m=[32m""[39m
                [33msrc[39m=[32m"./assets/placeholder.webp"[39m
              [36m/>[39m
              [0m
      [0m
              [36m<div[39m
                [33mclass[39m=[32m"row-meta"[39m
              [36m>[39m
                [0m
        [0m
                [36m<strong>[39m
                  [0mWorld History Digest[0m
                [36m</strong>[39m
                [0m
        [0m
                [36m<div[39m
                  [33mclass[39m=[32m"muted"[39m
                [36m>[39m
                  [0m
          N. Scholar ¬∑ History ¬∑ Paperback
        [0m
                [36m</div>[39m
                [0m
        [0m
                [36m<div[39m
                  [33mclass[39m=[32m"purchase-price muted"[39m
                [36m>[39m
                  [0mPurchase price: Not set[0m
                [36m</div>[39m
                [0m
      [0m
              [36m</div>[39m
              [0m
      [0m
              [36m<div[39m
                [33mclass[39m=[32m"row-actions"[39m
              [36m>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn"[39m
                  [33mdata-action[39m=[32m"feature"[39m
                [36m>[39m
                  [0mFeature[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn btn-secondary"[39m
                  [33mdata-action[39m=[32m"edit"[39m
                [36m>[39m
                  [0mEdit[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn"[39m
                  [33mdata-action[39m=[32m"sold"[39m
                [36m>[39m
                  [0mMark sold[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn btn-danger"[39m
                  [33mdata-action[39m=[32m"delete"[39m
                [36m>[39m
                  [0mDelete[0m
                [36m</button>[39m
                [0m
      [0m
              [36m</div>[39m
              [0m
    [0m
            [36m</article>[39m
          [36m</div>[39m
          [0m
        [0m
        [36m</details>[39m
        [0m
        [0m
        [36m<details[39m
          [33mid[39m=[32m"soldBooksPanel"[39m
        [36m>[39m
          [0m
          [0m
          [36m<summary>[39m
            [0mSold[0m
          [36m</summary>[39m
          [0m
          [0m
          [36m<div[39m
            [33mid[39m=[32m"soldList"[39m
          [36m>[39m
            [36m<p[39m
              [33mclass[39m=[32m"muted"[39m
            [36m>[39m
              [0mNo sold books.[0m
            [36m</p>[39m
          [36m</div>[39m
          [0m
        [0m
        [36m</details>[39m
        [0m
      [0m
      [36m</body>[39m
    [36m</html>[39m

      35 |
      36 |     await waitFor(() => {
    > 37 |       expect(harness.availList.querySelectorAll('.row')).toHaveLength(1);
         |                                                          ^
      38 |     });
      39 |     expect(harness.availList.textContent).toContain('Astrophysics 101');
      40 |   });

      at tests/spec/admin/F10-TP1-001_HeaderSearchFiltersAvailable.spec.js:37:58
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:579:19)

PASS tests/spec/admin/F07-TP2-002_PersistCustomerEdit.spec.js
  SPEC F07-TP2-002: Customer edits persist via updateDoc
    ‚úì submitting in edit mode updates Firestore with normalized fields (92 ms)

PASS tests/spec/admin/F07-TP1-001_CustomerFormRequiresMandatoryFields.spec.js
  SPEC F07-TP1-001: Customer form enforces required fields
    ‚úì missing customer name blocks submission with inline guidance (355 ms)
    ‚úì missing WhatsApp number blocks submission as well (62 ms)

PASS tests/spec/admin/TP2-001_EditFormShowsPurchasePrice.spec.js
  SPEC TP2-001: Edit form exposes purchase price field
    ‚úì pre-fills purchase price input with stored value when opening edit dialog (153 ms)

PASS tests/spec/admin/F05-TP2-003_PreventDeleteWhenInUse.spec.js
  SPEC F05-TP2-003: Prevent deleting suppliers in use
    ‚úì delete action checks book references and blocks removal when in use (100 ms)

PASS tests/spec/admin/F08-TP2-001_SaleLineDraftReflectsBookSelection.spec.js
  SPEC F08-TP2-001: Sale line draft reflects selected book metadata
    ‚úì book lookup selection populates summary and hidden inputs (108 ms)

PASS tests/spec/admin/F08-TP1-001_SaleHeaderRequiresCustomer.spec.js
  SPEC F08-TP1-001: Sale header requires customer selection
    ‚úì customer lookup selection populates summary and hidden field (83 ms)
    ‚úì submitting without a customer surfaces inline error and blocks continuation (39 ms)

PASS tests/spec/admin/F07-TP1-005_AdminCustomerForm.spec.js
  SPEC F07-TP1-005: Admin customer form is present without country code input
    ‚úì admin.html exposes the add customer form fields but hides country code (1980 ms)

PASS tests/unit/inventory/TP3-004_PurchasePriceFormatting.test.js
  UNIT TP3-004: Purchase price formatting helper
    ‚úì text uses ‚Çπ prefix with comma separators (239 ms)

PASS tests/unit/inventory/TP3-003_PurchasePricePlaceholder.test.js
  UNIT TP3-003: Placeholder for missing purchase price
    ‚úì renders descriptive placeholder text inside .purchase-price (48 ms)

PASS tests/spec/admin/F09-TP4-003_LogsUnmatchedQueries.spec.js
  SPEC F09-TP4-003: Log unmatched queries
    ‚úì onNoMatch callback receives the normalized query text once per attempt (195 ms)

PASS tests/spec/admin/F05-TP1-001_SupplierFormRequiresFields.spec.js
  SPEC F05-TP1-001: Supplier form requires name/location
    ‚úì missing name blocks submission and surfaces inline error (135 ms)

PASS tests/spec/admin/F07-TP3-004_ClearCustomerLookup.spec.js
  SPEC F07-TP3-004: Clearing the lookup resets state
    ‚úì clear button wipes search input, hides list, and notifies consumer (110 ms)

PASS tests/spec/admin/F09-TP4-002_EnterWithoutMatch.spec.js
  SPEC F09-TP4-002: Block Enter key when no matches exist
    ‚úì pressing Enter with zero suggestions reiterates the guidance and never selects a book (60 ms)

PASS tests/spec/public/TP4-001_CatalogCardsHidePurchasePrice.spec.js
  SPEC TP4-001: Catalog cards hide purchase price
    ‚úì rendered cards omit any purchase price labels or values (57 ms)

PASS tests/spec/admin/TP1-002_PersistsPurchasePrice.spec.js
  SPEC TP1-002: Persist purchase price
    ‚úì includes purchasePrice number in the addDoc payload (125 ms)

PASS tests/spec/admin/F05-TP3-003_PersistsSupplierReference.spec.js
  SPEC F05-TP3-003: Persist supplier reference on add
    ‚úì Valid submission includes supplierId in the Firestore payload (87 ms)

PASS tests/spec/admin/F08-TP1-004_SaleHeaderLocksLineItems.spec.js
  SPEC F08-TP1-004: Sale header gates access to line items
    ‚úì continue button stays disabled until both customer and date are set (102 ms)
    ‚úì after emitting header payload, form locks to prevent duplicate submissions until reset (42 ms)

PASS tests/spec/admin/F09-TP1-005_SaleLineDraftLabelUpdates.spec.js
  SPEC F09-TP1-005: Draft label stays stable after book selection
    ‚úì selecting a title keeps the label static and shifts focus to the price input (202 ms)

PASS tests/spec/admin/F09-TP1-006_SaleLookupMatchesInventoryFilter.spec.js
  SPEC F09-TP1-006: Record sale lookup matches inventory filter results
    ‚úì suggestions stay in sync with the inventory search for initial and refined queries (212 ms)

PASS tests/spec/admin/F07-TP1-006_StoresCountryCode.spec.js
  SPEC F07-TP1-006: Customer payload stores country code independently
    ‚úì submissions persist a dedicated countryCode field fixed to +91 (194 ms)

PASS tests/spec/admin/TP1-001_AddFormShowsPurchasePrice.spec.js
  SPEC TP1-001: Purchase price field is visible
    ‚úì add book form includes a numeric purchase price input (290 ms)

PASS tests/spec/admin/TP3-001_AvailableRowShowsPurchasePrice.spec.js
  SPEC TP3-001: Available list shows purchase price
    ‚úì renders purchase price text with rupee value for available rows (118 ms)

PASS tests/spec/admin/F09-TP4-004_NewMatchClearsError.spec.js
  SPEC F09-TP4-004: Clear error when matches appear
    ‚úì after a no-match warning, a subsequent valid query clears the message and allows selection (30 ms)

PASS tests/spec/admin/F07-TP1-003_PreventsDuplicateCustomers.spec.js
  SPEC F07-TP1-003: Duplicate customers are rejected before writes
    ‚úì WhatsApp digits + country code drive the duplicate query (334 ms)

PASS tests/spec/admin/TP3-004_FormatsPurchasePrice.spec.js
  SPEC TP3-004: Purchase price formatting
    ‚úì applies rupee prefix and thousand separators (61 ms)

PASS tests/spec/admin/F05-TP2-002_PersistSupplierEdit.spec.js
  SPEC F05-TP2-002: Persist supplier edits
    ‚úì submitting in edit mode calls updateDoc with trimmed values (404 ms)
    ‚úì duplicate name during edit is blocked with inline message (60 ms)

PASS tests/unit/editor/TP2-003_RejectsNegativePurchasePrice.test.js
  UNIT TP2-003: Prevent negative purchase price submissions
    ‚úì negative numbers trigger an inline error and avoid updateDoc (98 ms)

PASS tests/unit/public/TP4-004_CatalogPayloadStripsPurchasePrice.test.js
  UNIT TP4-004: Catalog payload strips purchase price
    ‚úì subscribeToAllAvailable removes purchasePrice before invoking callback (20 ms)

PASS tests/spec/admin/F09-TP6-003_LauncherInitializesWorkflowOnce.spec.js
  SPEC F09-TP5-003: Launcher initializes sale workflow once on first activation
    ‚úì startSaleWorkflow runs only after the first click and not on repeated activations (42 ms)

PASS tests/spec/admin/TP2-002_RejectsNonNumericPurchasePrice.spec.js
  SPEC TP2-002: Reject non-numeric purchase price on edit
    ‚úì blocks save and surfaces numeric guidance when value contains letters (151 ms)

PASS tests/spec/admin/F05-TP3-001_PopulatesSupplierDropdown.spec.js
  SPEC F05-TP3-001: Supplier dropdown is present
    ‚úì Add Book form contains a supplier select with a placeholder option (1328 ms)

PASS tests/spec/admin/F05-TP2-004_DeleteSupplierWhenUnused.spec.js
  SPEC F05-TP2-004: Delete supplier when unused
    ‚úì delete removes supplier when no books reference it (63 ms)

PASS tests/unit/customers/F07-TP1-001_CustomerHelpers.test.js
  UNIT F07-TP1 customer helper functions
    ‚úì normalize helpers trim input and collapse whitespace (14 ms)
    ‚úì sanitizeWhatsAppNumber strips separators and country code so only digits remain (3 ms)
    ‚úì buildCustomerPayload normalizes inputs, stores digits, and timestamps the record (12 ms)

PASS tests/unit/admin/F08-TP2-001_SaleLinePayload.test.js
  UNIT F08-TP2-001: Sale line payload helper
    ‚úì normalizes book snapshot, supplier data, and timestamps (12 ms)

PASS tests/spec/admin/TP2-004_PersistsPurchasePriceUpdate.spec.js
  SPEC TP2-004: Persist edited purchase price
    ‚úì sends numeric purchasePrice in the updateDoc payload when save succeeds (124 ms)

PASS tests/spec/admin/TP3-002_SoldRowShowsPurchasePrice.spec.js
  SPEC TP3-002: Sold list also shows purchase price
    ‚úì sold rows mirror the purchase price label (196 ms)

PASS tests/spec/public/TP4-002_SearchResultsHidePurchasePrice.spec.js
  SPEC TP4-002: Search results hide purchase price
    ‚úì filtered render never mentions purchase price even when sale price is shown (40 ms)

PASS tests/spec/admin/F08-TP1-007_SaleHeaderSummaryChip.spec.js
  SPEC F08-TP1-006: Sale header summary shows selected customer details
    ‚úì selecting a customer surfaces name plus meta chip without extra controls (207 ms)

PASS tests/spec/admin/F09-TP4-005_WiringNoMatchKeepsDraftDisabled.spec.js
  SPEC F09-TP4-005: Wiring ‚Äî no-match clears selection and disables draft
    ‚úì after a valid selection, a subsequent no-match query clears the hidden bookId and re-disables the draft (167 ms)

PASS tests/spec/admin/F07-TP1-007_RequiresTenDigitWhatsapp.spec.js
  SPEC F07-TP1-007: WhatsApp number must be exactly 10 digits
    ‚úì submission with fewer than 10 digits shows an inline error (114 ms)
    ‚úì submission with more than 10 digits is rejected instead of truncated (84 ms)

PASS tests/spec/admin/F05-TP1-004_RenderNewSupplierInList.spec.js
  SPEC F05-TP1-004: Render supplier list
    ‚úì renders suppliers sorted alphabetically with name and location (99 ms)

PASS tests/unit/editor/TP2-001_EditFormShowsPurchasePrice.test.js
  UNIT TP2-001: Edit form mirrors existing purchase price
    ‚úì open() copies stored purchasePrice (including zero) into the field value (82 ms)

PASS tests/spec/admin/F08-TP1-002_SaleHeaderRequiresDate.spec.js
  SPEC F08-TP1-002: Sale header requires a valid sale date
    ‚úì missing date blocks submission even if customer selected (68 ms)
    ‚úì wrong formats surface guidance about dd-mon-yy (46 ms)
    ‚úì future dates are rejected with inline error (47 ms)
    ‚úì same calendar day in ahead-of-UTC timezones is accepted (48 ms)

PASS tests/spec/admin/F07-TP3-002_DebouncedLookupQueries.spec.js
  SPEC F07-TP3-002: Lookup debounces queries before filtering results
    ‚úì typing waits for debounce then filters customers by name only (308 ms)

PASS tests/spec/admin/F09-TP4-001_NoMatchShowsGuidance.spec.js
  SPEC F09-TP4-001: No-match guidance messaging
    ‚úì typing an unknown title shows guidance and keeps the hidden bookId empty (100 ms)

PASS tests/spec/admin/F09-TP3-002_HeaderReadyUnlocksDraft.spec.js
  SPEC F09-TP3-002: Unlock draft when header becomes valid
    ‚úì header ready state gates the Submit button even when book + price exist (203 ms)

PASS tests/spec/admin/F05-TP3-002_RequiresSupplierSelection.spec.js
  SPEC F05-TP3-002: Supplier selection is required
    ‚úì Submitting without a supplier prevents addDoc and shows inline error (557 ms)

PASS tests/unit/customers/F07-TP2-001_EditPayload.test.js
  UNIT F07-TP2 edit payload helper
    ‚úì normalizes inputs, preserves immutable fields, and refreshes keys (53 ms)

PASS tests/spec/admin/F05-TP4-004_HandleStaleSupplierDuringEdit.spec.js
  SPEC F05-TP4-004: Handle stale supplier during edit
    ‚úì if previously selected supplier disappears, save is blocked and warning shown (184 ms)

PASS tests/spec/admin/F08-TP1-003_SaleHeaderEmitsPayload.spec.js
  SPEC F08-TP1-003: Sale header emits normalized payload when valid
    ‚úì valid customer + date triggers onHeaderReady with UTC timestamp and metadata (86 ms)

PASS tests/spec/admin/F09-TP3-001_SaleDraftLockedUntilHeaderReady.spec.js
  SPEC F09-TP3-001: Draft form locked until header is valid
    ‚úì book title input, price field, and add button stay disabled with Add another book label (102 ms)

PASS tests/spec/admin/F07-TP2-005_BlockInvalidCustomerEdits.spec.js
  SPEC F07-TP2-005: Edit validation mirrors add form rules
    ‚úì edit mode still requires name and WhatsApp numbers before updateDoc runs (152 ms)

PASS tests/spec/admin/F07-TP2-004_CancelCustomerEdit.spec.js
  SPEC F07-TP2-004: Cancel clears edit mode
    ‚úì cancel button exits edit mode, clears hidden id, and restores blank form (117 ms)

PASS tests/spec/admin/F09-TP3-003_LineSubmitResetsFocus.spec.js
  SPEC F09-TP3-003: Draft reset refocuses the Book title input
    ‚úì after a line is saved, the draft clears and focus returns to the title input for rapid entry (186 ms)

PASS tests/spec/admin/F07-TP1-002_RejectsInvalidWhatsAppFormat.spec.js
  SPEC F07-TP1-002: WhatsApp numbers must be valid and normalized
    ‚úì non-numeric characters produce an inline WhatsApp validation error (140 ms)

PASS tests/spec/admin/F05-TP3-004_HandlesStaleSupplierSelection.spec.js
  SPEC F05-TP3-004: Handle stale/invalid supplier selections
    ‚úì Submitting with a stale supplier id is blocked and surfaces warning (136 ms)

PASS tests/spec/admin/TP3-003_ShowsPlaceholderWhenMissing.spec.js
  SPEC TP3-003: Placeholder when purchase price missing
    ‚úì renders ‚ÄúPurchase price: not set‚Äù when value absent (316 ms)

PASS tests/spec/admin/F09-TP5-002_ChangeCustomerClearsSelection.spec.js
  SPEC F09-TP5-002: Selecting a new customer replaces the previous summary
    ‚úì choosing another customer overwrites the hidden ID and summary text (96 ms)

PASS tests/unit/admin/F08-TP1-001_SaleHeaderPayload.test.js
  UNIT F08-TP1: buildSaleHeaderPayload
    ‚úì normalizes customer data, enforces UTC sale date, and stamps metadata (40 ms)

PASS tests/spec/admin/F08-TP2-002_SaleLineRequiresSellingPrice.spec.js
  SPEC F08-TP2-002: Sale line requires selling price
    ‚úì adding a line without price shows inline validation and blocks submission (151 ms)

PASS tests/spec/admin/F07-TP2-001_PrefillCustomerEditForm.spec.js
  SPEC F07-TP2-001: Edit button pre-fills the customer form
    ‚úì clicking edit switches the form to edit mode with populated fields (146 ms)

PASS tests/spec/admin/F07-TP3-006_PreSearchShowsHelper.spec.js
  SPEC F07-TP3-006: Lookup stays empty with helper copy before searching
    ‚úì snapshot results do not render until the admin types a valid query (215 ms)

PASS tests/unit/suppliers/F05-TP1-001_NormalizeSupplierName.test.js
  UNIT F05-TP1 helpers
    ‚úì normalizeSupplierName trims whitespace and collapses gaps (8 ms)
    ‚úì isDuplicateSupplierName compares case-insensitively (4 ms)
    ‚úì formatSupplierDisplay returns readable string (1 ms)
    ‚úì buildSupplierPayload trims inputs and adds timestamps (4 ms)

PASS tests/spec/admin/F05-TP1-003_PersistSupplierRecord.spec.js
  SPEC F05-TP1-003: Persist supplier record
    ‚úì valid submission calls addDoc with trimmed payload and resets form (69 ms)

PASS tests/spec/admin/F05-TP1-002_RejectDuplicateSupplierNames.spec.js
  SPEC F05-TP1-002: Reject duplicate supplier names
    ‚úì duplicate names (case-insensitive) are blocked with warning (89 ms)

PASS tests/unit/customers/F07-TP3-001_NormalizeLookupQuery.test.js
  UNIT F07-TP3 normalizeLookupQuery helper
    ‚úì trims, collapses whitespace, lowercases, and drops short inputs (14 ms)

PASS tests/spec/admin/F05-TP4-003_RequireValidSupplierOnEdit.spec.js
  SPEC F05-TP4-003: Require valid supplier when saving edits
    ‚úì empty supplier selection blocks save with inline message (212 ms)

PASS tests/spec/admin/F08-TP2-003_SaleLineAddsRowWithSnapshot.spec.js
  SPEC F08-TP2-003: Sale line adds row with supplier snapshot
    ‚úì valid book + price appends row and notifies consumer with normalized payload (343 ms)

PASS tests/unit/editor/TP2-004_PersistsPurchasePriceUpdate.test.js
  UNIT TP2-004: Persist purchase price edits to Firestore
    ‚úì updateDoc receives purchasePrice as a number when submission passes validation (181 ms)

PASS tests/spec/admin/F05-TP4-001_EditDialogShowsSupplierSelect.spec.js
  SPEC F05-TP4-001: Edit dialog supplier select
    ‚úì Edit Book dialog contains supplier dropdown with placeholder (1020 ms)

PASS tests/spec/admin/F05-TP2-001_InlineEditPrefillsSupplier.spec.js
  SPEC F05-TP2-001: Inline edit pre-fills supplier
    ‚úì clicking edit populates the form with supplier values and sets edit mode (711 ms)
    ‚úì cancel button exits edit mode and clears hidden id (240 ms)

PASS tests/spec/admin/F09-TP8-002_RejectNegativeSellingPrice.spec.js
  SPEC F09-TP8-002: Selling price rejects negative values with positive-number guidance
    ‚úì submitting a negative price shows positive-number validation and does not add the line (424 ms)

PASS tests/spec/admin/F05-TP4-002_PersistSupplierChange.spec.js
  SPEC F05-TP4-002: Persist supplier change from edit dialog
    ‚úì submitting edit with a different supplier updates Firestore payload (357 ms)

PASS tests/unit/inventory/TP3-002_SoldPurchasePriceElement.test.js
  UNIT TP3-002: Sold rows keep purchase price element
    ‚úì sold list row includes .purchase-price with rupee amount (228 ms)

PASS tests/spec/public/TP4-003_PurchaseMessageHidesPurchasePrice.spec.js
  SPEC TP4-003: WhatsApp message hides purchase price
    ‚úì purchaseMessage ignores purchasePrice field entirely (15 ms)

PASS tests/spec/admin/TP2-003_RejectsNegativePurchasePrice.spec.js
  SPEC TP2-003: Reject negative purchase price on edit
    ‚úì prevents update when a negative purchase price is submitted (146 ms)

PASS tests/spec/admin/F09-TP6-002_ButtonOpensSalePanel.spec.js
  SPEC F09-TP5-002: Record sale button opens the sale panel
    ‚úì clicking the button opens the panel, scrolls it into view, and focuses the sale header date input (26 ms)

---------------------------|---------|----------|---------|---------|---------------------------------------------------------------------------------------------------------------------------------------------
File                       | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s                                                                                                                           
---------------------------|---------|----------|---------|---------|---------------------------------------------------------------------------------------------------------------------------------------------
<<<<<<< Updated upstream:codex_output/reports/F11-TP1_red.txt
All files                  |   55.33 |    43.11 |   54.58 |   57.99 |                                                                                                                                             
=======
All files                  |   52.36 |    41.39 |   50.11 |   54.82 |                                                                                                                                             
>>>>>>> Stashed changes:codex_output/reports/F10-TP1_red.txt
 auth.js                   |       0 |        0 |       0 |       0 | 24-79                                                                                                                                       
 autoPrice.js              |       0 |        0 |       0 |       0 | 2-25                                                                                                                                        
 currency.js               |     100 |     64.7 |     100 |     100 | 5,7,12,17-24,30                                                                                                                             
 customerLookup.js         |   76.74 |    54.83 |   79.48 |   83.62 | 17-18,52-58,135-141,184,244-245,275-277,292,310-314,321,335,341-345,354-355,361-362                                                         
 customers.js              |   78.78 |    50.85 |   78.94 |    83.6 | 8-9,26-27,74-82,133,168,187,277-281,289-290,295-297,322-323,346,356-357,368,380,393,411-415,437-438,499-502                                 
 editor.js                 |   70.79 |    68.24 |   73.07 |   72.55 | 46-47,53,93,122-151,155,185,192,199,339,353-371,378-395                                                                                     
<<<<<<< Updated upstream:codex_output/reports/F11-TP1_red.txt
 inventory.js              |   76.19 |    55.36 |   81.57 |   76.99 | 59,119-169,199,221,255-258,332-336,351-352,370,425,430,436-439                                                                              
 lookup.js                 |       0 |        0 |       0 |       0 | 11-483                                                                                                                                      
 main.js                   |       0 |        0 |       0 |       0 | 35-730                                                                                                                                      
=======
 inventory.js              |   62.44 |    44.75 |   63.88 |   61.71 | 60,67,120-170,181-191,212,234,268-271,345-349,364-365,381,384,434-474,482-487                                                               
 lookup.js                 |       0 |        0 |       0 |       0 | 11-483                                                                                                                                      
 main.js                   |       0 |        0 |       0 |       0 | 35-741                                                                                                                                      
>>>>>>> Stashed changes:codex_output/reports/F10-TP1_red.txt
 requests.js               |       0 |        0 |       0 |       0 | 6-73                                                                                                                                        
 salesEntryLauncher.js     |   85.71 |       56 |   71.42 |   85.71 | 8-11,30,41-42                                                                                                                               
 salesHeader.js            |    70.3 |    56.72 |   70.83 |   73.49 | 30-33,40,86-87,94-102,136-137,146-153,165,173-198,207-211,231-242,249-252,283-287,298,322,373,380,385,418,446,461,464,467,480,483,499,504   
 salesLineItems.js         |   82.05 |    61.58 |   75.34 |   85.28 | 23-26,38-40,105-106,128-139,147-150,168,198,204-221,246-247,260,271,307,339-341,449-450,464-466,482-483,580,630,660,668-678,689,700-708,745 
 salesPersist.js           |       0 |        0 |       0 |       0 | 1-164                                                                                                                                       
 salesTitleAutocomplete.js |   52.71 |    45.65 |   66.66 |    53.6 | 18-21,25,45-58,68-76,85-87,97-99,105-106,125-127,136-137,147,161-190                                                                        
 suppliers.js              |   81.64 |    57.37 |   85.18 |   86.48 | 15,116-117,136-138,149-151,177-178,190-191,221-224,254-258,267,273-274,295-302                                                              
---------------------------|---------|----------|---------|---------|---------------------------------------------------------------------------------------------------------------------------------------------
Summary of all failing tests
FAIL tests/spec/admin/F10-TP1-003_AnnounceFilteredResults.spec.js
  ‚óè SPEC F10-TP1-003: Announce filtered results from the Available header search ‚Ä∫ qualifying query announces the filtered count inside the panel

    expect(received).toBe(expected) // Object.is equality

    Expected: "Filtered 1 results for 'astro'"
    Received: ""

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [0m
        [0m
        [36m<details[39m
          [33mid[39m=[32m"availableBooksPanel"[39m
          [33mopen[39m=[32m""[39m
        [36m>[39m
          [0m
          [0m
          [36m<summary>[39m
            [0m
            [0m
            [36m<div[39m
              [33mclass[39m=[32m"available-summary"[39m
            [36m>[39m
              [0m
              [0m
              [36m<strong>[39m
                [0mAvailable[0m
              [36m</strong>[39m
              [0m
              [0m
              [36m<label[39m
                [33mclass[39m=[32m"sr-only"[39m
                [33mfor[39m=[32m"availableSearchInput"[39m
                [33mid[39m=[32m"availableSearchLabel"[39m
              [36m>[39m
                [0m
                Search available books
              [0m
              [36m</label>[39m
              [0m
              [0m
              [36m<input[39m
                [33maria-labelledby[39m=[32m"availableSearchLabel"[39m
                [33mid[39m=[32m"availableSearchInput"[39m
                [33mplaceholder[39m=[32m"Search title or author"[39m
                [33mtype[39m=[32m"search"[39m
              [36m/>[39m
              [0m
            [0m
            [36m</div>[39m
            [0m
          [0m
          [36m</summary>[39m
          [0m
          [0m
          [36m<p[39m
            [33maria-live[39m=[32m"polite"[39m
            [33mclass[39m=[32m"sr-only"[39m
            [33mid[39m=[32m"inventorySearchStatus"[39m
          [36m/>[39m
          [0m
          [0m
          [36m<div[39m
            [33mid[39m=[32m"availList"[39m
          [36m>[39m
            [0m
    [0m
            [36m<article[39m
              [33mclass[39m=[32m"row"[39m
              [33mdata-id[39m=[32m"astro"[39m
            [36m>[39m
              [0m
      [0m
              [36m<img[39m
                [33malt[39m=[32m""[39m
                [33msrc[39m=[32m"./assets/placeholder.webp"[39m
              [36m/>[39m
              [0m
      [0m
              [36m<div[39m
                [33mclass[39m=[32m"row-meta"[39m
              [36m>[39m
                [0m
        [0m
                [36m<strong>[39m
                  [0mAstrophysics 101[0m
                [36m</strong>[39m
                [0m
        [0m
                [36m<div[39m
                  [33mclass[39m=[32m"muted"[39m
                [36m>[39m
                  [0m
          Neil D. ¬∑ Science ¬∑ Paperback
        [0m
                [36m</div>[39m
                [0m
        [0m
                [36m<div[39m
                  [33mclass[39m=[32m"purchase-price muted"[39m
                [36m>[39m
                  [0mPurchase price: Not set[0m
                [36m</div>[39m
                [0m
      [0m
              [36m</div>[39m
              [0m
      [0m
              [36m<div[39m
                [33mclass[39m=[32m"row-actions"[39m
              [36m>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn"[39m
                  [33mdata-action[39m=[32m"feature"[39m
                [36m>[39m
                  [0mFeature[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn btn-secondary"[39m
                  [33mdata-action[39m=[32m"edit"[39m
                [36m>[39m
                  [0mEdit[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn"[39m
                  [33mdata-action[39m=[32m"sold"[39m
                [36m>[39m
                  [0mMark sold[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn btn-danger"[39m
                  [33mdata-action[39m=[32m"delete"[39m
                [36m>[39m
                  [0mDelete[0m
                [36m</button>[39m
                [0m
      [0m
              [36m</div>[39m
              [0m
    [0m
            [36m</article>[39m
            [0m
    [0m
            [36m<article[39m
              [33mclass[39m=[32m"row"[39m
              [33mdata-id[39m=[32m"poetry"[39m
            [36m>[39m
              [0m
      [0m
              [36m<img[39m
                [33malt[39m=[32m""[39m
                [33msrc[39m=[32m"./assets/placeholder.webp"[39m
              [36m/>[39m
              [0m
      [0m
              [36m<div[39m
                [33mclass[39m=[32m"row-meta"[39m
              [36m>[39m
                [0m
        [0m
                [36m<strong>[39m
                  [0mPoems of the Sun[0m
                [36m</strong>[39m
                [0m
        [0m
                [36m<div[39m
                  [33mclass[39m=[32m"muted"[39m
                [36m>[39m
                  [0m
          A. Ray ¬∑ Poetry ¬∑ Hardcover
        [0m
                [36m</div>[39m
                [0m
        [0m
                [36m<div[39m
                  [33mclass[39m=[32m"purchase-price muted"[39m
                [36m>[39m
                  [0mPurchase price: Not set[0m
                [36m</div>[39m
                [0m
      [0m
              [36m</div>[39m
              [0m
      [0m
              [36m<div[39m
                [33mclass[39m=[32m"row-actions"[39m
              [36m>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn"[39m
                  [33mdata-action[39m=[32m"feature"[39m
                [36m>[39m
                  [0mFeature[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn btn-secondary"[39m
                  [33mdata-action[39m=[32m"edit"[39m
                [36m>[39m
                  [0mEdit[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn"[39m
                  [33mdata-action[39m=[32m"sold"[39m
                [36m>[39m
                  [0mMark sold[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn btn-danger"[39m
                  [33mdata-action[39m=[32m"delete"[39m
                [36m>[39m
                  [0mDelete[0m
                [36m</button>[39m
                [0m
      [0m
              [36m</div>[39m
              [0m
    [0m
            [36m</article>[39m
          [36m</div>[39m
          [0m
        [0m
        [36m</details>[39m
        [0m
        [0m
        [36m<details[39m
          [33mid[39m=[32m"soldBooksPanel"[39m
        [36m>[39m
          [0m
          [0m
          [36m<summary>[39m
            [0mSold[0m
          [36m</summary>[39m
          [0m
          [0m
          [36m<div[39m
            [33mid[39m=[32m"soldList"[39m
          [36m>[39m
            [36m<p[39m
              [33mclass[39m=[32m"muted"[39m
            [36m>[39m
              [0mNo sold books.[0m
            [36m</p>[39m
          [36m</div>[39m
          [0m
        [0m
        [36m</details>[39m
        [0m
      [0m
      [36m</body>[39m
    [36m</html>[39m

      28 |
      29 |     await waitFor(() => {
    > 30 |       expect(harness.searchStatus.textContent.trim()).toBe(
         |                                                       ^
      31 |         "Filtered 1 results for 'astro'"
      32 |       );
      33 |     });

      at tests/spec/admin/F10-TP1-003_AnnounceFilteredResults.spec.js:30:55
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:579:19)

FAIL tests/spec/admin/F10-TP1-002_IgnoreShortQueries.spec.js
  ‚óè SPEC F10-TP1-002: Ignore short header search queries ‚Ä∫ dropping below two characters restores the full list without announcements

    expect(received).toHaveLength(expected)

    Expected length: 1
    Received length: 2
    Received object: [<article class="row" data-id="astro">
      <img alt="" src="./assets/placeholder.webp" />
      <div class="row-meta">
        <strong>Astrophysics 101</strong>
        <div class="muted">
          Neil D. ¬∑ Science ¬∑ Paperback
        </div>
        <div class="purchase-price muted">Purchase price: Not set</div>
      </div>
      <div class="row-actions">
        <button class="btn" data-action="feature">Feature</button>
        <button class="btn btn-secondary" data-action="edit">Edit</button>
        <button class="btn" data-action="sold">Mark sold</button>
        <button class="btn btn-danger" data-action="delete">Delete</button>
      </div>
    </article>, <article class="row" data-id="poetry">
      <img alt="" src="./assets/placeholder.webp" />
      <div class="row-meta">
        <strong>Poems of the Sun</strong>
        <div class="muted">
          A. Ray ¬∑ Poetry ¬∑ Hardcover
        </div>
        <div class="purchase-price muted">Purchase price: Not set</div>
      </div>
      <div class="row-actions">
        <button class="btn" data-action="feature">Feature</button>
        <button class="btn btn-secondary" data-action="edit">Edit</button>
        <button class="btn" data-action="sold">Mark sold</button>
        <button class="btn btn-danger" data-action="delete">Delete</button>
      </div>
    </article>]

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [0m
        [0m
        [36m<details[39m
          [33mid[39m=[32m"availableBooksPanel"[39m
          [33mopen[39m=[32m""[39m
        [36m>[39m
          [0m
          [0m
          [36m<summary>[39m
            [0m
            [0m
            [36m<div[39m
              [33mclass[39m=[32m"available-summary"[39m
            [36m>[39m
              [0m
              [0m
              [36m<strong>[39m
                [0mAvailable[0m
              [36m</strong>[39m
              [0m
              [0m
              [36m<label[39m
                [33mclass[39m=[32m"sr-only"[39m
                [33mfor[39m=[32m"availableSearchInput"[39m
                [33mid[39m=[32m"availableSearchLabel"[39m
              [36m>[39m
                [0m
                Search available books
              [0m
              [36m</label>[39m
              [0m
              [0m
              [36m<input[39m
                [33maria-labelledby[39m=[32m"availableSearchLabel"[39m
                [33mid[39m=[32m"availableSearchInput"[39m
                [33mplaceholder[39m=[32m"Search title or author"[39m
                [33mtype[39m=[32m"search"[39m
              [36m/>[39m
              [0m
            [0m
            [36m</div>[39m
            [0m
          [0m
          [36m</summary>[39m
          [0m
          [0m
          [36m<p[39m
            [33maria-live[39m=[32m"polite"[39m
            [33mclass[39m=[32m"sr-only"[39m
            [33mid[39m=[32m"inventorySearchStatus"[39m
          [36m/>[39m
          [0m
          [0m
          [36m<div[39m
            [33mid[39m=[32m"availList"[39m
          [36m>[39m
            [0m
    [0m
            [36m<article[39m
              [33mclass[39m=[32m"row"[39m
              [33mdata-id[39m=[32m"astro"[39m
            [36m>[39m
              [0m
      [0m
              [36m<img[39m
                [33malt[39m=[32m""[39m
                [33msrc[39m=[32m"./assets/placeholder.webp"[39m
              [36m/>[39m
              [0m
      [0m
              [36m<div[39m
                [33mclass[39m=[32m"row-meta"[39m
              [36m>[39m
                [0m
        [0m
                [36m<strong>[39m
                  [0mAstrophysics 101[0m
                [36m</strong>[39m
                [0m
        [0m
                [36m<div[39m
                  [33mclass[39m=[32m"muted"[39m
                [36m>[39m
                  [0m
          Neil D. ¬∑ Science ¬∑ Paperback
        [0m
                [36m</div>[39m
                [0m
        [0m
                [36m<div[39m
                  [33mclass[39m=[32m"purchase-price muted"[39m
                [36m>[39m
                  [0mPurchase price: Not set[0m
                [36m</div>[39m
                [0m
      [0m
              [36m</div>[39m
              [0m
      [0m
              [36m<div[39m
                [33mclass[39m=[32m"row-actions"[39m
              [36m>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn"[39m
                  [33mdata-action[39m=[32m"feature"[39m
                [36m>[39m
                  [0mFeature[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn btn-secondary"[39m
                  [33mdata-action[39m=[32m"edit"[39m
                [36m>[39m
                  [0mEdit[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn"[39m
                  [33mdata-action[39m=[32m"sold"[39m
                [36m>[39m
                  [0mMark sold[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn btn-danger"[39m
                  [33mdata-action[39m=[32m"delete"[39m
                [36m>[39m
                  [0mDelete[0m
                [36m</button>[39m
                [0m
      [0m
              [36m</div>[39m
              [0m
    [0m
            [36m</article>[39m
            [0m
    [0m
            [36m<article[39m
              [33mclass[39m=[32m"row"[39m
              [33mdata-id[39m=[32m"poetry"[39m
            [36m>[39m
              [0m
      [0m
              [36m<img[39m
                [33malt[39m=[32m""[39m
                [33msrc[39m=[32m"./assets/placeholder.webp"[39m
              [36m/>[39m
              [0m
      [0m
              [36m<div[39m
                [33mclass[39m=[32m"row-meta"[39m
              [36m>[39m
                [0m
        [0m
                [36m<strong>[39m
                  [0mPoems of the Sun[0m
                [36m</strong>[39m
                [0m
        [0m
                [36m<div[39m
                  [33mclass[39m=[32m"muted"[39m
                [36m>[39m
                  [0m
          A. Ray ¬∑ Poetry ¬∑ Hardcover
        [0m
                [36m</div>[39m
                [0m
        [0m
                [36m<div[39m
                  [33mclass[39m=[32m"purchase-price muted"[39m
                [36m>[39m
                  [0mPurchase price: Not set[0m
                [36m</div>[39m
                [0m
      [0m
              [36m</div>[39m
              [0m
      [0m
              [36m<div[39m
                [33mclass[39m=[32m"row-actions"[39m
              [36m>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn"[39m
                  [33mdata-action[39m=[32m"feature"[39m
                [36m>[39m
                  [0mFeature[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn btn-secondary"[39m
                  [33mdata-action[39m=[32m"edit"[39m
                [36m>[39m
                  [0mEdit[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn"[39m
                  [33mdata-action[39m=[32m"sold"[39m
                [36m>[39m
                  [0mMark sold[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn btn-danger"[39m
                  [33mdata-action[39m=[32m"delete"[39m
                [36m>[39m
                  [0mDelete[0m
                [36m</button>[39m
                [0m
      [0m
              [36m</div>[39m
              [0m
    [0m
            [36m</article>[39m
          [36m</div>[39m
          [0m
        [0m
        [36m</details>[39m
        [0m
        [0m
        [36m<details[39m
          [33mid[39m=[32m"soldBooksPanel"[39m
        [36m>[39m
          [0m
          [0m
          [36m<summary>[39m
            [0mSold[0m
          [36m</summary>[39m
          [0m
          [0m
          [36m<div[39m
            [33mid[39m=[32m"soldList"[39m
          [36m>[39m
            [36m<p[39m
              [33mclass[39m=[32m"muted"[39m
            [36m>[39m
              [0mNo sold books.[0m
            [36m</p>[39m
          [36m</div>[39m
          [0m
        [0m
        [36m</details>[39m
        [0m
      [0m
      [36m</body>[39m
    [36m</html>[39m

      26 |
      27 |     await waitFor(() => {
    > 28 |       expect(harness.availList.querySelectorAll('.row')).toHaveLength(1);
         |                                                          ^
      29 |     });
      30 |
      31 |     harness.availableSearchInput.value = 's';

      at tests/spec/admin/F10-TP1-002_IgnoreShortQueries.spec.js:28:58
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:579:19)

FAIL tests/spec/admin/F10-TP1-001_HeaderSearchFiltersAvailable.spec.js
  ‚óè SPEC F10-TP1-001: Header search filters Available list in place ‚Ä∫ typing a qualifying query in the header re-renders availList with only matches

    expect(received).toHaveLength(expected)

    Expected length: 1
    Received length: 3
    Received object: [<article class="row" data-id="astro">
      <img alt="" src="./assets/placeholder.webp" />
      <div class="row-meta">
        <strong>Astrophysics 101</strong>
        <div class="muted">
          Neil D. ¬∑ Science ¬∑ Paperback
        </div>
        <div class="purchase-price muted">Purchase price: Not set</div>
      </div>
      <div class="row-actions">
        <button class="btn" data-action="feature">Feature</button>
        <button class="btn btn-secondary" data-action="edit">Edit</button>
        <button class="btn" data-action="sold">Mark sold</button>
        <button class="btn btn-danger" data-action="delete">Delete</button>
      </div>
    </article>, <article class="row" data-id="poetry">
      <img alt="" src="./assets/placeholder.webp" />
      <div class="row-meta">
        <strong>Poems of the Sun</strong>
        <div class="muted">
          A. Ray ¬∑ Poetry ¬∑ Hardcover
        </div>
        <div class="purchase-price muted">Purchase price: Not set</div>
      </div>
      <div class="row-actions">
        <button class="btn" data-action="feature">Feature</button>
        <button class="btn btn-secondary" data-action="edit">Edit</button>
        <button class="btn" data-action="sold">Mark sold</button>
        <button class="btn btn-danger" data-action="delete">Delete</button>
      </div>
    </article>, <article class="row" data-id="history">
      <img alt="" src="./assets/placeholder.webp" />
      <div class="row-meta">
        <strong>World History Digest</strong>
        <div class="muted">
          N. Scholar ¬∑ History ¬∑ Paperback
        </div>
        <div class="purchase-price muted">Purchase price: Not set</div>
      </div>
      <div class="row-actions">
        <button class="btn" data-action="feature">Feature</button>
        <button class="btn btn-secondary" data-action="edit">Edit</button>
        <button class="btn" data-action="sold">Mark sold</button>
        <button class="btn btn-danger" data-action="delete">Delete</button>
      </div>
    </article>]

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [0m
        [0m
        [36m<details[39m
          [33mid[39m=[32m"availableBooksPanel"[39m
          [33mopen[39m=[32m""[39m
        [36m>[39m
          [0m
          [0m
          [36m<summary>[39m
            [0m
            [0m
            [36m<div[39m
              [33mclass[39m=[32m"available-summary"[39m
            [36m>[39m
              [0m
              [0m
              [36m<strong>[39m
                [0mAvailable[0m
              [36m</strong>[39m
              [0m
              [0m
              [36m<label[39m
                [33mclass[39m=[32m"sr-only"[39m
                [33mfor[39m=[32m"availableSearchInput"[39m
                [33mid[39m=[32m"availableSearchLabel"[39m
              [36m>[39m
                [0m
                Search available books
              [0m
              [36m</label>[39m
              [0m
              [0m
              [36m<input[39m
                [33maria-labelledby[39m=[32m"availableSearchLabel"[39m
                [33mid[39m=[32m"availableSearchInput"[39m
                [33mplaceholder[39m=[32m"Search title or author"[39m
                [33mtype[39m=[32m"search"[39m
              [36m/>[39m
              [0m
            [0m
            [36m</div>[39m
            [0m
          [0m
          [36m</summary>[39m
          [0m
          [0m
          [36m<p[39m
            [33maria-live[39m=[32m"polite"[39m
            [33mclass[39m=[32m"sr-only"[39m
            [33mid[39m=[32m"inventorySearchStatus"[39m
          [36m/>[39m
          [0m
          [0m
          [36m<div[39m
            [33mid[39m=[32m"availList"[39m
          [36m>[39m
            [0m
    [0m
            [36m<article[39m
              [33mclass[39m=[32m"row"[39m
              [33mdata-id[39m=[32m"astro"[39m
            [36m>[39m
              [0m
      [0m
              [36m<img[39m
                [33malt[39m=[32m""[39m
                [33msrc[39m=[32m"./assets/placeholder.webp"[39m
              [36m/>[39m
              [0m
      [0m
              [36m<div[39m
                [33mclass[39m=[32m"row-meta"[39m
              [36m>[39m
                [0m
        [0m
                [36m<strong>[39m
                  [0mAstrophysics 101[0m
                [36m</strong>[39m
                [0m
        [0m
                [36m<div[39m
                  [33mclass[39m=[32m"muted"[39m
                [36m>[39m
                  [0m
          Neil D. ¬∑ Science ¬∑ Paperback
        [0m
                [36m</div>[39m
                [0m
        [0m
                [36m<div[39m
                  [33mclass[39m=[32m"purchase-price muted"[39m
                [36m>[39m
                  [0mPurchase price: Not set[0m
                [36m</div>[39m
                [0m
      [0m
              [36m</div>[39m
              [0m
      [0m
              [36m<div[39m
                [33mclass[39m=[32m"row-actions"[39m
              [36m>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn"[39m
                  [33mdata-action[39m=[32m"feature"[39m
                [36m>[39m
                  [0mFeature[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn btn-secondary"[39m
                  [33mdata-action[39m=[32m"edit"[39m
                [36m>[39m
                  [0mEdit[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn"[39m
                  [33mdata-action[39m=[32m"sold"[39m
                [36m>[39m
                  [0mMark sold[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn btn-danger"[39m
                  [33mdata-action[39m=[32m"delete"[39m
                [36m>[39m
                  [0mDelete[0m
                [36m</button>[39m
                [0m
      [0m
              [36m</div>[39m
              [0m
    [0m
            [36m</article>[39m
            [0m
    [0m
            [36m<article[39m
              [33mclass[39m=[32m"row"[39m
              [33mdata-id[39m=[32m"poetry"[39m
            [36m>[39m
              [0m
      [0m
              [36m<img[39m
                [33malt[39m=[32m""[39m
                [33msrc[39m=[32m"./assets/placeholder.webp"[39m
              [36m/>[39m
              [0m
      [0m
              [36m<div[39m
                [33mclass[39m=[32m"row-meta"[39m
              [36m>[39m
                [0m
        [0m
                [36m<strong>[39m
                  [0mPoems of the Sun[0m
                [36m</strong>[39m
                [0m
        [0m
                [36m<div[39m
                  [33mclass[39m=[32m"muted"[39m
                [36m>[39m
                  [0m
          A. Ray ¬∑ Poetry ¬∑ Hardcover
        [0m
                [36m</div>[39m
                [0m
        [0m
                [36m<div[39m
                  [33mclass[39m=[32m"purchase-price muted"[39m
                [36m>[39m
                  [0mPurchase price: Not set[0m
                [36m</div>[39m
                [0m
      [0m
              [36m</div>[39m
              [0m
      [0m
              [36m<div[39m
                [33mclass[39m=[32m"row-actions"[39m
              [36m>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn"[39m
                  [33mdata-action[39m=[32m"feature"[39m
                [36m>[39m
                  [0mFeature[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn btn-secondary"[39m
                  [33mdata-action[39m=[32m"edit"[39m
                [36m>[39m
                  [0mEdit[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn"[39m
                  [33mdata-action[39m=[32m"sold"[39m
                [36m>[39m
                  [0mMark sold[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn btn-danger"[39m
                  [33mdata-action[39m=[32m"delete"[39m
                [36m>[39m
                  [0mDelete[0m
                [36m</button>[39m
                [0m
      [0m
              [36m</div>[39m
              [0m
    [0m
            [36m</article>[39m
            [0m
    [0m
            [36m<article[39m
              [33mclass[39m=[32m"row"[39m
              [33mdata-id[39m=[32m"history"[39m
            [36m>[39m
              [0m
      [0m
              [36m<img[39m
                [33malt[39m=[32m""[39m
                [33msrc[39m=[32m"./assets/placeholder.webp"[39m
              [36m/>[39m
              [0m
      [0m
              [36m<div[39m
                [33mclass[39m=[32m"row-meta"[39m
              [36m>[39m
                [0m
        [0m
                [36m<strong>[39m
                  [0mWorld History Digest[0m
                [36m</strong>[39m
                [0m
        [0m
                [36m<div[39m
                  [33mclass[39m=[32m"muted"[39m
                [36m>[39m
                  [0m
          N. Scholar ¬∑ History ¬∑ Paperback
        [0m
                [36m</div>[39m
                [0m
        [0m
                [36m<div[39m
                  [33mclass[39m=[32m"purchase-price muted"[39m
                [36m>[39m
                  [0mPurchase price: Not set[0m
                [36m</div>[39m
                [0m
      [0m
              [36m</div>[39m
              [0m
      [0m
              [36m<div[39m
                [33mclass[39m=[32m"row-actions"[39m
              [36m>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn"[39m
                  [33mdata-action[39m=[32m"feature"[39m
                [36m>[39m
                  [0mFeature[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn btn-secondary"[39m
                  [33mdata-action[39m=[32m"edit"[39m
                [36m>[39m
                  [0mEdit[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn"[39m
                  [33mdata-action[39m=[32m"sold"[39m
                [36m>[39m
                  [0mMark sold[0m
                [36m</button>[39m
                [0m
        [0m
                [36m<button[39m
                  [33mclass[39m=[32m"btn btn-danger"[39m
                  [33mdata-action[39m=[32m"delete"[39m
                [36m>[39m
                  [0mDelete[0m
                [36m</button>[39m
                [0m
      [0m
              [36m</div>[39m
              [0m
    [0m
            [36m</article>[39m
          [36m</div>[39m
          [0m
        [0m
        [36m</details>[39m
        [0m
        [0m
        [36m<details[39m
          [33mid[39m=[32m"soldBooksPanel"[39m
        [36m>[39m
          [0m
          [0m
          [36m<summary>[39m
            [0mSold[0m
          [36m</summary>[39m
          [0m
          [0m
          [36m<div[39m
            [33mid[39m=[32m"soldList"[39m
          [36m>[39m
            [36m<p[39m
              [33mclass[39m=[32m"muted"[39m
            [36m>[39m
              [0mNo sold books.[0m
            [36m</p>[39m
          [36m</div>[39m
          [0m
        [0m
        [36m</details>[39m
        [0m
      [0m
      [36m</body>[39m
    [36m</html>[39m

      35 |
      36 |     await waitFor(() => {
    > 37 |       expect(harness.availList.querySelectorAll('.row')).toHaveLength(1);
         |                                                          ^
      38 |     });
      39 |     expect(harness.availList.textContent).toContain('Astrophysics 101');
      40 |   });

      at tests/spec/admin/F10-TP1-001_HeaderSearchFiltersAvailable.spec.js:37:58
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:579:19)


Test Suites: 3 failed, 1 skipped, 88 passed, 91 of 92 total
Tests:       3 failed, 1 skipped, 102 passed, 106 total
Snapshots:   0 total
Time:        22.551 s, estimated 26 s
Ran all test suites.
