
> test
> cross-env NODE_OPTIONS=--experimental-vm-modules jest --watchAll=false

(node:72163) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
FAIL tests/spec/admin/TP3-001_AvailableRowShowsPurchasePrice.spec.js
  SPEC TP3-001: Available list shows purchase price
    ✕ renders purchase price text with rupee value for available rows (21 ms)

  ● SPEC TP3-001: Available list shows purchase price › renders purchase price text with rupee value for available rows

    expect(received).toContain(expected) // indexOf

    Expected substring: "purchase price:"
    Received string:    "·······
        test title·····
          author · fiction · paperback · ₹799 · mrp ₹999 · isbn 1234567890···········
        feature
        edit
        mark sold
        delete···
    "

      20 |
      21 |     const text = harness.availList.textContent;
    > 22 |     expect(text.toLowerCase()).toContain('purchase price:');
         |                                ^
      23 |     expect(text).toContain('₹650');
      24 |   });
      25 | });

      at Object.<anonymous> (tests/spec/admin/TP3-001_AvailableRowShowsPurchasePrice.spec.js:22:32)

FAIL tests/spec/admin/TP3-002_SoldRowShowsPurchasePrice.spec.js
  SPEC TP3-002: Sold list also shows purchase price
    ✕ sold rows mirror the purchase price label (7 ms)

  ● SPEC TP3-002: Sold list also shows purchase price › sold rows mirror the purchase price label

    expect(received).toContain(expected) // indexOf

    Expected substring: "purchase price:"
    Received string:    "·······
        sold title·····
          writer · non-fiction · hardcover · ₹950 · mrp ₹1200 · isbn 9988776655···········
        feature
        edit
        mark available
        delete···
    "

      20 |
      21 |     const text = harness.soldList.textContent;
    > 22 |     expect(text.toLowerCase()).toContain('purchase price:');
         |                                ^
      23 |     expect(text).toContain('₹820');
      24 |   });
      25 | });

      at Object.<anonymous> (tests/spec/admin/TP3-002_SoldRowShowsPurchasePrice.spec.js:22:32)

FAIL tests/unit/inventory/TP3-001_PurchasePriceElement.test.js
  UNIT TP3-001: Purchase price element exists for available rows
    ✕ available row contains .purchase-price element with rupee value (7 ms)

  ● UNIT TP3-001: Purchase price element exists for available rows › available row contains .purchase-price element with rupee value

    expect(received).not.toBeNull()

    Received: null

      17 |
      18 |     const el = harness.availList.querySelector('.purchase-price');
    > 19 |     expect(el).not.toBeNull();
         |                    ^
      20 |     expect(el?.textContent).toContain('₹650');
      21 |   });
      22 | });

      at Object.<anonymous> (tests/unit/inventory/TP3-001_PurchasePriceElement.test.js:19:20)

FAIL tests/unit/inventory/TP3-003_PurchasePricePlaceholder.test.js
  UNIT TP3-003: Placeholder for missing purchase price
    ✕ renders descriptive placeholder text inside .purchase-price (8 ms)

  ● UNIT TP3-003: Placeholder for missing purchase price › renders descriptive placeholder text inside .purchase-price

    expect(received).not.toBeNull()

    Received: null

      16 |
      17 |     const el = harness.availList.querySelector('.purchase-price');
    > 18 |     expect(el).not.toBeNull();
         |                    ^
      19 |     expect(el?.textContent.toLowerCase()).toContain('purchase price: not set');
      20 |   });
      21 | });

      at Object.<anonymous> (tests/unit/inventory/TP3-003_PurchasePricePlaceholder.test.js:18:20)

FAIL tests/unit/inventory/TP3-002_SoldPurchasePriceElement.test.js
  UNIT TP3-002: Sold rows keep purchase price element
    ✕ sold list row includes .purchase-price with rupee amount (6 ms)

  ● UNIT TP3-002: Sold rows keep purchase price element › sold list row includes .purchase-price with rupee amount

    expect(received).not.toBeNull()

    Received: null

      17 |
      18 |     const el = harness.soldList.querySelector('.purchase-price');
    > 19 |     expect(el).not.toBeNull();
         |                    ^
      20 |     expect(el?.textContent).toContain('₹920');
      21 |   });
      22 | });

      at Object.<anonymous> (tests/unit/inventory/TP3-002_SoldPurchasePriceElement.test.js:19:20)

FAIL tests/unit/inventory/TP3-004_PurchasePriceFormatting.test.js
  UNIT TP3-004: Purchase price formatting helper
    ✕ text uses ₹ prefix with comma separators (6 ms)

  ● UNIT TP3-004: Purchase price formatting helper › text uses ₹ prefix with comma separators

    expect(received).not.toBeNull()

    Received: null

      17 |
      18 |     const el = harness.availList.querySelector('.purchase-price');
    > 19 |     expect(el).not.toBeNull();
         |                    ^
      20 |     expect(el?.textContent).toContain('₹43,210');
      21 |   });
      22 | });

      at Object.<anonymous> (tests/unit/inventory/TP3-004_PurchasePriceFormatting.test.js:19:20)

FAIL tests/spec/admin/TP3-003_ShowsPlaceholderWhenMissing.spec.js
  SPEC TP3-003: Placeholder when purchase price missing
    ✕ renders “Purchase price: not set” when value absent (5 ms)

  ● SPEC TP3-003: Placeholder when purchase price missing › renders “Purchase price: not set” when value absent

    expect(received).toContain(expected) // indexOf

    Expected substring: "purchase price: not set"
    Received string:    "·······
        mystery·····
          unknown · fiction · paperback · ₹300 · mrp ₹550···········
        feature
        edit
        mark sold
        delete···
    "

      18 |
      19 |     const text = harness.availList.textContent.toLowerCase();
    > 20 |     expect(text).toContain('purchase price: not set');
         |                  ^
      21 |   });
      22 | });
      23 |

      at Object.<anonymous> (tests/spec/admin/TP3-003_ShowsPlaceholderWhenMissing.spec.js:20:18)

FAIL tests/spec/admin/TP3-004_FormatsPurchasePrice.spec.js
  SPEC TP3-004: Purchase price formatting
    ✕ applies rupee prefix and thousand separators (6 ms)

  ● SPEC TP3-004: Purchase price formatting › applies rupee prefix and thousand separators

    expect(received).toContain(expected) // indexOf

    Expected substring: "₹12,500"
    Received string:    "·······
        Formatting 101·····
          Formatter · Reference · Paperback···········
        Feature
        Edit
        Mark sold
        Delete···
    "

      17 |
      18 |     const text = harness.availList.textContent;
    > 19 |     expect(text).toContain('₹12,500');
         |                  ^
      20 |   });
      21 | });
      22 |

      at Object.<anonymous> (tests/spec/admin/TP3-004_FormatsPurchasePrice.spec.js:19:18)

PASS tests/spec/admin/TP2-004_PersistsPurchasePriceUpdate.spec.js
  SPEC TP2-004: Persist edited purchase price
    ✓ sends numeric purchasePrice in the updateDoc payload when save succeeds (13 ms)

PASS tests/spec/admin/TP1-003_BlocksNonNumericPurchasePrice.spec.js
  SPEC TP1-003: Validation against non-numeric input
    ✓ prevents addDoc and surfaces an inline error (8 ms)

PASS tests/unit/editor/TP2-003_RejectsNegativePurchasePrice.test.js
  UNIT TP2-003: Prevent negative purchase price submissions
    ✓ negative numbers trigger an inline error and avoid updateDoc (6 ms)

PASS tests/unit/editor/TP2-002_RejectsNonNumericPurchasePrice.test.js
  UNIT TP2-002: Validate numeric purchase price on edit save
    ✓ non-numeric input keeps dialog open and skips updateDoc (8 ms)

PASS tests/spec/admin/TP2-002_RejectsNonNumericPurchasePrice.spec.js
  SPEC TP2-002: Reject non-numeric purchase price on edit
    ✓ blocks save and surfaces numeric guidance when value contains letters (8 ms)

PASS tests/spec/admin/TP2-003_RejectsNegativePurchasePrice.spec.js
  SPEC TP2-003: Reject negative purchase price on edit
    ✓ prevents update when a negative purchase price is submitted (7 ms)

PASS tests/spec/admin/TP2-001_EditFormShowsPurchasePrice.spec.js
  SPEC TP2-001: Edit form exposes purchase price field
    ✓ pre-fills purchase price input with stored value when opening edit dialog (4 ms)

PASS tests/spec/admin/TP1-002_PersistsPurchasePrice.spec.js
  SPEC TP1-002: Persist purchase price
    ✓ includes purchasePrice number in the addDoc payload (6 ms)

PASS tests/unit/editor/TP2-004_PersistsPurchasePriceUpdate.test.js
  UNIT TP2-004: Persist purchase price edits to Firestore
    ✓ updateDoc receives purchasePrice as a number when submission passes validation (6 ms)

PASS tests/unit/editor/TP2-001_EditFormShowsPurchasePrice.test.js
  UNIT TP2-001: Edit form mirrors existing purchase price
    ✓ open() copies stored purchasePrice (including zero) into the field value (5 ms)

PASS tests/spec/admin/TP1-004_BlocksNegativePurchasePrice.spec.js
  SPEC TP1-004: Validation against negative purchase price
    ✓ stops the submission when the value is below zero (7 ms)

PASS tests/spec/admin/TP1-001_AddFormShowsPurchasePrice.spec.js
  SPEC TP1-001: Purchase price field is visible
    ✓ add book form includes a numeric purchase price input (15 ms)

--------------|---------|----------|---------|---------|------------------------------------------------------
File          | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s                                    
--------------|---------|----------|---------|---------|------------------------------------------------------
All files     |   28.63 |    22.73 |      27 |   29.74 |                                                      
 auth.js      |       0 |        0 |       0 |       0 | 23-76                                                
 autoPrice.js |       0 |        0 |       0 |       0 | 2-25                                                 
 currency.js  |   91.66 |    58.82 |     100 |   91.66 | 9                                                    
 editor.js    |   62.19 |    66.03 |   53.33 |   63.69 | 46-47,53,78-107,111,122,127,248,262-280,287-304      
 inventory.js |    65.3 |    43.08 |      68 |   65.67 | 46-48,95-145,185-188,249-253,268-269,281,284,334-335 
 lookup.js    |       0 |        0 |       0 |       0 | 11-483                                               
 main.js      |       0 |        0 |       0 |       0 | 13-158                                               
 requests.js  |       0 |        0 |       0 |       0 | 6-73                                                 
--------------|---------|----------|---------|---------|------------------------------------------------------
Test Suites: 8 failed, 12 passed, 20 total
Tests:       8 failed, 12 passed, 20 total
Snapshots:   0 total
Time:        2.263 s
Ran all test suites.
