{"type":"fail","test":"tests/spec/admin/SBD-F26-TP1-001_SharedDiscountAcrossRoutes.spec.js"}
{"type":"fail","test":"tests/spec/admin/SBD-F26-TP1-002_SavePayloadSharedAcrossRoutes.spec.js"}
{"type":"fail","test":"tests/spec/admin/SBD-F26-TP1-003_OrderPreservedAcrossRoutes.spec.js"}
{"type":"spec","id":"SBD-F26-TP1-001","given":"Bundle \u2192 Create and Available \u2192 Add to bundle share a bundle composition controller with INR currency and a threshold of two books.","when":"A first book is added from one route and a second book is added from the other route.","then":"computeRecommendation fires once with both book selections, currency, and recommendationDiscountPct=25 and updates the shared recommended price state."}
{"type":"spec","id":"SBD-F26-TP1-002","given":"Two books have been selected and recommended pricing has been computed.","when":"Save is initiated from either Bundle \u2192 Create or Available \u2192 Add to bundle.","then":"saveBundle receives the same contract-shaped payload with ordered books, totals, and recommendedPriceMinor at 25% off total sale price regardless of route."}
{"type":"spec","id":"SBD-F26-TP1-003","given":"A bundle composition controller is mounted across both routes.","when":"One book is added from Available \u2192 Add to bundle and another from Bundle \u2192 Create, then Save is triggered.","then":"computeRecommendation stays gated until the second book and the saved document preserves the cross-route selection order with positions."}
{"type":"ui-anchor","selector":"#bundleRecommendedPrice"}
{"type":"ui-anchor","selector":"#inlineBundleRecommended"}
{"type":"ui-anchor","selector":"[data-test='bookAddToBundle']"}
{"type":"ui-anchor","selector":"[data-test='bundleCreateAddBook']"}
{"type":"js-handler","event":"click","selector":"[data-test='bookAddToBundle']","handler":"bundleCompositionController.addBook"}
{"type":"js-handler","event":"click","selector":"[data-test='bundleCreateAddBook']","handler":"bundleCompositionController.addBook"}
{"type":"adapter-call","function":"computeRecommendation","args":["bookSelections","currency","recommendationDiscountPct"]}
{"type":"adapter-call","function":"saveBundle","args":["bundleDocument"]}
{"type":"reuse","patternId":"BUNDLE_COMPOSITION_CONTRACT"}
{"type":"reuse","patternId":"BUNDLE_COMPOSITION_CONTROLLER"}
{"type":"pattern","patternId":"BUNDLE_COMPOSITION_CONTRACT","requiredParams":["currency","recommendationThreshold","recommendationDiscountPct"],"adapters":{},"testBehaviors":["recommendedPriceMinor uses shared 25% discount once two books are selected","books persist in selection order with positions from cross-route additions","recommended price stays null until threshold then emits recommendationComputedAt stamp"]}
{"type":"pattern","patternId":"BUNDLE_COMPOSITION_CONTROLLER","requiredParams":["currency","recommendationThreshold","recommendationDiscountPct","pricePrecision"],"adapters":{"computeRecommendation":"({ bookSelections: BookSelection[], currency: string, recommendationDiscountPct: number }) => Promise","saveBundle":"(bundleDocument) => Promise<{ bundleId: string }>","loadBundle":"(bundleId: string) => Promise<BundleDocument>","onStateChange":"(state) => void"},"testBehaviors":["Second selection fires computeRecommendation once with bookSelections from both routes","Save from either route sends the same bundleDocument with ordered books and recommendedPriceMinor","Recommendation stays gated until selection count reaches threshold"]}
