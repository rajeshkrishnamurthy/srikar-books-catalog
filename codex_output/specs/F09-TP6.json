{
  "topicId": "F09-TP6",
  "title": "Sale Panel Access and Visual Hierarchy",
  "area": "Admin / Inventory Header",
  "goal": "Add a primary Record sale entry point and restyle the sale panel with elevated inputs, sticky sections, and informative empty states.",
  "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
  "status": "GREEN",
  "specs": [
    {
      "id": "F09-TP6-002",
      "title": "ClickOpensSalePanel",
      "given": "The Record sale button is rendered but the sale panel is collapsed.",
      "when": "An admin clicks the button.",
      "then": "The panel opens (sets the `open` attribute), scrolls into view, and focuses the sale header date field so the F08/F09 workflow is ready immediately.",
      "test": "/tests/spec/admin/F09-TP6-002_ButtonOpensSalePanel.spec.js"
    },
    {
      "id": "F09-TP6-003",
      "title": "InitializeWorkflowOnce",
      "given": "The launcher wires up the sale header/line/persist modules.",
      "when": "The Record sale button is clicked multiple times.",
      "then": "The provided `startSaleWorkflow` (wrapping initSaleHeader/initSaleLineItems/etc.) runs only on the first activation so modules are not re-instantiated per click.",
      "test": "/tests/spec/admin/F09-TP6-003_LauncherInitializesWorkflowOnce.spec.js"
    },
    {
      "id": "F09-TP6-004",
      "title": "PreserveSearchContext",
      "given": "An admin has typed into `#adminSearch`.",
      "when": "They launch the Record sale flow using the header button.",
      "then": "The search field retains its value and the button's `aria-controls` attribute continues to target `saleEntryPanel`, ensuring no context loss for the inventory filter.",
      "test": "/tests/spec/admin/F09-TP6-004_SearchValuePreserved.spec.js"
    }
  ],
  "fixtures": [
    "/tests/fixtures/salesEntryLauncherHarness.js"
  ],
  "reports": {
    "red": "codex_output/reports/F09-TP6_red.txt",
    "green": "codex_output/reports/F09-TP6_green.txt"
  },
  "validation": {
    "command": "npm test -- --watchAll=false --runTestsByPath tests/spec/admin/F09-TP6-001_RecordSaleButtonInHeader.spec.js tests/spec/admin/F09-TP6-002_ButtonOpensSalePanel.spec.js tests/spec/admin/F09-TP6-003_LauncherInitializesWorkflowOnce.spec.js tests/spec/admin/F09-TP6-004_SearchValuePreserved.spec.js",
    "status": "GREEN",
    "report": "codex_output/reports/F09-TP6_green.txt",
    "summary": {
      "result": "passed",
      "details": "Record-sale launcher button, panel focus, single-init guard, and search-preservation tests all green (see codex_output/reports/F09-TP6_green.txt)."
    }
  },
  "changedFiles": [
    "admin.html",
    "scripts/admin/main.js",
    "scripts/admin/salesEntryLauncher.js",
    "tests/fixtures/salesEntryLauncherHarness.js",
    "tests/spec/admin/F09-TP6-002_ButtonOpensSalePanel.spec.js",
    "tests/spec/admin/F09-TP6-003_LauncherInitializesWorkflowOnce.spec.js",
    "tests/spec/admin/F09-TP6-004_SearchValuePreserved.spec.js",
    "codex_output/reports/F09-TP6_green.txt",
    "codex_output/specs/F09-TP6.json"
  ],
  "changeNotes": [
    "Updated admin.html + main.js so the Record sale trigger lives within the admin nav (between Manage books and Book requests) to match the established layout while still wiring up the sale workflow.",
    "Launcher tests remain, and the verified implementation opens the panel, focuses the header date input, initializes the workflow once, and preserves the search context; the targeted Jest suite is recorded in codex_output/reports/F09-TP6_green.txt."
  ],
  "notes": "F09-TP6 ties the existing F08 sale header/line experience into the inventory header. The Record sale button must live next to the search box, control the `saleEntryPanel`, focus the sale header date field on activation, and rely on a single workflow bootstrap so repeated clicks donâ€™t recreate modules."
}
