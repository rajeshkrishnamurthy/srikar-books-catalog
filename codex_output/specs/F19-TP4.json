{
  "topicId": "F19-TP4",
  "featureId": "F19",
  "title": "Available Page Size Selector",
  "area": "Admin / Manage Books",
  "goal": "Let admins pick how many available books load per page (10/20/50) without reloading the page, while persisting the selection in state sync.",
  "environment": "HTML + Vanilla JavaScript + Firebase + Jest + jsdom",
  "status": "GREEN",
  "specs": [
    {
      "id": "F19-TP4-001",
      "title": "PageSizeSelectorRenders",
      "given": "The Manage > Available panel is visible.",
      "when": "The pagination shell renders.",
      "then": "It exposes an \"Items per page\" select offering 10/20/50 options, defaults to 20, and still renders only 20 rows until changed."
    },
    {
      "id": "F19-TP4-002",
      "title": "PageSizeChangeReloadsAndResetsPage",
      "given": "An admin is on a later page of results (e.g., via hash deep link).",
      "when": "They change the page-size selector to 50.",
      "then": "The controller fetches 50 rows starting from page 1, the summary text updates, and the hash now records pageSize=50/page=1/offset=0."
    },
    {
      "id": "F19-TP4-003",
      "title": "PageSizePersistsAcrossReload",
      "given": "An admin selects a new page size and later reloads or reopens Manage > Available.",
      "when": "initInventory restores state from the hash/query parameters.",
      "then": "The select reflects the saved size before paging and the first render honors that size without bouncing back to the default."
    }
  ],
  "fixtures": [
    "tests/fixtures/adminInventoryHarness.js",
    "tests/fixtures/paginationControllerStub.js"
  ],
  "tests": [
    "/tests/spec/admin/F19-TP4-001_PageSizeSelectorRenders.spec.js",
    "/tests/spec/admin/F19-TP4-002_PageSizeChangeReloadsAndResetsPage.spec.js",
    "/tests/spec/admin/F19-TP4-003_PageSizePersistsAcrossReload.spec.js"
  ],
  "reports": {
    "red": "codex_output/reports/F19-TP4_red.txt",
    "green": "codex_output/reports/F19-TP4_green.txt"
  },
  "validation": {
    "status": "GREEN",
    "command": "npm test -- --watchAll=false --runTestsByPath tests/spec/admin/F19-TP4-001_PageSizeSelectorRenders.spec.js tests/spec/admin/F19-TP4-002_PageSizeChangeReloadsAndResetsPage.spec.js tests/spec/admin/F19-TP4-003_PageSizePersistsAcrossReload.spec.js",
    "report": "codex_output/reports/F19-TP4_green.txt",
    "summary": {
      "result": "passed",
      "details": "Available pagination now exposes the page-size select, rewinds to page 1 when the size changes, updates the hash, and restores the saved size after reloads."
    }
  },
  "changedFiles": [
    "admin.html",
    "scripts/admin/inventory.js",
    "scripts/helpers/data.js",
    "tests/fixtures/adminInventoryHarness.js",
    "tests/fixtures/paginationControllerStub.js",
    "tests/spec/admin/F19-TP4-001_PageSizeSelectorRenders.spec.js",
    "tests/spec/admin/F19-TP4-002_PageSizeChangeReloadsAndResetsPage.spec.js",
    "tests/spec/admin/F19-TP4-003_PageSizePersistsAcrossReload.spec.js",
    "codex_output/reports/F19-TP4_green.txt",
    "codex_output/reports/F19-TP4_red.txt",
    "codex_output/specs/F19-TP4.json"
  ],
  "changeNotes": [
    "Added Jest specs covering page-size selector rendering, page-reset-on-change behavior, and state persistence across reloads.",
    "Implemented the selector UI in admin.html and wired initInventory/page controller to honor 10/20/50 choices, update hashes, and reload the current slice without losing cursors.",
    "Extended pagination controller helpers to track current offsets, refresh pages without resetting state, and expose a setPageSize API so future regressions are caught by the new tests."
  ]
}
