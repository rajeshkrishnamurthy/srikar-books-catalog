{"type":"meta","topicId":"SBD-F24-TP1","title":"Inline Bundle Context Lifecycle"}
{"type":"given","text":"An admin opens Available Books with the composer shell available."}
{"type":"when","text":"They add, remove, or reopen the composer via its toggles."}
{"type":"then","text":"The controller creates a new context when none exists, tracks selected book IDs plus bundle meta, and restores the same context if the drawer is reopened during the session."}
{"type":"reuse","patternId":"INLINE_BUNDLE_PANEL_SHELL"}
{"type":"reuse","patternId":"INLINE_BUNDLE_COMPOSER_CONTROLLER"}
{"type":"ui-anchor","selector":"#inlineBundleComposer"}
{"type":"ui-anchor","selector":"#inlineBundleHeading"}
{"type":"ui-anchor","selector":"[data-test=\"bookAddToBundle\"]"}
{"type":"ui-anchor","selector":"#inlineBundleSelectedBooks"}
{"type":"ui-anchor","selector":"#inlineBundleName"}
{"type":"ui-anchor","selector":"#inlineBundlePrice"}
{"type":"ui-anchor","selector":"#inlineBundleRecommended"}
{"type":"ui-anchor","selector":"#inlineBundleTotal"}
{"type":"ui-anchor","selector":"#inlineBundleSave"}
{"type":"ui-anchor","selector":"#inlineBundleReset"}
{"type":"ui-anchor","selector":"#inlineBundleMrp"}
{"type":"js-handler","event":"click","selector":"[data-test=\"bookAddToBundle\"]","handler":"openInlineBundleComposer"}
{"type":"js-handler","event":"click","selector":"#inlineBundleReset","handler":"resetInlineBundle"}
{"type":"js-handler","event":"click","selector":"#inlineBundleSave","handler":"saveInlineBundleDraft"}
{"type":"js-handler","event":"input","selector":"#inlineBundleName","handler":"updateInlineBundleFields"}
{"type":"js-handler","event":"input","selector":"#inlineBundlePrice","handler":"updateInlineBundleFields"}
{"type":"adapter-call","function":"createInlineBundleComposerController","args":[]}
{"type":"adapter-call","function":"formatCurrency","args":["value","currency"]}
{"type":"adapter-call","function":"announceInlineBundleChange","args":["message"]}
{"type":"adapter-call","function":"fetchBundlePriceRecommendation","args":["bookIds","currency"]}
{"type":"adapter-call","function":"loadBundleDraftFromSession","args":[]}
{"type":"adapter-call","function":"persistNewBundle","args":["bundleData"]}
{"type":"adapter-call","function":"syncInlineBundlePanelState","args":["state"]}
{"type":"pattern","patternId":"INLINE_BUNDLE_PANEL_SHELL","requiredParams":["container","panelHeading","triggerSelector","bookList","bundleNameInput","bundlePriceInput","recommendedPrice","totalPrice","saveButton","resetButton"],"adapters":{"controller":"createInlineBundleComposerController","formatPrice":"formatCurrency","announce":"announceInlineBundleChange"},"testBehaviors":[]}
{"type":"pattern","patternId":"INLINE_BUNDLE_COMPOSER_CONTROLLER","requiredParams":["currency","pricePrecision","recommendationThreshold"],"adapters":{"fetchPriceRecommendation":"fetchBundlePriceRecommendation","loadBundle":"loadBundleDraftFromSession","saveBundle":"persistNewBundle","onStateChange":"syncInlineBundlePanelState"},"testBehaviors":[]}
