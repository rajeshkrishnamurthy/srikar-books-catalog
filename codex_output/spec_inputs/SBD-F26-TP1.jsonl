{"type":"meta","topicId":"SBD-F26-TP1","title":"Shared Bundle Composition Contract"}
{"type":"given","text":"Bundle → Create and Available → Add to bundle both expose book selection with price fields."}
{"type":"when","text":"A second book is added or selections change before save."}
{"type":"then","text":"The shared controller applies the bundle composition contract: computes recommended price at a 25% discount once 2+ books are present, fills totals/recommended fields with recommendationComputedAt, and both routes persist the same bundle document shape."}
{"type":"reuse","patternId":"BUNDLE_COMPOSITION_CONTRACT"}
{"type":"reuse","patternId":"BUNDLE_COMPOSITION_CONTROLLER"}
{"type":"ui-anchor","selector":"#bundleRecommendedPrice"}
{"type":"ui-anchor","selector":"#inlineBundleRecommended"}
{"type":"ui-anchor","selector":"[data-test=\"bookAddToBundle\"]"}
{"type":"js-handler","event":"click","selector":"[data-test=\"bookAddToBundle\"]","handler":"addBookToBundle"}
{"type":"adapter-call","function":"computeRecommendation","args":["bookSelections","currency","recommendationDiscountPct"]}
{"type":"adapter-call","function":"saveBundle","args":["bundleDocument"]}
{"type":"pattern","patternId":"BUNDLE_COMPOSITION_CONTRACT","requiredParams":["currency","recommendationThreshold","recommendationDiscountPct"],"adapters":{},"testBehaviors":[]}
{"type":"pattern","patternId":"BUNDLE_COMPOSITION_CONTROLLER","requiredParams":["currency","recommendationThreshold","recommendationDiscountPct","pricePrecision"],"adapters":{"computeRecommendation":"computeRecommendation","saveBundle":"saveBundle","loadBundle":"loadBundle","onStateChange":"onStateChange"},"testBehaviors":[]}
