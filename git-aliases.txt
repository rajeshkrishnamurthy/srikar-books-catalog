alias.nf !f(){ \
  git fetch origin && \
  if git show-ref --verify --quiet refs/heads/feature/$1; then \
    git switch feature/$1; \
  else \
    git switch -c feature/$1 origin/staging && git push -u origin HEAD; \
  fi; \
}; f
alias.prs !gh pr create --base staging --head $(git branch --show-current) --web
alias.prm !gh pr create --base main --head $(git branch --show-current) --web
alias.sqs !f(){ \
  set -e; \
  BR=$(git branch --show-current); \
  git fetch origin >/dev/null 2>&1 || true; \
  # Ensure there is a PR for this branch
  if ! gh pr view >/dev/null 2>&1; then echo "No PR found for $BR"; exit 1; fi; \
  BASE=$(gh pr view --json baseRefName -q .baseRefName); \
  PRNUM=$(gh pr view --json number -q .number); \
  if [ "$BASE" != "staging" ]; then echo "PR base is \"$BASE\" (expected staging)"; exit 1; fi; \
  echo "Squash-merging PR #$PRNUM ($BR â†’ staging)â€¦"; \
  gh pr merge "$PRNUM" --squash; \
  echo "Done."; \
}; f
alias.cf !f(){ \
  set -e; \
  BR=$(git branch --show-current); \
  if [ "$BR" = "staging" ] || [ "$BR" = "main" ]; then echo "Refusing to clean up $BR"; exit 1; fi; \
  echo "Deleting remote branch origin/$BR (if exists)â€¦"; \
  git push origin --delete "$BR" 2>/dev/null || echo "(remote branch absent)"; \
  echo "Switching to staging and updatingâ€¦"; \
  git switch staging; \
  git pull --ff-only; \
  echo "Deleting local branch $BRâ€¦"; \
  if git diff --quiet origin/staging...$BR; then \
    git branch -D "$BR"; \
  else \
    git branch -d "$BR" || { \
      echo "Branch not fully merged AND has diffs vs staging; aborting."; exit 1; }; \
  fi; \
  echo "Pruning remotesâ€¦"; \
  git fetch -p; \
  echo "Cleanup complete."; \
}; f
alias.nt !f(){ \
  git fetch origin >/dev/null 2>&1 || true; \
  BASE=$(git branch --show-current); \
  if [[ "$BASE" != feature/* ]]; then \
    echo "âŒ You must be on a feature branch to create a topic branch."; \
    exit 1; \
  fi; \
  echo "ğŸ”„ Checking if $BASE is up to date with origin..."; \
  git pull --ff-only || echo "âš ï¸  Could not fast-forward $BASE (diverged or no remote changes). Proceeding anyway."; \
  TOPIC=topic/$1; \
  if git rev-parse --verify "$TOPIC" >/dev/null 2>&1; then \
    echo "âš ï¸  Branch $TOPIC already exists. Switching to it..."; \
    git switch "$TOPIC"; \
  else \
    git switch -c "$TOPIC" "$BASE"; \
    git push -u origin HEAD; \
    git config branch."$TOPIC".parent "$BASE"; \
    echo "âœ… Created $TOPIC from $BASE, pushed to origin, and recorded parent."; \
  fi; \
}; f
alias.prf !f(){ \
  BR=$(git branch --show-current); \
  if [[ "$BR" != topic/* ]]; then \
    echo "âŒ You must be on a topic branch to open a PR to its feature."; \
    exit 1; \
  fi; \
  PARENT=$(git config branch."$BR".parent); \
  if [ -z "$PARENT" ]; then \
    echo "âš ï¸  No parent feature recorded for $BR. Please specify manually:"; \
    read -p "Enter feature branch name (e.g. feature/staging-persistence): " PARENT; \
  fi; \
  echo "ğŸ“¬ Creating PR from $BR â†’ $PARENT"; \
  gh pr create --base "$PARENT" --head "$BR" --web; \
}; f
alias.sqf !f(){ \
  BR=$(git branch --show-current) || { echo "âŒ Cannot detect branch"; exit 1; }; \
  if [[ "$BR" != topic/* ]]; then \
    echo "âŒ Must be on topic/* branch"; exit 1; fi; \
  PARENT=$(git config branch."$BR".parent); \
  if [ -z "$PARENT" ]; then \
    echo "âš ï¸  No parent feature recorded for $BR"; \
    read -p "Enter parent feature (e.g. feature/staging-persistence): " PARENT; \
  fi; \
  PRNUM=$(gh pr view --json number -q .number 2>/dev/null); \
  if [ -z "$PRNUM" ]; then \
    echo "âŒ No PR found for $BR â†’ $PARENT"; exit 1; fi; \
  MSG="$1"; \
  if [ -z "$MSG" ]; then echo "Enter squash message (Ctrl+D to finish):"; MSG=$(cat); fi; \
  echo "ğŸ§© Squash-merging PR #$PRNUM ($BR â†’ $PARENT)â€¦"; \
  if ! gh pr merge "$PRNUM" --squash --delete-branch --body "$MSG"; then \
    echo "âŒ Merge failed â€” check GitHub CLI output."; exit 1; fi; \
  echo "âœ… Switching to $PARENT and updatingâ€¦"; \
  if ! git switch "$PARENT"; then echo "âŒ Could not switch to $PARENT"; exit 1; fi; \
  git pull --ff-only || echo "âš ï¸  Pull failed (non-fatal)"; \
  echo "âœ¨ Done: $MSG"; \
}; f
alias.ct !f(){ \
  set -e; \
  BR=$(git branch --show-current); \
  if [[ "$BR" != topic/* ]]; then \
    echo "âŒ You must be on a topic branch to run cleanup (current: $BR)."; \
    exit 1; \
  fi; \
  PARENT=$(git config branch."$BR".parent); \
  if [ -z "$PARENT" ]; then \
    echo "âš ï¸  No recorded parent for $BR. Please specify manually:"; \
    read -p "Enter feature branch (e.g. feature/staging-persistence): " PARENT; \
  fi; \
  echo "ğŸ§¹ Cleaning up topic branch $BR -> returning to $PARENT..."; \
  echo "Deleting remote branch origin/$BR (if exists)..."; \
  git push origin --delete "$BR" 2>/dev/null || echo "(remote branch absent)"; \
  echo "Switching to $PARENT and updating..."; \
  git switch "$PARENT"; \
  git pull --ff-only || echo "(no remote updates)"; \
  echo "Deleting local branch $BR..."; \
  git branch -d "$BR" || git branch -D "$BR"; \
  echo "Pruning stale remotes..."; \
  git fetch -p; \
  echo "âœ… Cleanup complete: now on $PARENT"; \
}; f
alias.acp !f(){ \
  if [ -z "$1" ]; then \
    echo "âŒ Commit message required. Usage: git acp \"<message>\""; \
    exit 1; \
  fi; \
  git add . && git commit -m "$*" && git push; \
}; f
alias.prf-auto !f(){ \
  BR=$(git branch --show-current); \
  if [[ "$BR" != topic/* ]]; then echo "âŒ Must be on a topic branch"; exit 1; fi; \
  PARENT=$(git config branch."$BR".parent 2>/dev/null); \
  if [ -z "$PARENT" ]; then echo "Base feature branch?"; read -r PARENT; fi; \
  echo "ğŸ“ PR title:"; read -r TITLE; \
  echo "ğŸ“ PR description:"; read -r BODY; \
  git push -u origin "$BR"; \
  echo "ğŸ“¤ Creating PR $BR â†’ $PARENT..."; \
  gh pr create --base "$PARENT" --head "$BR" --title "$TITLE" --body "$BODY" || exit 1; \
  echo "ğŸ”€ Attempting merge..."; \
  if gh pr merge --merge; then \
    echo "âœ… PR merged into $PARENT"; \
  else \
    echo "âš ï¸ Merge conflict â€” resolve manually"; exit 1; \
  fi; \
}; f
alias.prs-auto !f(){ \
  BR=$(git branch --show-current); \
  if [[ "$BR" != feature/* ]]; then echo "âŒ Must be on a feature branch"; exit 1; fi; \
  echo "ğŸ“ PR title:"; read -r TITLE; \
  echo "ğŸ“ PR description:"; read -r BODY; \
  git push -u origin "$BR"; \
  echo "ğŸ“¤ Creating PR $BR â†’ staging..."; \
  gh pr create --base staging --head "$BR" --title "$TITLE" --body "$BODY" || exit 1; \
  echo "ğŸ”€ Attempting merge..."; \
  if gh pr merge --merge --delete-branch; then \
    echo "ğŸ§¹ Cleaning up feature branch..."; \
    git switch staging; \
    git pull --ff-only; \
    git branch -d "$BR" || git branch -D "$BR"; \
    git fetch -p; \
    echo "âœ… Feature branch merged and cleaned"; \
  else \
    echo "âš ï¸ Merge conflict â€” resolve manually"; exit 1; \
  fi; \
}; f
alias.prm-auto !f(){ \
  BR=$(git branch --show-current); \
  if [[ "$BR" != "staging" ]]; then \
    echo "âŒ You must be on the staging branch to promote to main."; \
    exit 1; \
  fi; \
  git push -u origin staging; \
  echo "ğŸ“ PR title:"; read -r TITLE; \
  echo "ğŸ“ PR description:"; read -r BODY; \
  echo "ğŸ“¤ Creating PR staging â†’ main..."; \
  gh pr create --base main --head staging --title "$TITLE" --body "$BODY" || { echo "âŒ PR creation failed."; exit 1; }; \
  echo "ğŸ”€ Attempting merge into main..."; \
  if gh pr merge --merge; then \
    echo "ğŸ‰ Staging has been promoted to main successfully."; \
    echo "â¬‡ï¸ Updating local main..."; \
    git switch main; \
    git pull --ff-only; \
    echo "â¬‡ï¸ Updating local staging (optional, usually already latest)..."; \
    git switch staging; \
    git pull --ff-only; \
    echo "âœ… Promotion complete. You remain on staging."; \
  else \
    echo "âš ï¸ Merge conflict â€” resolve manually."; \
    exit 1; \
  fi; \
}; f
