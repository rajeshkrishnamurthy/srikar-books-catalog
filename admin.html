<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Srikar’s Books — Admin</title>
    <link rel="preconnect" href="https://www.gstatic.com" crossorigin />
    <link rel="stylesheet" href="./styles.css" />
    <!-- Page-specific tweaks for admin layout (moved out of inline <style>) -->
    <link rel="stylesheet" href="./styles/admin.css?v=1" />
  </head>
  <body>
    <header class="site-header">
      <div class="wrap">
        <h1 class="brand"><a href="./">Srikar’s Books</a></h1>
        <nav class="tabs"><a class="tab" href="./">← Back to catalog</a></nav>
      </div>
    </header>

    <main class="wrap">
      <!-- Auth panel -->
      <section class="auth" id="auth">
        <h2>Admin sign in</h2>
        <p class="muted">
          Use your admin email. Only whitelisted emails can add/remove books.
        </p>
        <form id="loginForm" class="stack">
          <input
            id="email"
            type="email"
            placeholder="email@example.com"
            required
          />
          <input
            id="password"
            type="password"
            placeholder="Password"
            required
          />
          <button class="btn" type="submit">Sign in</button>
          <p id="authError" class="error" hidden></p>
        </form>
      </section>

      <!-- Admin app -->
      <section class="admin" id="admin" style="display: none">
        <div class="admin-hero">
          <div>
            <p class="admin-hero__eyebrow">Srikar’s Books</p>
            <h2 class="admin-hero__title">Admin workspace</h2>
          </div>
          <div class="admin-hero__actions">
            <label class="sr-only" for="adminSearch">Search inventory</label>
            <input
              id="adminSearch"
              type="search"
              placeholder="Search title or author…"
              aria-label="Search inventory"
            />
            <button id="signOutBtn" class="btn btn-secondary">Sign out</button>
          </div>
        </div>

        <nav class="admin-nav" id="adminNav" aria-label="Admin sections">
          <button
            type="button"
            class="admin-nav__item is-active"
            data-nav="manageBooks"
          >
            <span class="admin-nav__title">Manage books</span>
            <span class="admin-nav__meta">Add &amp; stock</span>
          </button>
          <button
            type="button"
            class="admin-nav__item"
            data-nav="recordSale"
            id="recordSaleBtn"
            aria-controls="saleEntryPanel"
            aria-expanded="false"
          >
            <span class="admin-nav__title">Record sale</span>
            <span class="admin-nav__meta">Multi-book orders</span>
          </button>
          <button
            type="button"
            class="admin-nav__item"
            data-nav="bookRequests"
          >
            <span class="admin-nav__title">Book requests</span>
            <span class="admin-nav__meta">Inbox</span>
          </button>
          <button
            type="button"
            class="admin-nav__item"
            data-nav="suppliers"
          >
            <span class="admin-nav__title">Suppliers</span>
            <span class="admin-nav__meta">Add &amp; manage</span>
          </button>
        </nav>

        <div id="manageBooksAnchor" class="panel-anchor" aria-hidden="true"></div>

        <!-- Add book -->
        <details class="panel" id="addBookPanel" open>
          <summary><strong>Add a book</strong></summary>

          <!-- Lookup helper -->
          <div class="stack" style="margin-bottom: 0.6rem">
            <div class="hint">
              Fill Title and (optionally) Author, then click
              <em>Find details</em> to auto‑fill ISBN/MRP/Format/Description and
              pre‑fill the cover image.
            </div>
            <div class="flex">
              <button class="btn btn-secondary" type="button" id="lookupBtn">
                Find details (ISBN/MRP)
              </button>
              <span
                id="lookupMsg"
                class="hint"
                style="margin-left: 0.6rem"
              ></span>
            </div>
            <div id="lookupResults" class="admin-list"></div>
          </div>

          <form id="addForm" class="stack">
            <div class="grid-2">
              <input name="title" placeholder="Title *" required />

              <!-- AUTHOR with autocomplete -->
              <input
                id="authorInput"
                name="author"
                placeholder="Author"
                list="authorList"
                autocomplete="off"
              />
              <datalist id="authorList"></datalist>

              <select name="category" required>
                <option value="" selected disabled>Category *</option>
                <option>Fiction</option>
                <option>Non-Fiction</option>
                <option>Children</option>
              </select>

              <select name="binding" id="binding" required>
                <option value="" selected disabled>Format *</option>
                <option>Paperback</option>
                <option>Hardcover</option>
              </select>

              <select id="supplierSelect" name="supplierId" required>
                <option value="" selected disabled>Select supplier *</option>
              </select>

              <input
                name="price"
                placeholder="Price (e.g., 250)"
                inputmode="numeric"
              />
              <input
                name="mrp"
                placeholder="MRP (e.g., 499)"
                inputmode="numeric"
              />
              <div class="field-with-label">
                <label class="sr-only" for="purchasePriceInput">
                  Purchase price (our cost)
                </label>
                <input
                  id="purchasePriceInput"
                  type="number"
                  name="purchasePrice"
                  placeholder="Purchase price (our cost)"
                  inputmode="numeric"
                  min="0"
                  step="1"
                  aria-describedby="purchasePriceHelp"
                />
                <span id="purchasePriceHelp" class="sr-only">
                  Enter the amount paid to acquire the book; use zero for donations.
                </span>
              </div>
              <input name="isbn" placeholder="ISBN (10 or 13)" />
              <select name="condition" id="condition" required>
                <option value="" selected disabled>Condition *</option>
                <option>Good as new</option>
                <option>Excellent</option>
                <option>Gently used</option>
                <option>Used</option>
              </select>
            </div>

            <textarea
              name="description"
              rows="3"
              placeholder="Auto-filled or write a short marketing description"
            ></textarea>

            <div class="flex">
              <label
                ><strong>Cover image</strong>
                <input
                  name="cover"
                  id="coverInput"
                  type="file"
                  accept="image/*"
                  required
                />
              </label>

              <button
                type="button"
                id="searchCoverBtn"
                class="btn btn-secondary"
                style="align-self: flex-end"
              >
                Search cover image
              </button>
            </div>

            <div id="coverPreview" class="cover-preview muted">
              No cover selected.
            </div>

            <label
              >More images (optional)
              <input name="more" type="file" accept="image/*" multiple />
            </label>

            <label class="flex" style="align-items: center; gap: 0.5rem">
              <input type="checkbox" name="featured" id="featuredAdd" />
              <span>Show on homepage carousel</span>
            </label>

            <button class="btn" type="submit">Add book</button>
            <p id="addMsg" class="muted"></p>
          </form>
        </details>

        <details class="panel" id="availableBooksPanel" open>
          <summary><strong>Available</strong></summary>
          <div id="availList" class="admin-list"></div>
        </details>

        <details class="panel" id="soldBooksPanel">
          <summary><strong>Sold</strong></summary>
          <div id="soldList" class="admin-list"></div>
        </details>

        <details class="panel" id="bookRequestsPanel" open>
          <summary><strong>Book Requests</strong></summary>
          <div class="muted" style="margin-bottom: 0.4rem">
            Requests sent from the catalog.
          </div>
          <div id="reqOpen" class="admin-list"></div>
          <hr
            style="
              border: 0;
              border-top: 1px solid var(--border);
              opacity: 0.4;
              margin: 0.6rem 0;
            "
          />
          <div class="muted" style="margin-bottom: 0.3rem">
            <strong>Closed</strong>
          </div>
          <div id="reqClosed" class="admin-list"></div>
        </details>

        <details class="panel" id="saleEntryPanel" hidden>
          <summary><strong>Record a sale</strong></summary>
          <div class="sale-entry-grid">
            <div>
              <form id="saleHeaderForm" class="stack">
                <h3>Sale header</h3>
                <input type="hidden" id="saleHeaderCustomerId" />
                <p
                  id="saleHeaderCustomerSummary"
                  data-empty="true"
                  data-default-summary="No customer selected"
                >
                  No customer selected
                </p>
                <div id="saleCustomerLookup">
                  <label class="sr-only" for="saleCustomerLookupSearch"
                    >Search customers</label
                  >
                  <input
                    id="saleCustomerLookupSearch"
                    type="search"
                    placeholder="Search customers"
                    autocomplete="off"
                  />
                  <button type="button" id="saleCustomerLookupClear">Clear</button>
                  <p id="saleCustomerLookupEmpty" class="muted">
                    Start typing to search customers.
                  </p>
                  <ul id="saleCustomerLookupList" class="admin-list"></ul>
                </div>
                <label class="sale-date-field">
                  <span>Sale date</span>
                  <div class="sale-date-field__controls">
                    <input
                      id="saleHeaderSaleDate"
                      name="saleDate"
                      type="text"
                      placeholder="dd-mon-yy"
                      autocomplete="off"
                      inputmode="text"
                      aria-describedby="saleDateHint"
                    />
                    <button
                      type="button"
                      id="saleHeaderDatePickerBtn"
                      class="btn btn-secondary sale-date-field__button"
                      aria-label="Pick sale date"
                    >
                      Pick date
                    </button>
                  </div>
                  <input
                    type="date"
                    id="saleHeaderDatePicker"
                    class="sr-only"
                    tabindex="-1"
                    aria-hidden="true"
                  />
                  <span id="saleDateHint" class="hint">
                    Format: dd-mon-yy (e.g., 05-Feb-24)
                  </span>
                </label>
                <div class="flex" style="gap: 0.5rem">
                  <button id="saleHeaderContinue" type="submit" class="btn">
                    Capture header
                  </button>
                  <button type="reset" class="btn btn-secondary">Reset</button>
                </div>
                <p id="saleHeaderMsg" class="muted" aria-live="polite"></p>
              </form>
            </div>

            <div>
              <form id="saleLineDraftForm" class="stack">
                <label id="saleLineDraftLabel" for="saleLineBookTitle">
                  Add another book
                </label>
                <input
                  id="saleLineBookTitle"
                  name="saleLineBookTitle"
                  type="text"
                  placeholder="Start typing a title"
                  autocomplete="off"
                  aria-autocomplete="list"
                  aria-expanded="false"
                  aria-controls="saleLineSuggestions"
                />
                <ul
                  id="saleLineSuggestions"
                  role="listbox"
                  aria-label="Matching titles"
                ></ul>
                <label>
                  Supplier
                  <select
                    id="saleLineSupplierSelect"
                    name="saleLineSupplierId"
                    required
                  >
                    <option value="" selected disabled>Select supplier *</option>
                  </select>
                </label>
                <input type="hidden" id="saleLineBookId" name="bookId" value="" />
                <p
                  id="saleLineBookSummary"
                  data-empty="true"
                  data-default-summary="No book selected"
                >
                  No book selected
                </p>
                <label>
                  <span>Selling price</span>
                  <input
                    id="saleLinePrice"
                    name="sellingPrice"
                    type="text"
                    autocomplete="off"
                    inputmode="numeric"
                  />
                </label>
                <button type="submit" id="saleLineAddBtn" class="btn" disabled>
                  Add line
                </button>
                <p id="saleTitleMsg" class="muted" aria-live="polite"></p>
                <p id="saleLineMsg" class="muted" aria-live="polite"></p>
              </form>
              <table class="admin-table">
                <tbody id="saleLineItemsBody"></tbody>
              </table>
              <div id="saleLineContext" class="muted">
                <p id="saleLineSupplierHint" data-empty="true">Supplier: Not set</p>
                <p id="saleLinePurchaseHint" data-empty="true">
                  Purchase price: Not set
                </p>
                <p id="saleLineSellingHint" data-empty="true">
                  Last sold price: Not set
                </p>
              </div>
              <div id="saleLineTotals" class="flex" style="gap: 0.5rem">
                <span id="saleLineTotalsCount">0 lines</span>
                <span id="saleLineTotalsAmount">₹0.00</span>
              </div>
            </div>
          </div>
          <div class="stack" style="margin-top: 1rem">
            <div class="flex" style="gap: 0.5rem; align-items: center">
              <button id="salePersistBtn" class="btn">Persist sale</button>
              <p id="salePersistMsg" class="muted" aria-live="polite"></p>
            </div>
            <ul id="saleLineStatusList" class="stack" style="gap: 0.4rem"></ul>
          </div>
        </details>

        <details class="panel" id="suppliersPanel" open>
          <summary><strong>Suppliers</strong></summary>
          <p class="muted">
            Track trusted suppliers so you can reference their inventory quickly.
          </p>
          <form id="supplierForm" class="stack">
            <label>
              Supplier name *
              <input
                id="supplierNameInput"
                name="supplierName"
                placeholder="e.g., Rare Finds"
                required
              />
            </label>
            <label>
              Location *
              <input
                id="supplierLocationInput"
                name="supplierLocation"
                placeholder="City or region"
                required
              />
            </label>
            <input type="hidden" id="supplierIdInput" name="supplierId" />
            <div class="flex" style="gap: 0.5rem">
              <button type="submit" class="btn">Save supplier</button>
              <button type="button" id="supplierCancelBtn" class="btn btn-secondary">
                Cancel
              </button>
            </div>
          </form>
          <p id="supplierMsg" class="muted"></p>
          <ul id="supplierList" class="stack" style="gap: 0.4rem"></ul>
        </details>

        <details class="panel" open>
          <summary><strong>Customer master</strong></summary>
          <div class="grid-2" id="customerPanel">
            <form id="customerForm" class="stack">
              <h3>Customer form</h3>
              <input type="hidden" id="customerIdInput" name="customerId" />
              <input
                id="customerNameInput"
                name="customerName"
                placeholder="Customer name *"
                required
              />
              <textarea
                id="customerAddressInput"
                name="customerAddress"
                placeholder="Address / Landmark"
                rows="3"
              ></textarea>
              <input
                id="customerLocationInput"
                name="customerLocation"
                placeholder="City / Location"
              />
              <input
                id="customerWhatsAppInput"
                name="customerWhatsApp"
                placeholder="WhatsApp (10 digits)"
                inputmode="numeric"
                required
                aria-describedby="customerMsg"
              />
              <div class="flex" style="gap: 0.5rem; align-items: center">
                <button class="btn" type="submit">Save customer</button>
                <button
                  class="btn btn-secondary"
                  type="button"
                  id="customerCancelBtn"
                >
                  Cancel edit
                </button>
              </div>
              <p id="customerMsg" class="muted" aria-live="polite"></p>
            </form>
            <div>
              <h3>Recent customers</h3>
              <ul id="customerList" class="admin-list"></ul>
            </div>
          </div>
        </details>

        <!-- EDIT BOOK DIALOG -->
        <dialog id="editDialog" class="panel" style="max-width: 760px">
          <form id="editForm" method="dialog" class="stack">
            <h3>Edit book</h3>
            <input type="hidden" name="id" />

            <div class="grid-2">
              <input name="etitle" placeholder="Title *" required />
              <input
                name="eauthor"
                id="editAuthor"
                placeholder="Author"
                list="authorList"
                autocomplete="off"
              />

              <select name="ecategory" required>
                <option value="" selected disabled>Category *</option>
                <option>Fiction</option>
                <option>Non-Fiction</option>
                <option>Children</option>
              </select>

              <select name="ebinding" required>
                <option value="" selected disabled>Format *</option>
                <option>Paperback</option>
                <option>Hardcover</option>
              </select>

              <input
                name="eprice"
                placeholder="Price (₹)"
                inputmode="numeric"
              />
              <input name="emrp" placeholder="MRP (₹)" inputmode="numeric" />
              <select id="editSupplierSelect" name="esupplierId" required>
                <option value="" selected disabled>Select supplier *</option>
              </select>
              <div class="field-with-label">
                <label class="sr-only" for="editPurchasePriceInput">
                  Purchase price (our cost)
                </label>
                <input
                  id="editPurchasePriceInput"
                  type="number"
                  name="epurchasePrice"
                  placeholder="Purchase price (our cost)"
                  inputmode="numeric"
                  min="0"
                  step="1"
                  aria-describedby="editPurchasePriceHelp"
                />
                <span id="editPurchasePriceHelp" class="sr-only">
                  Enter the amount paid to acquire the book; use zero for donations.
                </span>
              </div>
              <input name="eisbn" placeholder="ISBN (10 or 13)" />
              <select name="econdition" required>
                <option value="" selected disabled>Condition *</option>
                <option>Good as new</option>
                <option>Excellent</option>
                <option>Gently used</option>
                <option>Used</option>
              </select>
            </div>

            <textarea
              name="edescription"
              rows="3"
              placeholder="Marketing description"
            ></textarea>

            <strong>Current cover</strong>
            <div id="editCoverPreview" class="cover-preview muted">
              No cover.
            </div>

            <div class="flex">
              <label
                ><strong>Replace cover</strong>
                <input
                  id="editCoverInput"
                  name="cover"
                  type="file"
                  accept="image/*"
                />
              </label>
              <label style="margin-left: 0.6rem"
                >Add more images
                <input
                  id="editMoreInput"
                  name="more"
                  type="file"
                  accept="image/*"
                  multiple
                />
              </label>
            </div>

            <div class="flex between">
              <button id="editSaveBtn" class="btn" type="submit">
                Save changes
              </button>
              <button
                id="editCancelBtn"
                class="btn btn-secondary"
                type="button"
              >
                Cancel
              </button>
            </div>
            <p id="editMsg" class="muted"></p>
          </form>
        </dialog>
      </section>
    </main>

    <!-- Entry point that wires the page using small modules -->
    <script type="module" src="./scripts/admin/main.js"></script>
  </body>
</html>
